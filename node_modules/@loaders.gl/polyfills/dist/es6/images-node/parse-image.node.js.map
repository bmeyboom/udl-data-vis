{"version":3,"sources":["../../../src/images-node/parse-image.node.js"],"names":["getPixels","util","assert","parseImageNode","arrayBuffer","mimeType","options","getPixelsAsync","promisify","buffer","Buffer","from","ndarray","shape","layers","length","shift","data","width","height","components"],"mappings":"AACA,OAAOA,SAAP,MAAsB,YAAtB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AAEA,OAAO,eAAeC,cAAf,CAA8BC,WAA9B,EAA2CC,QAA3C,EAAqDC,OAArD,EAA8D;AACnEJ,EAAAA,MAAM,CAACG,QAAD,EAAW,mDAAX,CAAN;AAIA,QAAME,cAAc,GAAGN,IAAI,CAACO,SAAL,CAAeR,SAAf,CAAvB;AAEA,QAAMS,MAAM,GAAGL,WAAW,YAAYM,MAAvB,GAAgCN,WAAhC,GAA8CM,MAAM,CAACC,IAAP,CAAYP,WAAZ,CAA7D;AAEA,QAAMQ,OAAO,GAAG,MAAML,cAAc,CAACE,MAAD,EAASJ,QAAT,CAApC;AAEA,QAAMQ,KAAK,GAAG,CAAC,GAAGD,OAAO,CAACC,KAAZ,CAAd;AACA,QAAMC,MAAM,GAAGF,OAAO,CAACC,KAAR,CAAcE,MAAd,KAAyB,CAAzB,GAA6BH,OAAO,CAACC,KAAR,CAAcG,KAAd,EAA7B,GAAqD,CAApE;AAGA,SAAO;AACLH,IAAAA,KADK;AAELI,IAAAA,IAAI,EAAEL,OAAO,CAACK,IAFT;AAGLC,IAAAA,KAAK,EAAEN,OAAO,CAACC,KAAR,CAAc,CAAd,CAHF;AAILM,IAAAA,MAAM,EAAEP,OAAO,CAACC,KAAR,CAAc,CAAd,CAJH;AAKLO,IAAAA,UAAU,EAAER,OAAO,CAACC,KAAR,CAAc,CAAd,CALP;AAMLC,IAAAA;AANK,GAAP;AAQD","sourcesContent":["/* global Buffer */\nimport getPixels from 'get-pixels';\nimport util from 'util';\nimport assert from 'assert';\n\nexport async function parseImageNode(arrayBuffer, mimeType, options) {\n  assert(mimeType, 'MIMEType is required to parse image under Node.js');\n\n  // TODO - check if getPixels callback is asynchronous if provided with buffer input\n  // if not, parseImage can be a sync function\n  const getPixelsAsync = util.promisify(getPixels);\n\n  const buffer = arrayBuffer instanceof Buffer ? arrayBuffer : Buffer.from(arrayBuffer);\n\n  const ndarray = await getPixelsAsync(buffer, mimeType);\n\n  const shape = [...ndarray.shape];\n  const layers = ndarray.shape.length === 4 ? ndarray.shape.shift() : 1;\n\n  // extract width/height etc\n  return {\n    shape,\n    data: ndarray.data,\n    width: ndarray.shape[0],\n    height: ndarray.shape[1],\n    components: ndarray.shape[2],\n    layers\n  };\n}\n"],"file":"parse-image.node.js"}