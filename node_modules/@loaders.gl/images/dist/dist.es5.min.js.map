{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../worker-utils/src/lib/env-utils/assert.ts","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/process/browser.js","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/@probe.gl/stats/dist/esm/utils/hi-res-timestamp.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/lib/utils/assert.js","webpack:///./src/lib/category-api/parsed-image-api.ts","webpack:///../worker-utils/src/lib/env-utils/version.ts","webpack:///./src/lib/utils/globals.ts","webpack:///./src/lib/category-api/binary-image-api.ts","webpack:///../worker-utils/src/lib/env-utils/globals.ts","webpack:///../worker-utils/src/lib/worker-farm/worker-thread.ts","webpack:///../worker-utils/src/lib/worker-utils/get-transfer-list.ts","webpack:///./src/lib/utils/version.ts","webpack:///./src/lib/parsers/parse-image.ts","webpack:///./src/lib/category-api/image-type.ts","webpack:///./src/lib/parsers/parse-to-image.ts","webpack:///./src/lib/parsers/svg-utils.ts","webpack:///../loader-utils/src/lib/env-utils/assert.ts","webpack:///../worker-utils/src/index.ts","webpack:///../worker-utils/src/lib/worker-farm/worker-job.ts","webpack:///../worker-utils/src/lib/worker-farm/worker-farm.ts","webpack:///../worker-utils/src/lib/worker-farm/worker-pool.ts","webpack:///../worker-utils/src/lib/worker-farm/worker-body.ts","webpack:///../worker-utils/src/lib/worker-api/get-worker-url.ts","webpack:///../worker-utils/src/lib/async-queue/async-queue.ts","webpack:///../loader-utils/src/lib/binary-utils/get-first-characters.ts","webpack:///../loader-utils/src/lib/binary-utils/array-buffer-utils.ts","webpack:///../loader-utils/src/lib/binary-utils/memory-copy-utils.ts","webpack:///./src/bundle.ts","webpack:///./src/index.ts","webpack:///./src/image-loader.ts","webpack:///./src/lib/parsers/parse-to-image-bitmap.ts","webpack:///./src/lib/parsers/parse-to-node-image.ts","webpack:///./src/image-writer.ts","webpack:///./src/lib/encoders/encode-image.ts","webpack:///./src/lib/texture-api/load-image.ts","webpack:///./src/lib/texture-api/generate-url.ts","webpack:///../loader-utils/src/index.ts","webpack:///../loader-utils/src/lib/env-utils/globals.ts","webpack:///../loader-utils/src/lib/worker-loader-utils/create-loader-worker.ts","webpack:///../worker-utils/src/lib/worker-utils/get-loadable-worker-url.ts","webpack:///../worker-utils/src/lib/worker-api/process-on-worker.ts","webpack:///../worker-utils/src/lib/worker-utils/remove-nontransferable-options.ts","webpack:///../worker-utils/src/lib/worker-api/create-worker.ts","webpack:///../worker-utils/src/lib/worker-api/validate-worker-version.ts","webpack:///../worker-utils/src/lib/library-utils/library-utils.ts","webpack:///../worker-utils/src/lib/process-utils/child-process-proxy.ts","webpack:///../worker-utils/src/lib/process-utils/process-utils.ts","webpack:///../loader-utils/src/lib/worker-loader-utils/parse-with-worker.ts","webpack:///../loader-utils/src/lib/parser-utils/parse-json.ts","webpack:///../loader-utils/src/lib/binary-utils/binary-copy-utils.ts","webpack:///../loader-utils/src/lib/binary-utils/encode-utils.ts","webpack:///../loader-utils/src/lib/iterators/text-iterators.ts","webpack:///../loader-utils/src/lib/iterators/async-iteration.ts","webpack:///../loader-utils/src/lib/request-utils/request-scheduler.ts","webpack:///../loader-utils/src/lib/path-utils/path.ts","webpack:///../loader-utils/src/lib/path-utils/file-aliases.ts","webpack:///../loader-utils/src/lib/node/fs.ts","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/util/util.js","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/util/support/isBufferBrowser.js","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/util/node_modules/inherits/inherits_browser.js","webpack:///../loader-utils/src/lib/binary-utils/buffer-utils.ts","webpack:///../loader-utils/src/json-loader.ts","webpack:///./src/lib/texture-api/deep-load.ts","webpack:///./src/lib/texture-api/async-deep-map.ts","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/@probe.gl/stats/dist/esm/lib/stat.js","webpack:////home/user/apps/loaders.gl_duplicate/node_modules/@probe.gl/stats/dist/esm/lib/stats.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","condition","message","Error","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","e","this","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","length","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","Array","arguments","push","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","getHiResTimestamp","timestamp","window","performance","now","hrtime","timeParts","Date","g","Function","getImageType","image","format","getImageTypeOrNull","getImageData","canvas","document","createElement","context","getContext","width","height","drawImage","ImageBitmap","Image","data","Boolean","close","globals","self","global","self_","window_","global_","document_","isBrowser","String","isWorker","importScripts","matches","exec","nodeVersion","parseFloat","binaryData","dataView","toDataView","byteLength","getUint32","mimeType","getPngMetadata","getUint16","getUint8","tableMarkers","Set","add","sofMarkers","getJpegMarkers","has","getJpegMetadata","getGifMetadata","getBmpMetadata","DataView","ArrayBuffer","isView","buffer","isMobile","orientation","NOOP","WorkerThread","props","source","url","assert","onMessage","onError","error","console","log","worker","_createBrowserWorker","Worker","terminate","terminated","transferList","getTransferList","postMessage","event","lineno","colno","_loadableURL","getLoadableWorkerURL","onmessage","onerror","_getErrorFromErrorEvent","onmessageerror","isTransferable","MessagePort","OffscreenCanvas","recursive","transfers","transfersSet","undefined","from","arrayBuffer","options","imageOptions","imageType","type","loadType","getLoadableImageType","getDefaultImageType","isImageTypeSupported","IMAGE_BITMAP_SUPPORTED","IMAGE_SUPPORTED","DATA_SUPPORTED","_parseImageNode","NODE_IMAGE_SUPPORTED","blobOrDataUrl","getBlobOrSVGDataUrl","URL","webkitURL","objectUrl","createObjectURL","loadToImage","revokeObjectURL","src","decode","Promise","resolve","reject","onload","err","isSVG","xmlText","TextDecoder","btoa","getBlob","SVG_DATA_URL_PATTERN","SVG_URL_PATTERN","test","Blob","Uint8Array","NullWorker","id","VERSION","null","WorkerJob","jobName","workerThread","isRunning","_resolve","_reject","result","payload","DEFAULT_PROPS","maxConcurrency","maxMobileConcurrency","onDebug","reuseWorkers","WorkerFarm","Map","setProps","workerPools","isSupported","_workerFarm","values","destroy","_getWorkerPoolProps","workerPool","WorkerPool","set","idleQueue","forEach","isDestroyed","job","done","startPromise","onStart","jobQueue","_startQueuedJob","_getAvailableWorker","queuedJob","shift","backlog","returnWorkerToQueue","count","_getMaxConcurrency","toLowerCase","onMessageWrapperMap","WorkerBody","isKnownMessage","onMessageWrapper","addEventListener","removeEventListener","startsWith","warning","workerOptions","workerFile","workerUrl","_workerType","versionTag","asyncIterator","AsyncQueue","_values","_settlers","_closed","enqueue","settler","getMagicString","byteOffset","magic","fromCharCode","slice","node","toArrayBuffer","text","TextEncoder","encode","_toArrayBuffer","arrayBuffer1","arrayBuffer2","array1","array2","sources","sourceArrays","map","source2","reduce","typedArray","offset","sourceArray","typedArrays","arrays","TypedArrayConstructor","constructor","sumLength","acc","subArray","subarray","targetBuffer","sourceBuffer","targetArray","target","targetOffset","srcByteOffset","srcByteLength","padToNBytes","padding","moduleExports","require","_global","loaders","assign","ImageLoader","mimeTypes","extensions","parse","parseImage","tests","getBinaryImageMetadata","_typecheckImageLoader","EMPTY_OBJECT","imagebitmapOptionsSupported","blob","imagebitmapOptions","imagebitmap","safeCreateImageBitmap","isEmptyObject","createImageBitmap","warn","ImageWriter","jpegQuality","encodeImage","_encodeImageNode","encodeImageInBrowser","qualityParamSupported","getImageSize","drawImageToCanvas","toBlob","x","y","transferFromImageBitmap","clampedArray","Uint8ClampedArray","imageData","ImageData","putImageData","getUrl","getImageUrls","imageUrls","deepLoad","urlOptions","mipLevels","getMipmappedImageUrls","generateUrl","urls","lod","shallowLoad","getMipLevels","mipLevel","Math","floor","log2","max","baseUrl","resolvePath","loader","input","parseData","parseOnMainThread","requestId","parseSync","parser","parseTextSync","textDecoder","workerURL","workerURLCache","getLoadableWorkerURLFromSource","getLoadableWorkerURLFromURL","workerSource","getWorkerName","getWorkerURL","workerFarm","getWorkerFarm","getWorkerPool","startJob","transferableOptions","removeNontransferableOptions","JSON","v","cache","stringify","processInBatches","processOnMainThread","inputBatches","resultIterator","batch","coreVersion","workerVersion","loadLibraryPromises","libraryUrl","moduleName","getLibraryUrl","loadLibraryFromFile","library","CDN","endsWith","fetch","response","requireFromFile","scriptSource","loadLibraryFromString","requireFromString","eval","script","appendChild","createTextNode","body","command","port","autoPort","wait","onSuccess","processProxy","ChildProcessProxy","Number","portArg","getAvailablePort","_setTimeout","join","childProcess","spawn","stdout","toString","stderr","_clearTimeout","code","kill","statusCode","stop","exit","callback","successTimer","defaultPort","ChildProcess","portsInUse","regex","split","line","match","includes","string","_","getFirstCharacters","stringBuffer","copyPaddedArrayBufferToDataView","paddedLength","padLength","setUint8","byteAlignment","ceil","whitespace","charCodeAt","binary","arrayBufferIterator","stream","textIterator","textEncoder","previous","eolIndex","indexOf","lineIterator","counter","iterator","visitor","next","arrayBuffers","chunk","concatenateArrayBuffers","strings","throttleRequests","maxRequests","RequestScheduler","stats","Stats","handle","getPriority","requestMap","request","priority","promise","requestQueue","_issueNewRequests","isDone","activeRequestCount","deferredUpdate","_issueNewRequestsAsync","freeSlots","_updateAllRequests","_issueRequest","_updateRequest","splice","sort","a","b","slashIndex","lastIndexOf","substr","parts","separator","part","index","replace","RegExp","prefix","pathPrefix","aliases","fileAliases","filename","alias","replacement","fsFunction","fs","open","promisify","read","readFile","readFileSync","writeFile","writeFileSync","fd","start","Buffer","alloc","bytesRead","getOwnPropertyDescriptors","obj","keys","descriptors","getOwnPropertyDescriptor","formatRegExp","f","isString","objects","inspect","str","isNull","isObject","deprecate","fn","msg","noDeprecation","warned","throwDeprecation","traceDeprecation","trace","debugEnviron","debugs","opts","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","styleType","style","styles","recurseTimes","isFunction","ret","primitive","simple","isNumber","formatPrimitive","visibleKeys","hash","val","idx","arrayToHash","getOwnPropertyNames","isError","formatError","isRegExp","isDate","output","base","braces","isArray","toUTCString","formatProperty","formatArray","pop","prev","cur","numLinesEst","reduceToSingleString","desc","ar","arg","re","objectToString","pad","debuglog","NODE_DEBUG","toUpperCase","pid","isNullOrUndefined","isSymbol","isPrimitive","isBuffer","months","time","getHours","getMinutes","getSeconds","getDate","getMonth","prop","inherits","origin","kCustomPromisifiedSymbol","callbackifyOnRejected","reason","cb","newReason","original","TypeError","writable","configurable","promiseResolve","promiseReject","setPrototypeOf","getPrototypeOf","defineProperties","custom","callbackify","callbackified","maybeCb","then","rej","copy","fill","readUInt8","ctor","superCtor","super_","TempCtor","toBuffer","JSONLoader","category","_typecheckJSONLoader","urlTree","load","asyncDeepMap","tree","func","mapSubtree","mapArray","mapObject","promises","all","urlArray","sampleSize","reset","samples","addCount","subtractCount","_count","_samples","_checkSampling","_time","lastTiming","_startTime","_timerPending","addTime","lastSampleCount","lastSampleTime","_initializeStats","seal","_getOrCreate","table","stat","average","getAverageTime","hz","getHz"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,I,yFC7E9C,SAAgBC,EAAgBC,GACrC,IAAKD,EACH,MAAM,IAAIE,MAAMD,GAAW,kC,cCN/B,IAOIE,EACAC,EARAC,EAAUtC,EAAOD,QAAU,GAU/B,SAASwC,IACL,MAAM,IAAIJ,MAAM,mCAEpB,SAASK,IACL,MAAM,IAAIL,MAAM,qCAsBpB,SAASM,EAAWC,GAChB,GAAIN,IAAqBO,WAErB,OAAOA,WAAWD,EAAK,GAG3B,IAAKN,IAAqBG,IAAqBH,IAAqBO,WAEhE,OADAP,EAAmBO,WACZA,WAAWD,EAAK,GAE3B,IAEI,OAAON,EAAiBM,EAAK,GAC/B,MAAME,GACJ,IAEI,OAAOR,EAAiBhC,KAAK,KAAMsC,EAAK,GAC1C,MAAME,GAEJ,OAAOR,EAAiBhC,KAAKyC,KAAMH,EAAK,MAvCnD,WACG,IAEQN,EADsB,mBAAfO,WACYA,WAEAJ,EAEzB,MAAOK,GACLR,EAAmBG,EAEvB,IAEQF,EADwB,mBAAjBS,aACcA,aAEAN,EAE3B,MAAOI,GACLP,EAAqBG,GAjB7B,GAwEA,IAEIO,EAFAC,EAAQ,GACRC,GAAW,EAEXC,GAAc,EAElB,SAASC,IACAF,GAAaF,IAGlBE,GAAW,EACPF,EAAaK,OACbJ,EAAQD,EAAaM,OAAOL,GAE5BE,GAAc,EAEdF,EAAMI,QACNE,KAIR,SAASA,IACL,IAAIL,EAAJ,CAGA,IAAIM,EAAUd,EAAWU,GACzBF,GAAW,EAGX,IADA,IAAIO,EAAMR,EAAMI,OACVI,GAAK,CAGP,IAFAT,EAAeC,EACfA,EAAQ,KACCE,EAAaM,GACdT,GACAA,EAAaG,GAAYO,MAGjCP,GAAc,EACdM,EAAMR,EAAMI,OAEhBL,EAAe,KACfE,GAAW,EAnEf,SAAyBS,GACrB,GAAIrB,IAAuBS,aAEvB,OAAOA,aAAaY,GAGxB,IAAKrB,IAAuBG,IAAwBH,IAAuBS,aAEvE,OADAT,EAAqBS,aACdA,aAAaY,GAExB,IAEWrB,EAAmBqB,GAC5B,MAAOd,GACL,IAEI,OAAOP,EAAmBjC,KAAK,KAAMsD,GACvC,MAAOd,GAGL,OAAOP,EAAmBjC,KAAKyC,KAAMa,KAgD7CC,CAAgBJ,IAiBpB,SAASK,EAAKlB,EAAKmB,GACfhB,KAAKH,IAAMA,EACXG,KAAKgB,MAAQA,EAYjB,SAASC,KA5BTxB,EAAQyB,SAAW,SAAUrB,GACzB,IAAIsB,EAAO,IAAIC,MAAMC,UAAUd,OAAS,GACxC,GAAIc,UAAUd,OAAS,EACnB,IAAK,IAAInD,EAAI,EAAGA,EAAIiE,UAAUd,OAAQnD,IAClC+D,EAAK/D,EAAI,GAAKiE,UAAUjE,GAGhC+C,EAAMmB,KAAK,IAAIP,EAAKlB,EAAKsB,IACJ,IAAjBhB,EAAMI,QAAiBH,GACvBR,EAAWa,IASnBM,EAAK/B,UAAU4B,IAAM,WACjBZ,KAAKH,IAAI0B,MAAM,KAAMvB,KAAKgB,QAE9BvB,EAAQ+B,MAAQ,UAChB/B,EAAQgC,SAAU,EAClBhC,EAAQiC,IAAM,GACdjC,EAAQkC,KAAO,GACflC,EAAQmC,QAAU,GAClBnC,EAAQoC,SAAW,GAInBpC,EAAQqC,GAAKb,EACbxB,EAAQsC,YAAcd,EACtBxB,EAAQuC,KAAOf,EACfxB,EAAQwC,IAAMhB,EACdxB,EAAQyC,eAAiBjB,EACzBxB,EAAQ0C,mBAAqBlB,EAC7BxB,EAAQ2C,KAAOnB,EACfxB,EAAQ4C,gBAAkBpB,EAC1BxB,EAAQ6C,oBAAsBrB,EAE9BxB,EAAQ8C,UAAY,SAAU5E,GAAQ,MAAO,IAE7C8B,EAAQ+C,QAAU,SAAU7E,GACxB,MAAM,IAAI2B,MAAM,qCAGpBG,EAAQgD,IAAM,WAAc,MAAO,KACnChD,EAAQiD,MAAQ,SAAUC,GACtB,MAAM,IAAIrD,MAAM,mCAEpBG,EAAQmD,MAAQ,WAAa,OAAO,I,8BCvLpC,YAAe,SAASC,IACtB,IAAIC,EAEJ,GAAsB,oBAAXC,QAA0BA,OAAOC,YAC1CF,EAAYC,OAAOC,YAAYC,WAC1B,QAAuB,IAAZxD,GAA2BA,EAAQyD,OAAQ,CAC3D,MAAMC,EAAY1D,EAAQyD,SAC1BJ,EAA2B,IAAfK,EAAU,GAAYA,EAAU,GAAK,SAEjDL,EAAYM,KAAKH,MAGnB,OAAOH,EAZT,oC,+BCAA,IAAIO,EAGJA,EAAI,WACH,OAAOrD,KADJ,GAIJ,IAECqD,EAAIA,GAAK,IAAIC,SAAS,cAAb,GACR,MAAOvD,GAEc,iBAAXgD,SAAqBM,EAAIN,QAOrC5F,EAAOD,QAAUmG,G,uFCnBV,SAAgBjE,EAAWC,GAChC,IAAKD,EACH,MAAM,IAAIE,MAAMD,K,kQCcb,SAASkE,EAAaC,GAC3B,IAAMC,EAASC,EAAmBF,GAClC,IAAKC,EACH,MAAM,IAAInE,MAAM,gBAElB,OAAOmE,EAOF,SAASE,EAAaH,GAC3B,OAAQD,EAAaC,IACnB,IAAK,OACH,OAAOA,EAET,IAAK,QACL,IAAK,cAEH,IAAMI,EAASC,SAASC,cAAc,UAEhCC,EAAUH,EAAOI,WAAW,MAClC,IAAKD,EACH,MAAM,IAAIzE,MAAM,gBASlB,OANAsE,EAAOK,MAAQT,EAAMS,MAErBL,EAAOM,OAASV,EAAMU,OAEtBH,EAAQI,UAAUX,EAAO,EAAG,GAErBO,EAAQJ,aAAa,EAAG,EAAGH,EAAMS,MAAOT,EAAMU,QAEvD,QACE,MAAM,IAAI5E,MAAM,iBAOtB,SAASoE,EAAmBF,GAC1B,MAA2B,oBAAhBY,aAA+BZ,aAAiBY,YAClD,cAEY,oBAAVC,OAAyBb,aAAiBa,MAC5C,QAELb,GAA0B,WAAjB,EAAOA,IAAsBA,EAAMc,MAAQd,EAAMS,OAAST,EAAMU,OACpE,OAEF,K,2DAnEF,SAAiBV,GACtB,OAAOe,QAAQb,EAAmBF,K,cAG7B,SAAqBA,GAC1B,OAAQD,EAAaC,IACnB,IAAK,cACFA,EAAsBgB,U,gCAetB,SAAsBhB,GAC3B,OAAOG,EAAaH,I,2HCnBC,S,kZCkBvB,IAAMiB,EAAU,CACdC,KAAsB,oBAATA,MAAwBA,KACrC3B,OAA0B,oBAAXA,QAA0BA,OACzC4B,YAA0B,IAAXA,GAA0BA,EACzCd,SAA8B,oBAAbA,UAA4BA,UAGzCe,EAAQH,EAAQC,MAAQD,EAAQ1B,QAAU0B,EAAQE,O,SACxD,IAAME,EAAUJ,EAAQ1B,QAAU0B,EAAQC,MAAQD,EAAQE,O,WAC1D,IAAMG,EAAUL,EAAQE,QAAUF,EAAQC,MAAQD,EAAQ1B,O,WAC1D,IAAMgC,EAAYN,EAAQZ,UAAY,G,aAI/B,IAAMmB,EAEQ,iBAAnB,IAAOvF,EAAP,cAAOA,KAA4C,qBAApBwF,OAAOxF,IAAmCA,EAAQgC,Q,cAE5E,IAAMyD,EAAoC,mBAAlBC,c,aAG/B,IAAMC,OACe,IAAZ3F,GAA2BA,EAAQmC,SAAW,YAAYyD,KAAK5F,EAAQmC,SACnE0D,EAAeF,GAAWG,WAAWH,EAAQ,KAAQ,E,+ICvB3D,SACLI,GAEA,IAAMC,EAAWC,EAAWF,GAC5B,OAUF,SAAwBA,GACtB,IAAMC,EAAWC,EAAWF,GAG5B,KADcC,EAASE,YAAc,IAA4C,aAAtCF,EAASG,UAAU,GA1B7C,IA4Bf,OAAO,KAIT,MAAO,CACLC,SAAU,YACV5B,MAAOwB,EAASG,UAAU,IAlCX,GAmCf1B,OAAQuB,EAASG,UAAU,IAnCZ,IAcfE,CAAeL,IAwEnB,SAAyBD,GACvB,IAAMC,EAAWC,EAAWF,GAQ5B,KAJEC,EAASE,YAAc,GACe,QAAtCF,EAASM,UAAU,GA5FJ,IA6FU,MAAzBN,EAASO,SAAS,IAGlB,OAAO,KAGT,MA6BF,WAIE,IADA,IAAMC,EAAe,IAAIC,IAAI,CAAC,MAAQ,MAAQ,MAAQ,MAAQ,QACrD9I,EAAI,MAAQA,EAAI,QAAUA,EACjC6I,EAAaE,IAAI/I,GAKnB,IAAMgJ,EAAa,IAAIF,IAAI,CACzB,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MAAQ,MACxF,MAAQ,QAGV,MAAO,CAACD,eAAcG,cA5CaC,GAA5BJ,EAAP,EAAOA,aAAcG,EAArB,EAAqBA,WAGjBhJ,EAAI,EACR,KAAOA,EAAI,EAAIqI,EAASE,YAAY,CAClC,IAAM9E,EAAS4E,EAASM,UAAU3I,GAxGnB,GA2Gf,GAAIgJ,EAAWE,IAAIzF,GACjB,MAAO,CACLgF,SAAU,aACV3B,OAAQuB,EAASM,UAAU3I,EAAI,GA9GpB,GA+GX6G,MAAOwB,EAASM,UAAU3I,EAAI,GA/GnB,IAoHf,IAAK6I,EAAaK,IAAIzF,GACpB,OAAO,KAITzD,GAAK,EACLA,GAAKqI,EAASM,UAAU3I,GA1HT,GA6HjB,OAAO,KA9GLmJ,CAAgBd,IA4BpB,SAAwBD,GACtB,IAAMC,EAAWC,EAAWF,GAG5B,KADcC,EAASE,YAAc,IAA4C,aAAtCF,EAASG,UAAU,GA9C7C,IAgDf,OAAO,KAIT,MAAO,CACLC,SAAU,YACV5B,MAAOwB,EAASM,UAAU,GArDR,GAsDlB7B,OAAQuB,EAASM,UAAU,GAtDT,IAelBS,CAAef,IACfgB,EAAehB,I,mBA6CZ,SAASgB,EAAejB,GAC7B,IAAMC,EAAWC,EAAWF,GAQ5B,OAJEC,EAASE,YAAc,IACe,QAAtCF,EAASM,UAAU,GApEJ,IAqEfN,EAASG,UAAU,GApED,KAoEuBH,EAASE,WAO7C,CACLE,SAAU,YACV5B,MAAOwB,EAASG,UAAU,IA7ER,GA8ElB1B,OAAQuB,EAASG,UAAU,IA9ET,IAuEX,KA2EX,SAASF,EAAWpB,GAClB,GAAIA,aAAgBoC,SAClB,OAAOpC,EAET,GAAIqC,YAAYC,OAAOtC,GACrB,OAAO,IAAIoC,SAASpC,EAAKuC,QAS3B,GAAIvC,aAAgBqC,YAClB,OAAO,IAAID,SAASpC,GAEtB,MAAM,IAAIhF,MAAM,gB,6ZC/KlB,IAAMmF,EAAU,CACdC,KAAsB,oBAATA,MAAwBA,KACrC3B,OAA0B,oBAAXA,QAA0BA,OACzC4B,YAA0B,IAAXA,GAA0BA,EACzCd,SAA8B,oBAAbA,UAA4BA,UAGzCe,EAA8BH,EAAQC,MAAQD,EAAQ1B,QAAU0B,EAAQE,QAAU,G,SACxF,IAAME,EAAgCJ,EAAQ1B,QAAU0B,EAAQC,MAAQD,EAAQE,QAAU,G,WAC1F,IAAMG,EAAgCL,EAAQE,QAAUF,EAAQC,MAAQD,EAAQ1B,QAAU,G,WAC1F,IAAMgC,EAAkCN,EAAQZ,UAAY,G,aAKrD,IAAMmB,EAEQ,iBAAnB,IAAOvF,EAAP,cAAOA,KAA4C,qBAApBwF,OAAOxF,IAAmCA,EAAQgC,Q,cAG5E,IAAMyD,EAA6C,mBAAlBC,c,aAGjC,IAAM2B,EACO,oBAAX/D,aAAwD,IAAvBA,OAAOgE,Y,aAGjD,IAAM3B,OACe,IAAZ3F,GAA2BA,EAAQmC,SAAW,YAAYyD,KAAK5F,EAAQmC,SAGnE0D,EAAuBF,GAAWG,WAAWH,EAAQ,KAAQ,E,uICnC1E,WACA,QACA,Q,8RAEA,IAAM4B,EAAO,aAWQC,E,WAenB,WAAYC,I,4FAA0B,iGAXhB,GAWgB,kGANP,IAO7B,IAAOvJ,EAAqBuJ,EAArBvJ,KAAMwJ,EAAeD,EAAfC,OAAQC,EAAOF,EAAPE,KACrB,IAAAC,QAAOF,GAAUC,GACjBpH,KAAKrC,KAAOA,EACZqC,KAAKmH,OAASA,EACdnH,KAAKoH,IAAMA,EACXpH,KAAKsH,UAAYN,EACjBhH,KAAKuH,QAAU,SAACC,GAAD,OAAWC,QAAQC,IAAIF,IAEtCxH,KAAK2H,OAAS3H,KAAK4H,uB,iDAbrB,WACE,MAAyB,oBAAXC,W,wBAmBhB,WACE7H,KAAKsH,UAAYN,EACjBhH,KAAKuH,QAAUP,EAEfhH,KAAK2H,OAAOG,YACZ9H,KAAK+H,YAAa,I,qBAGpB,WACE,OAAOxD,QAAQvE,KAAKsH,a,yBAQtB,SAAYhD,EAAW0D,GACrBA,EAAeA,IAAgB,IAAAC,iBAAgB3D,GAE/CtE,KAAK2H,OAAOO,YAAY5D,EAAM0D,K,qCAShC,SAAwBG,GAItB,IAAI9I,EAAU,kBAUd,OATAA,GAAW,UAAJ,OAAcW,KAAKrC,KAAnB,MACHwK,EAAM9I,UACRA,GAAW,GAAJ,OAAO8I,EAAM9I,QAAb,SAIL8I,EAAMC,SACR/I,GAAW,IAAJ,OAAQ8I,EAAMC,OAAd,YAAwBD,EAAME,QAEhC,IAAI/I,MAAMD,K,kCAMnB,WAAuB,WACrBW,KAAKsI,cAAe,IAAAC,sBAAqB,CAACpB,OAAQnH,KAAKmH,OAAQC,IAAKpH,KAAKoH,MACzE,IAAMO,EAAS,IAAIE,OAAO7H,KAAKsI,aAAc,CAAC3K,KAAMqC,KAAKrC,OAiBzD,OAfAgK,EAAOa,UAAY,SAACL,GACbA,EAAM7D,KAGT,EAAKgD,UAAUa,EAAM7D,MAFrB,EAAKiD,QAAQ,IAAIjI,MAAM,sBAM3BqI,EAAOc,QAAU,SAACjB,GAChB,EAAKD,QAAQ,EAAKmB,wBAAwBlB,IAC1C,EAAKO,YAAa,GAGpBJ,EAAOgB,eAAiB,SAACR,GAAD,OAAWV,QAAQD,MAAMW,IAE1CR,O,+SCxEX,SAASiB,EAAe9J,GACtB,QAAKA,IAGDA,aAAkB6H,cAGK,oBAAhBkC,aAA+B/J,aAAkB+J,cAGjC,oBAAhBzE,aAA+BtF,aAAkBsF,aAG7B,oBAApB0E,iBAAmChK,aAAkBgK,mB,mEA5C3D,SAASb,EACdnJ,GAGgB,IAFhBiK,IAEgB,yDADhBC,EACgB,uCAEVC,EAAeD,GAAa,IAAI9C,IAEtC,GAAKpH,GAEE,GAAI8J,EAAe9J,GACxBmK,EAAa9C,IAAIrH,QACZ,GAAI8J,EAAe9J,EAAO+H,QAE/BoC,EAAa9C,IAAIrH,EAAO+H,aACnB,GAAIF,YAAYC,OAAO9H,SAGvB,GAAIiK,GAA+B,WAAlB,EAAOjK,GAC7B,IAAK,IAAMH,KAAOG,EAEhBmJ,EAAgBnJ,EAAOH,GAAMoK,EAAWE,QAM5C,YAAqBC,IAAdF,EAA0B5H,MAAM+H,KAAKF,GAAgB,K,yGCnCvC,S,wICHvB,WACA,QACA,OACA,WACA,WACA,W,gaAIe,WAA0BG,EAAaC,EAAStF,GAAhD,8FAEPuF,GADND,EAAUA,GAAW,IACQ7F,OAAS,GAGhC+F,EAAYD,EAAaE,MAAQ,OAEhCpC,GAAOrD,GAAW,IAAlBqD,IAGDqC,EAAWC,EAAqBH,GAVzB,KAaLE,EAbK,OAcN,gBAdM,OAiBN,UAjBM,QAoBN,SApBM,0CAeK,aAAmBL,EAAaC,EAASjC,GAf9C,eAeT5D,EAfS,sDAkBK,aAAa4F,EAAaC,EAASjC,GAlBxC,eAkBT5D,EAlBS,sDAsBK,aAAiB4F,EAAaC,GAtBnC,eAsBT7F,EAtBS,qCAyBT,IAAA6D,SAAO,GAzBE,cA6BK,SAAdkC,IACF/F,GAAQ,IAAAG,cAAaH,IA9BV,kBAiCNA,GAjCM,6C,sBAqCf,SAASkG,EAAqBF,GAC5B,OAAQA,GACN,IAAK,OACL,IAAK,OAGH,OAAO,IAAAG,uBACT,QAGE,OADA,IAAAC,sBAAqBJ,GACdA,K,qGCzCN,SAA8BA,GACnC,OAAQA,GACN,IAAK,OAEH,OAAOK,GAA0BC,GAAmBC,EAEtD,IAAK,cACH,OAAOF,EACT,IAAK,QACH,OAAOC,EACT,IAAK,OACH,OAAOC,EAET,QACE,MAAM,IAAIzK,MAAJ,oCAAuCkK,EAAvC,yC,sBAQL,WACL,GAAIK,EACF,MAAO,cAET,GAAIC,EACF,MAAO,QAET,GAAIC,EACF,MAAO,OAIT,MAAM,IAAIzK,MAAM,kEAhDlB,WAGO0K,EAAmBrF,SAAnBqF,gBAEDF,EAAmC,oBAAVzF,MACzBwF,EAAgD,oBAAhBzF,YAChC6F,EAAuB1F,QAAQyF,GAC/BD,IAAiB/E,aAAmBiF,G,wJCT1C,Y,6WAGe,WAA4Bb,EAAaC,EAASjC,GAAlD,iGAKP8C,GAAgB,IAAAC,qBAAoBf,EAAahC,GACjDgD,EAAM1F,KAAK0F,KAAO1F,KAAK2F,UACvBC,EAAqC,iBAAlBJ,GAA8BE,EAAIG,gBAAgBL,GAP9D,kBASEM,EAAYF,GAAaJ,EAAeb,GAT1C,+DAWPiB,GACFF,EAAIK,gBAAgBH,GAZX,0E,+BAiBOE,E,qFAAf,WAA2BpD,EAAKiC,GAAhC,0FACC7F,EAAQ,IAAIa,OACZqG,IAAMtD,IASRiC,EAAQ7F,OAAS6F,EAAQ7F,MAAMmH,QAAUnH,EAAMmH,QAX9C,gCAYGnH,EAAMmH,SAZT,gCAaInH,GAbJ,uBAiBQ,IAAIoH,SAAQ,SAACC,EAASC,GACjC,IACEtH,EAAMuH,OAAS,kBAAMF,EAAQrH,IAC7BA,EAAMiF,QAAU,SAACuC,GAAD,OAASF,EAAO,IAAIxL,MAAJ,+BAAkC8H,EAAlC,aAA0C4D,MAC1E,MAAOxD,GACPsD,EAAOtD,OAtBN,oF,sICVA,SAA6B4B,EAAahC,GAC/C,GAAI6D,EAAM7D,GAAM,CAEd,IACM8D,GADc,IAAIC,aACIR,OAAOvB,GAOnC,MADY,6BAAH,OAAgCgC,KAAKF,IAGhD,OAAOG,EAAQjC,EAAahC,I,YApB9B,IAAMkE,EAAuB,wBACvBC,EAAkB,oBAEjB,SAASN,EAAM7D,GACpB,OAAOA,IAAQkE,EAAqBE,KAAKpE,IAAQmE,EAAgBC,KAAKpE,IAmBjE,SAASiE,EAAQjC,EAAahC,GACnC,GAAI6D,EAAM7D,GAGR,MAAM,IAAI9H,MAAM,gDAGlB,OAAO,IAAImM,KAAK,CAAC,IAAIC,WAAWtC,O,uFC7B3B,SAAgBhK,EAAgBC,GACrC,IAAKD,EACH,MAAM,IAAIE,MAAMD,GAAW,8B,quDCL/B,WAcA,OACA,OAGA,WACA,WAGA,WACA,WACA,WAEA,QACA,QAGA,QACA,QACA,QAGA,QAGA,WAGA,W,mDAKO,IAAMsM,EAA2B,CACtCC,GAAI,OACJjO,KAAM,OACNR,OAAQ,eACRyE,QAASiK,UACTxC,QAAS,CACPyC,KAAM,K,+GCnDV,W,kSAKqBC,E,WAUnB,WAAYC,EAAiBC,GAA4B,Y,4FAAA,mKACvDjM,KAAKrC,KAAOqO,EACZhM,KAAKiM,aAAeA,EACpBjM,KAAKkM,WAAY,EACjBlM,KAAKmM,SAAW,aAChBnM,KAAKoM,QAAU,aACfpM,KAAKqM,OAAS,IAAIzB,SAAQ,SAACC,EAASC,GAClC,EAAKqB,SAAWtB,EAChB,EAAKuB,QAAUtB,K,kDAQnB,SAAYtB,EAAyB8C,GACnCtM,KAAKiM,aAAa/D,YAAY,CAC5Bf,OAAQ,aACRqC,OACA8C,c,kBAOJ,SAAKjO,IACH,IAAAgJ,QAAOrH,KAAKkM,WACZlM,KAAKkM,WAAY,EACjBlM,KAAKmM,SAAS9N,K,mBAMhB,SAAMmJ,IACJ,IAAAH,QAAOrH,KAAKkM,WACZlM,KAAKkM,WAAY,EACjBlM,KAAKoM,QAAQ5E,Q,4ICxDjB,eACA,W,o6DAYA,IAAM+E,EAAiC,CACrCC,eAAgB,EAChBC,qBAAsB,EACtBC,QAAS,aACTC,cAAc,GAMKC,E,WAmBnB,WAAoB1F,I,4FAAwB,qDAjBtB,IAAI2F,KAkBxB7M,KAAKkH,MAAL,KAAiBqF,GACjBvM,KAAK8M,SAAS5F,GAEdlH,KAAK+M,YAAc,IAAIF,I,iDAhBzB,WACE,OAAO5F,UAAa+F,gB,2BAItB,WAA8D,IAAzC9F,EAAyC,uDAAhB,GAG5C,OAFA0F,EAAWK,YAAcL,EAAWK,aAAe,IAAIL,EAAW,IAClEA,EAAWK,YAAYH,SAAS5F,GACzB0F,EAAWK,gB,wBAepB,WAAgB,UACWjN,KAAK+M,YAAYG,UAD5B,IACd,2BAAoD,QACvCC,UAFC,iC,sBAUhB,SAASjG,GACPlH,KAAKkH,MAAL,OAAiBlH,KAAKkH,OAAUA,GADK,UAGZlH,KAAK+M,YAAYG,UAHL,IAGrC,2BAAoD,QACvCJ,SAAS9M,KAAKoN,uBAJU,iC,2BAiBvC,SAAc/D,GACZ,IAAO1L,EAAqB0L,EAArB1L,KAAMwJ,EAAekC,EAAflC,OAAQC,EAAOiC,EAAPjC,IACjBiG,EAAarN,KAAK+M,YAAY9O,IAAIN,GAUtC,OATK0P,KACHA,EAAa,IAAIC,UAAW,CAC1B3P,OACAwJ,SACAC,SAES0F,SAAS9M,KAAKoN,uBACzBpN,KAAK+M,YAAYQ,IAAI5P,EAAM0P,IAEtBA,I,iCAGT,WACE,MAAO,CACLb,eAAgBxM,KAAKkH,MAAMsF,eAC3BC,qBAAsBzM,KAAKkH,MAAMuF,qBACjCE,aAAc3M,KAAKkH,MAAMyF,aACzBD,QAAS1M,KAAKkH,MAAMwF,c,8CA7ELE,E,sHCtBrB,WACA,WACA,W,gtCAqCqBU,E,WAmBnB,WAAYpG,I,4FAAwB,uBAlBrB,WAkBqB,qEAfX,GAeW,8BAdL,GAcK,kBAbW,eAaX,uBAZZ,GAYY,eAVH,IAUG,kBATJ,IASI,mBARA,IAQA,eAPpB,GAOoB,sBANd,GAOpBlH,KAAKmH,OAASD,EAAMC,OACpBnH,KAAKoH,IAAMF,EAAME,IACjBpH,KAAK8M,SAAS5F,G,kDAOhB,WAEElH,KAAKwN,UAAUC,SAAQ,SAAC9F,GAAD,OAAYA,EAAOwF,aAC1CnN,KAAK0N,aAAc,I,sBAGrB,SAASxG,GACPlH,KAAKkH,MAAL,OAAiBlH,KAAKkH,OAAUA,QAEbgC,IAAfhC,EAAMvJ,OACRqC,KAAKrC,KAAOuJ,EAAMvJ,WAESuL,IAAzBhC,EAAMsF,iBACRxM,KAAKwM,eAAiBtF,EAAMsF,qBAEKtD,IAA/BhC,EAAMuF,uBACRzM,KAAKyM,qBAAuBvF,EAAMuF,2BAETvD,IAAvBhC,EAAMyF,eACR3M,KAAK2M,aAAezF,EAAMyF,mBAENzD,IAAlBhC,EAAMwF,UACR1M,KAAK0M,QAAUxF,EAAMwF,W,oDAIzB,WACE/O,GADF,oHAEE2J,EAFF,+BAEyB,SAACqG,EAAKnE,EAAMlF,GAAZ,OAAqBqJ,EAAIC,KAAKtJ,IACrDiD,EAHF,+BAGqB,SAACoG,EAAKnG,GAAN,OAAgBmG,EAAInG,MAAMA,IAGvCqG,EAAe,IAAIjD,SAAmB,SAACkD,GAG3C,OADA,EAAKC,SAASzM,KAAK,CAAC3D,OAAM2J,YAAWC,UAASuG,YACvC,KAET9N,KAAKgO,kBAXP,SAYeH,EAZf,wF,yGAqBA,0GACO7N,KAAK+N,SAASxN,OADrB,oDAKQ0L,EAAejM,KAAKiO,sBAL5B,sDAWQC,EAAYlO,KAAK+N,SAASI,SAXlC,wBAeInO,KAAK0M,QAAQ,CACXrN,QAAS,eACT1B,KAAMuQ,EAAUvQ,KAChBsO,eACAmC,QAASpO,KAAK+N,SAASxN,SAInBoN,EAAM,IAAI5B,UAAUmC,EAAUvQ,KAAMsO,GAG1CA,EAAa3E,UAAY,SAAChD,GAAD,OAAU4J,EAAU5G,UAAUqG,EAAKrJ,EAAKkF,KAAMlF,EAAKgI,UAC5EL,EAAa1E,QAAU,SAACC,GAAD,OAAW0G,EAAU3G,QAAQoG,EAAKnG,IAGzD0G,EAAUJ,QAAQH,GA9BtB,oBAkCYA,EAAItB,OAlChB,yBAoCMrM,KAAKqO,oBAAoBpC,GApC/B,4E,8EAiDA,SAAoBtE,GAEhB3H,KAAK0N,cAAgB1N,KAAK2M,cAAgB3M,KAAKsO,MAAQtO,KAAKuO,sBAG5D5G,EAAOwF,UACPnN,KAAKsO,SAELtO,KAAKwN,UAAUlM,KAAKqG,GAGjB3H,KAAK0N,aACR1N,KAAKgO,oB,iCAOT,WAEE,GAAIhO,KAAKwN,UAAUjN,OAAS,EAC1B,OAAOP,KAAKwN,UAAUW,SAAW,KAInC,GAAInO,KAAKsO,MAAQtO,KAAKuO,qBAAsB,CAC1CvO,KAAKsO,QACL,IAAM3Q,EAAO,GAAH,OAAMqC,KAAKrC,KAAK6Q,cAAhB,cAAmCxO,KAAKsO,MAAxC,eAAoDtO,KAAKwM,eAAzD,KACV,OAAO,IAAIvF,UAAa,CAACtJ,OAAMwJ,OAAQnH,KAAKmH,OAAQC,IAAKpH,KAAKoH,MAIhE,OAAO,O,gCAGT,WACE,OAAON,WAAW9G,KAAKyM,qBAAuBzM,KAAKwM,oB,4ICzMvD,Y,sKAEA,IAAMiC,EAAsB,IAAI5B,IAKX6B,E,2KAInB,SAAqBpH,GAEnB5C,KAAK8D,UAAY,SAACnJ,GAChB,GAAKsP,EAAetP,GAApB,CAKA,MAAwBA,EAAQiF,KAAzBkF,EAAP,EAAOA,KAAM8C,EAAb,EAAaA,QACbhF,EAAUkC,EAAM8C,O,8BAIpB,SACEhF,GAEA,IAAIsH,EAAmBH,EAAoBxQ,IAAIqJ,GAE1CsH,IACHA,EAAmB,SAACvP,GAClB,GAAKsP,EAAetP,GAApB,CAKA,MAAwBA,EAAQiF,KAAzBkF,EAAP,EAAOA,KAAM8C,EAAb,EAAaA,QACbhF,EAAUkC,EAAM8C,MAKpB5H,KAAKmK,iBAAiB,UAAWD,K,iCAGnC,SACEtH,GAEA,IAAMsH,EAAmBH,EAAoBxQ,IAAIqJ,GACjDmH,EAAmB,OAAQnH,GAE3B5C,KAAKoK,oBAAoB,UAAWF,K,yBAQtC,SAAmBpF,EAAyB8C,GAC1C,GAAI5H,KAAM,CACR,IAAMJ,EAA0B,CAAC6C,OAAQ,aAAcqC,OAAM8C,WACvDtE,GAAe,IAAAC,iBAAgBqE,GAGrC5H,KAAKwD,YAAY5D,EAAM0D,Q,yCAM7B,SAAS2G,EAAetP,GACtB,IAAOmK,EAAcnK,EAAdmK,KAAMlF,EAAQjF,EAARiF,KACb,MACW,YAATkF,GACAlF,GACuB,iBAAhBA,EAAK6C,QACZ7C,EAAK6C,OAAO4H,WAAW,c,2GCpEpB,SAAuBpH,GAC5B,IAAMqH,EANQ,UAMErH,EAAO/F,QAAP,yBANF,QAME,KAA4D,GAC5E,gBAAU+F,EAAOhK,KAAjB,YAAyBgK,EAAO/F,SAAhC,OAA0CoN,I,eAUrC,SAAsBrH,GAA2D,IAArC0B,EAAqC,uDAAZ,GACpE4F,EAAgB5F,EAAQ1B,EAAOiE,KAAO,GAEtCsD,EAAa,GAAH,OAAMvH,EAAOiE,GAAb,cAEZxE,EAAM6H,EAAcE,UAII,SAAxB9F,EAAQ+F,cACVhI,EAAM,WAAH,OAAcO,EAAOxK,OAArB,iBAAoC+R,IAIzC,IAAK9H,EAAK,CAER,IAAIxF,EAAU+F,EAAO/F,QAEL,WAAZA,IAEFA,EAtCU,UAwCZ,IAAMyN,EAAazN,EAAU,IAAH,OAAOA,GAAY,GAC7CwF,EAAM,iCAAH,OAAoCO,EAAOxK,QAA3C,OAAoDkS,EAApD,iBAAuEH,GAM5E,OAHA,IAAA7H,QAAOD,GAGAA,GAlDT,WACA,M,qYCyBGjJ,OAAOmR,c,IAZWC,E,WAKnB,c,4FAAc,sFACZvP,KAAKwP,QAAU,GACfxP,KAAKyP,UAAY,GACjBzP,KAAK0P,SAAU,E,sCAIjB,WACE,OAAO1P,O,kBAIT,SAAK3B,GACH,OAAO2B,KAAK2P,QAAQtR,K,qBAOtB,SAAQA,GACN,GAAI2B,KAAK0P,QACP,MAAM,IAAIpQ,MAAM,UAGlB,GAAIU,KAAKyP,UAAUlP,OAAS,EAAG,CAC7B,GAAIP,KAAKwP,QAAQjP,OAAS,EACxB,MAAM,IAAIjB,MAAM,0BAElB,IAAMsQ,EAAU5P,KAAKyP,UAAUtB,QAC3B9P,aAAiBiB,MACnBsQ,EAAQ9E,OAAOzM,GAEfuR,EAAQ/E,QAAQ,CAACxM,eAGnB2B,KAAKwP,QAAQlO,KAAKjD,K,mBAKtB,WACE,KAAO2B,KAAKyP,UAAUlP,OAAS,GACbP,KAAKyP,UAAUtB,QACvBtD,QAAQ,CAAC+C,MAAM,IAEzB5N,KAAK0P,SAAU,I,kBAMjB,WAAwC,WAEtC,GAAI1P,KAAKwP,QAAQjP,OAAS,EAAG,CAC3B,IAAMlC,EAAQ2B,KAAKwP,QAAQrB,QAC3B,OAAI9P,aAAiBiB,MACZsL,QAAQE,OAAOzM,GAEjBuM,QAAQC,QAAQ,CAAC+C,MAAM,EAAOvP,UAIvC,GAAI2B,KAAK0P,QAAS,CAChB,GAAI1P,KAAKyP,UAAUlP,OAAS,EAC1B,MAAM,IAAIjB,MAAM,0BAElB,OAAOsL,QAAQC,QAAQ,CAAC+C,MAAM,EAAMvP,WAAO6K,IAI7C,OAAO,IAAI0B,SAAQ,SAACC,EAASC,GAC3B,EAAK2E,UAAUnO,KAAK,CAACuJ,UAASC,mB,0FC/E7B,SAAS+E,EACdzG,EACA0G,EACAvP,GAEA,GAAI6I,EAAYzD,YAAcmK,EAAavP,EACzC,MAAO,GAIT,IAFA,IAAMkF,EAAW,IAAIiB,SAAS0C,GAC1B2G,EAAQ,GACH3S,EAAI,EAAGA,EAAImD,EAAQnD,IAC1B2S,GAAS9K,OAAO+K,aAAavK,EAASO,SAAS8J,EAAa1S,IAE9D,OAAO2S,E,sEA1BF,SAA4BzL,GAA0B,IAApB/D,EAAoB,uDAAX,EAChD,GAAoB,iBAAT+D,EACT,OAAOA,EAAK2L,MAAM,EAAG1P,GAChB,GAAIoG,YAAYC,OAAOtC,GAE5B,OAAOuL,EAAevL,EAAKuC,OAAQvC,EAAKwL,WAAYvP,GAC/C,GAAI+D,aAAgBqC,YAAa,CACtC,IAAMmJ,EAAa,EACnB,OAAOD,EAAevL,EAAMwL,EAAYvP,GAE1C,MAAO,I,kHCJF,SAAuB+D,GAExB4L,EAAKC,gBAEP7L,EAAO4L,EAAKC,cAAc7L,IAG5B,GAAIA,aAAgBqC,YAClB,OAAOrC,EAIT,GAAIqC,YAAYC,OAAOtC,GACrB,OAAOA,EAAKuC,OAGd,GAAoB,iBAATvC,EAAmB,CAC5B,IAAM8L,EAAO9L,EAEb,OADmB,IAAI+L,aAAcC,OAAOF,GAC1BvJ,OAIpB,GAAIvC,GAAwB,WAAhB,EAAOA,IAAqBA,EAAKiM,eAC3C,OAAOjM,EAAKiM,iBAGd,MAAM,IAAIjR,MAAM,kB,sBASX,SACLkR,EACAC,EACA9K,GAGA,GADAA,EAAaA,GAAc6K,EAAa7K,WACpC6K,EAAa7K,WAAaA,GAAc8K,EAAa9K,WAAaA,EACpE,OAAO,EAIT,IAFA,IAAM+K,EAAS,IAAIhF,WAAW8E,GACxBG,EAAS,IAAIjF,WAAW+E,GACrBrT,EAAI,EAAGA,EAAIsT,EAAOnQ,SAAUnD,EACnC,GAAIsT,EAAOtT,KAAOuT,EAAOvT,GACvB,OAAO,EAGX,OAAO,G,0BAOF,WAAwF,2BAApDwT,EAAoD,yBAApDA,EAAoD,gBAE7F,IAF6F,EAEvFC,EAAeD,EAAQE,KAAI,SAACC,GAAD,OAC/BA,aAAmBpK,YAAc,IAAI+E,WAAWqF,GAAWA,KAIvDpL,EAAakL,EAAaG,QAAO,SAACzQ,EAAQ0Q,GAAT,OAAwB1Q,EAAS0Q,EAAWtL,aAAY,GAGzF0G,EAAS,IAAIX,WAAW/F,GAG1BuL,EAAS,EAbgF,IAcnEL,GAdmE,IAc7F,2BAAwC,KAA7BM,EAA6B,QACtC9E,EAAOkB,IAAI4D,EAAaD,GACxBA,GAAUC,EAAYxL,YAhBqE,8BAoB7F,OAAO0G,EAAOxF,Q,yBAST,WAA2D,2BAArBuK,EAAqB,yBAArBA,EAAqB,gBAEhE,IAAMC,EAASD,EAETE,EAAyBD,GAAUA,EAAO9Q,OAAS,GAAK8Q,EAAO,GAAGE,aAAgB,KACxF,IAAKD,EACH,MAAM,IAAIhS,MACR,wGAQJ,IAJA,IAAMkS,EAAYH,EAAOL,QAAO,SAACS,EAAKpT,GAAN,OAAgBoT,EAAMpT,EAAMkC,SAAQ,GAE9D8L,EAAS,IAAIiF,EAAsBE,GACrCN,EAAS,EACb,MAAoBG,EAApB,eAA4B,CAAvB,IAAMrQ,EAAK,KACdqL,EAAOkB,IAAIvM,EAAOkQ,GAClBA,GAAUlQ,EAAMT,OAElB,OAAO8L,G,mBASF,SACLjD,EACA0G,EACAnK,GAEA,IAAM+L,OACWxI,IAAfvD,EACI,IAAI+F,WAAWtC,GAAauI,SAAS7B,EAAYA,EAAanK,GAC9D,IAAI+F,WAAWtC,GAAauI,SAAS7B,GAE3C,OADkB,IAAIpE,WAAWgG,GAChB7K,QAnInB,M,ybAAA,Q,0/CCoBO,SACL+K,EACAC,EACA/B,GAEa,IADbnK,EACa,uDADQkM,EAAalM,WAE5BmM,EAAc,IAAIpG,WAAWkG,EAAc9B,EAAYnK,GACvDwL,EAAc,IAAIzF,WAAWmG,GAEnC,OADAC,EAAYvE,IAAI4D,GACTS,G,cAWF,SAAqBzK,EAA2B4K,EAAaC,GAClE,IAAIb,EAEJ,GAAIhK,aAAkBR,YACpBwK,EAAc,IAAIzF,WAAWvE,OACxB,CAOL,IAAM8K,EAAgB9K,EAAO2I,WACvBoC,EAAgB/K,EAAOxB,WAG7BwL,EAAc,IAAIzF,WAAWvE,EAAON,QAAUM,EAAOiC,YAAa6I,EAAeC,GAMnF,OAFAH,EAAOxE,IAAI4D,EAAaa,GAEjBA,EAAeG,EAAYhB,EAAYxL,WAAY,IA/D5D,YASO,SAASwM,EAAYxM,EAAoByM,GAG9C,OAFA,IAAA/K,QAAO1B,GAAc,IACrB,IAAA0B,QAAO+K,EAAU,GACTzM,GAAcyM,EAAU,KAAQA,EAAU,K,0CCXpD,IAAMC,EAAgBC,EAAQ,IACxBC,EAA4B,oBAAXxP,OAAyB4B,EAAS5B,OACzDwP,EAAQC,QAAUD,EAAQC,SAAW,GACrCrV,EAAOD,QAAUY,OAAO2U,OAAOF,EAAQC,QAASH,K,yiCCAhD,YACA,QAKA,OAGA,QAEA,OAQA,S,2HCtBA,I,EAAA,QACA,G,EAAA,Q,2BACA,OAEA,IAeaK,EAAc,CACzB9G,GAAI,QACJzO,OAAQ,SACRQ,KAAM,SACNiE,QAASiK,UACT8G,UAnBiB,CACjB,YACA,aACA,YACA,aACA,YACA,2BACA,iBAaAC,WArBiB,CAAC,MAAO,MAAO,OAAQ,MAAO,OAAQ,MAAO,MAAO,OAsBrEC,MAAOC,UAEPC,MAAO,CAAC,SAAC3J,GAAD,OAAiB7E,SAAQ,IAAAyO,wBAAuB,IAAItM,SAAS0C,OACrEC,QAAS,CACP7F,MAAO,CACLgG,KAAM,OACNmB,QAAQ,K,gBAMP,IAAMsI,EAA0CP,E,mKCvCvD,I,EAAA,QACA,G,EAAA,Q,uVAEA,IAAMQ,EAAe,GAEjBC,GAA8B,E,iDASnB,WAAkC/J,EAAaC,EAASjC,GAAxD,+FAIT,IAAA6D,OAAM7D,GAJG,iCAMS,aAAagC,EAAaC,EAASjC,GAN5C,OAML5D,EANK,OAOX4P,EAAO5P,EAPI,sBAUX4P,GAAO,IAAA/H,SAAQjC,EAAahC,GAVjB,cAaPiM,EAAqBhK,GAAWA,EAAQiK,YAbjC,UAeAC,EAAsBH,EAAMC,GAf5B,sF,+BAwBAE,E,mFAAf,WAAqCH,GAArC,sGACMI,EADqCH,EAA3C,+BAAgE,OACpBF,IACxCE,EAAqB,OAGnBA,EALN,0CAQmBI,kBAAkBL,EAAMC,GAR3C,wEAUM5L,QAAQiM,KAAR,MACAP,GAA8B,EAXpC,yBAeeM,kBAAkBL,GAfjC,mG,sBAkBA,SAASI,EAAc1U,GACrB,IAAK,IAAMH,KAAOG,GAAUoU,EAC1B,OAAO,EAET,OAAO,I,wFCvDM,SAA0B9J,EAAaC,GACpD,IAAOxD,IAAY,IAAAmN,wBAAuB5J,IAAgB,IAAnDvD,SAGAmE,EAAmBrF,SAAnBqF,gBAGP,OAFA,IAAA3C,QAAO2C,GAEAA,EAAgBZ,EAAavD,EAAUwD,IAZhD,WACA,OACA,Q,mGCDA,YACA,QAEasK,EAAc,CACzBhW,KAAM,SACNiO,GAAI,QACJzO,OAAQ,SACRyE,QAASiK,UACT+G,WAAY,CAAC,QACbvJ,QAAS,CACP7F,MAAO,CACLqC,SAAU,YACV+N,YAAa,OAGjBtD,OAAQuD,e,2JCfV,WACA,O,4TAGA,IAAOC,EAAoBnP,SAApBmP,iB,iDAUA,WACLtQ,EACA6F,GAFK,uFAILA,EAAUA,GAAW,IACb7F,MAAQ6F,EAAQ7F,OAAU,GAL7B,kBAOEsQ,EACHA,EAAiBtQ,EAAO,CAACgG,KAAMH,EAAQ7F,MAAMqC,WAC7CkO,EAAqBvQ,EAAO6F,IAT3B,4C,sBAaP,IAAI2K,GAAwB,E,SASbD,E,qFAAf,WAAoCvQ,EAAO6F,GAA3C,6GACkCA,EAAQ7F,MAAjCqC,EADT,EACSA,SAAU+N,EADnB,EACmBA,YADnB,GAG0B,IAAAK,cAAazQ,GAA9BS,EAHT,EAGSA,MAAOC,EAHhB,EAGgBA,QAGRN,EAASC,SAASC,cAAc,WAC/BG,MAAQA,EACfL,EAAOM,OAASA,EAEhBgQ,EAAkB1Q,EAAOI,GAV3B,SAaqB,IAAIgH,SAAqB,SAACC,GAE3C,GAAI+I,GAAeI,EACjB,IAEE,YADApQ,EAAOuQ,OAAOtJ,EAAShF,EAAU+N,GAEjC,MAAOpM,GACPwM,GAAwB,EAG5BpQ,EAAOuQ,OAAOtJ,EAAShF,MAvB3B,UAaQuN,EAbR,8BA2BU,IAAI9T,MAAM,yBA3BpB,yBA8Be8T,EAAKhK,cA9BpB,sF,sBAiCA,SAAS8K,EAAkB1Q,EAAOI,GAAsB,IAAdwQ,EAAc,uDAAV,EAAGC,EAAO,uDAAH,EAEnD,GAAU,IAAND,GAAiB,IAANC,GAAkC,oBAAhBjQ,aAA+BZ,aAAiBY,YAAa,CAC5F,IAAML,EAAUH,EAAOI,WAAW,kBAClC,GAAID,EAGF,OADAA,EAAQuQ,wBAAwB9Q,GACzBI,EAKX,IAAMG,EAAUH,EAAOI,WAAW,MAClC,GAAIR,EAAMc,KAAM,CAEd,IAAMiQ,EAAe,IAAIC,kBAAkBhR,EAAMc,MAC3CmQ,EAAY,IAAIC,UAAUH,EAAc/Q,EAAMS,MAAOT,EAAMU,QAEjE,OADAH,EAAQ4Q,aAAaF,EAAW,EAAG,GAC5B7Q,EAKT,OADAG,EAAQI,UAAUX,EAAO,EAAG,GACrBI,I,wKC7FT,I,EAAA,OACA,G,EAAA,Q,2BACA,OACA,QACA,Q,oiCAEO,WAAyBgR,GAAzB,2GAAiCvL,EAAjC,+BAA2C,GAA3C,SACmBwL,EAAaD,EAAQvL,GADxC,cACCyL,EADD,iBAEQ,IAAAC,UAASD,EAAWhC,UAAYzJ,GAFxC,oF,+BAKewL,E,qFAAf,WAA4BD,EAAQvL,GAApC,uGAA6C2L,EAA7C,+BAA0D,GAE1C,KADfC,EAAa5L,GAAWA,EAAQ7F,OAAS6F,EAAQ7F,MAAMyR,WAAc,GADtE,gCAGKC,EAAsBN,EAAQK,EAAW5L,EAAS2L,GAHvD,+CAID,IAAAG,aAAYP,EAAQvL,EAAS2L,GAJ5B,mF,+BAOQE,E,yFAAf,WAAqCN,EAAQK,EAAW5L,EAAS2L,GAAjE,uGACQI,EAAiB,GAGL,SAAdH,EAJN,uBAKU7N,GAAM,IAAA+N,aAAYP,EAAQvL,EAApB,OAAiC2L,GAAjC,IAA6CK,IAAK,KALlE,UAMwB,IAAAC,aAAYlO,EAAK0L,UAAYzJ,GANrD,OAMU7F,EANV,UAQ4B,IAAAyQ,cAAazQ,GAA9BS,EARX,EAQWA,MAAOC,EARlB,EAQkBA,OACd+Q,EAAYM,EAAa,CAACtR,QAAOC,WAGjCkR,EAAK9T,KAAK8F,GAZd,OAkBE,KAFA,IAAAC,QAAO4N,EAAY,GAEVO,EAAWJ,EAAK7U,OAAQiV,EAAWP,IAAaO,EACjDpO,GAAM,IAAA+N,aAAYP,EAAQvL,EAApB,OAAiC2L,GAAjC,IAA6CK,IAAKG,KAC9DJ,EAAK9T,KAAK8F,GApBd,yBAuBSgO,GAvBT,6C,sBA2BO,SAASG,EAAT,GAAuC,IAAhBtR,EAAgB,EAAhBA,MAAOC,EAAS,EAATA,OACnC,OAAO,EAAIuR,KAAKC,MAAMD,KAAKE,KAAKF,KAAKG,IAAI3R,EAAOC,O,4FC1C3C,SAAqB0Q,EAAQvL,EAAS2L,GAE3C,IAAI5N,EAAMwN,EACY,mBAAXA,IACTxN,EAAMwN,EAAO,EAAD,KAAKvL,GAAY2L,MAE/B,IAAA3N,QAAsB,iBAARD,GAGd,IAAOyO,EAAWxM,EAAXwM,QACHA,IACFzO,EAAsC,MAAhCyO,EAAQA,EAAQtV,OAAS,GAAzB,UAAyCsV,GAAzC,OAAmDzO,GAAnD,UAA8DyO,EAA9D,YAAyEzO,IAGjF,OAAO,IAAA0O,aAAY1O,IAlBrB,YACA,O,+lKCeA,I,EAAA,QACA,QAWA,QACA,QAGA,QAGA,QAOA,QACA,QAIA,QAKA,QAGA,QAMA,QAGA,G,EAAA,Q,2BAGA,W,SAEA,YAIA,W,OAIA,YAEA,Q,88BC3EA,IAAM3C,EAAU,CACdC,KAAsB,oBAATA,MAAwBA,KACrC3B,OAA0B,oBAAXA,QAA0BA,OACzC4B,YAA0B,IAAXA,GAA0BA,EACzCd,SAA8B,oBAAbA,UAA4BA,UAIzCe,EAAaH,EAAQC,MAAQD,EAAQ1B,QAAU0B,EAAQE,QAAU,G,SACvE,IAAME,EAAeJ,EAAQ1B,QAAU0B,EAAQC,MAAQD,EAAQE,QAAU,G,WACzE,IAAMG,EAAeL,EAAQE,QAAUF,EAAQC,MAAQD,EAAQ1B,QAAU,G,WACzE,IAAMgC,EAAiBN,EAAQZ,UAAY,G,aAKpC,IAAMmB,EAEQ,iBAAnB,IAAOvF,EAAP,cAAOA,KAA4C,qBAApBwF,OAAOxF,IAAmCA,EAAQgC,Q,cAG5E,IAAMyD,EAA6C,mBAAlBC,c,aAGxC,IAAMC,OACe,IAAZ3F,GAA2BA,EAAQmC,SAAW,YAAYyD,KAAK5F,EAAQmC,SAEnE0D,EAAuBF,GAAWG,WAAWH,EAAQ,KAAQ,E,2ICpBnE,SAA4B2Q,GAEjC,GAAoB,oBAATrR,KACT,OAGFgK,aAAWlG,UAAX,4CAAuB,WAAOgB,EAAM8C,GAAb,mGACb9C,EADa,OAEd,YAFc,uCAMRwM,EAAuB1J,EAAvB0J,MANQ,EAMe1J,EAAhBjD,eANC,MAMS,GANT,WAQM4M,EAAU,CAC7BF,SACA3M,YAAa4M,EACb3M,UACAtF,QAAS,CACP8O,MAAOqD,KAbI,OAQT7J,EARS,OAgBfqC,aAAWxG,YAAY,OAAQ,CAACmE,WAhBjB,kDAkBThN,EAAU,gBAAiBC,MAAQ,KAAMD,QAAU,GACzDqP,aAAWxG,YAAY,QAAS,CAACV,MAAOnI,IAnBzB,8FAAvB,yDAfF,Y,m/BAGA,IAAI8W,EAAY,EAuChB,SAASD,EAAkB9M,EAA0BC,GACnD,OAAO,IAAIuB,SAAQ,SAACC,EAASC,GAC3B,IAAMc,EAAKuK,IA0BXzH,aAAWG,kBAtBO,SAAZvH,EAAakC,EAAM8C,GACvB,GAAIA,EAAQV,KAAOA,EAKnB,OAAQpC,GACN,IAAK,OACHkF,aAAWI,oBAAoBxH,GAC/BuD,EAAQyB,EAAQD,QAChB,MAEF,IAAK,QACHqC,aAAWI,oBAAoBxH,GAC/BwD,EAAOwB,EAAQ9E,WAWrB,IAAM8E,EAAU,CAACV,KAAIoK,MAAO5M,EAAaC,WACzCqF,aAAWxG,YAAY,UAAWoE,M,SAQvB2J,E,mFAAf,mHAA0BF,EAA1B,EAA0BA,OAAQ3M,EAAlC,EAAkCA,YAAaC,EAA/C,EAA+CA,QAAStF,EAAxD,EAAwDA,SAGlDgS,EAAOK,YAAaL,EAAOlD,MAHjC,gBAIIvO,EAAO8E,EACPiN,EAASN,EAAOK,WAAaL,EAAOlD,MALxC,2BAMakD,EAAOO,cANpB,iBAOUC,EAAc,IAAIpL,YACxB7G,EAAOiS,EAAY5L,OAAOvB,GAC1BiN,EAASN,EAAOO,cATpB,8BAWU,IAAIhX,MAAJ,mCAAsCyW,EAAOpY,KAA7C,YAXV,eAeE0L,EAAU,EAAH,KACFA,GADE,IAEL/L,QAAUyY,GAAUA,EAAO1M,SAAW0M,EAAO1M,QAAQ/L,SAAY,GACjEqK,QAAQ,IAlBZ,UAqBe0O,EAAO/R,EAAD,KAAW+E,GAAUtF,EAASgS,GArBnD,sF,6HCvEO,SAA8B7O,IACnC,IAAAG,QAAQH,EAAMC,SAAWD,EAAME,MAAUF,EAAMC,QAAUD,EAAME,KAE/D,IAAIoP,EAAYC,EAAexY,IAAIiJ,EAAMC,QAAUD,EAAME,KACpDoP,IAECtP,EAAME,MACRoP,EAmBN,SAAqCpP,GAEnC,IAAKA,EAAI2H,WAAW,QAClB,OAAO3H,EAKT,OAAOsP,GAuBkBvH,EAxBc/H,EAyBvC,kCAEiB+H,EAFjB,wEADF,IAA2BA,EAlDTwH,CAA4BzP,EAAME,KAC9CqP,EAAelJ,IAAIrG,EAAME,IAAKoP,IAG5BtP,EAAMC,SACRqP,EAAYE,EAA+BxP,EAAMC,QACjDsP,EAAelJ,IAAIrG,EAAMC,OAAQqP,KAKrC,OADA,IAAAnP,QAAOmP,GACAA,GA/BT,WAEMC,EAAiB,IAAI5J,IAqD3B,SAAS6J,EAA+BE,GAGtC,IAAMxD,EAAO,IAAI3H,KAAK,CAACmL,GAAe,CAACpN,KAAM,2BAC7C,OAAOY,IAAIG,gBAAgB6I,K,mGCpCtB,SAA4BzL,EAAsB0B,GACvD,IAAKuD,UAAWI,cACd,OAAO,EAGT,OAAOrF,EAAOA,SAAU0B,aAAjB,EAAiBA,EAAS1B,S,gEApBnC,I,EAAA,G,EAAA,Q,2BACA,QACA,Q,6WA0BO,WACLA,EACArD,GAFK,2HAGL+E,EAHK,+BAG6B,GAClCtF,EAJK,+BAIoB,GAEnBpG,GAAO,IAAAkZ,eAAclP,GACrBP,GAAM,IAAA0P,cAAanP,EAAQ0B,GAE3B0N,EAAanK,UAAWoK,cAAc3N,GACtCgE,EAAa0J,EAAWE,cAAc,CAACtZ,OAAMyJ,QAE7C4E,EAAU3C,EAAQ2C,SAAWrE,EAAOhK,KAZrC,SAaa0P,EAAW6J,SAC3BlL,EAEA1E,EAAU1I,KAAK,KAAMmF,IAhBlB,cAaC4J,EAbD,OAoBCwJ,GAAsB,IAAAC,8BAA6B/N,GACzDsE,EAAIzF,YAAY,UAAW,CAAC8N,MAAO1R,EAAM+E,QAAS8N,IArB7C,UAuBgBxJ,EAAItB,OAvBpB,eAuBCA,EAvBD,yBAwBEA,EAAOA,QAxBT,6C,+BAgCQ/E,E,yFAAf,WACEvD,EACA4J,EACAnE,EACA8C,GAJF,mGAMU9C,EANV,OAOS,SAPT,OAYS,UAZT,OAiBS,YAjBT,8BASMmE,EAAIC,KAAKtB,GATf,mCAcMqB,EAAInG,MAAM8E,EAAQ9E,OAdxB,+BAmBaoE,EAAsBU,EAAtBV,GAAIoK,EAAkB1J,EAAlB0J,MAAO3M,EAAWiD,EAAXjD,QAnBxB,SAqBatF,EAAQtE,QArBrB,wBAsBUkO,EAAIzF,YAAY,QAAS,CAAC0D,KAAIpE,MAAO,gDAtB/C,4CAyB6BzD,EAAQtE,QAAQuW,EAAO3M,GAzBpD,QAyBcgD,EAzBd,OA0BQsB,EAAIzF,YAAY,OAAQ,CAAC0D,KAAIS,WA1BrC,kDA4BchN,EAAU,gBAAiBC,MAAQ,KAAMD,QAAU,gBACzDsO,EAAIzF,YAAY,QAAS,CAAC0D,KAAIpE,MAAOnI,IA7B7C,4CAmCMoI,QAAQiM,KAAR,6CAAmDlK,IAnCzD,2D,0WChEO,SAAsC1K,GAI3C,OAAOuY,KAAKxE,OAGSyE,EAHWxY,EAI1ByY,EAAQ,IAAIrR,IACXmR,KAAKG,UAAUF,GAAG,SAAC3Y,EAAKN,GAC7B,GAAqB,WAAjB,EAAOA,IAAgC,OAAVA,EAAgB,CAC/C,GAAIkZ,EAAMjR,IAAIjI,GAEZ,IAEE,OAAOgZ,KAAKxE,MAAMwE,KAAKG,UAAUnZ,IACjC,MAAO2M,GAEP,OAIJuM,EAAMpR,IAAI9H,GAEZ,OAAOA,OAjBX,IAAuBiZ,EACfC,I,6FCSD,SAAsB9X,EAAkBgY,GAE7C,GAAoB,oBAAT/S,KACT,OAGF,IAAMX,EAAyB,CAC7BtE,QAASiY,GAIXhJ,UAAWlG,UAAX,e,EAAA,G,EAAA,yBAAuB,WAAOgB,EAAyB8C,GAAhC,sHAEX9C,EAFW,OAGZ,YAHY,OAWZ,uBAXY,QAwBZ,gBAxBY,QA4BZ,eA5BY,2BAIV/J,EAJU,sBAKP,IAAIH,MAAM,6CALH,uBAOMG,EAAQ6M,EAAQ0J,MAAO1J,EAAQjD,SAAW,GAAItF,GAPpD,cAOTsI,EAPS,OAQfqC,UAAWxG,YAAY,OAAQ,CAACmE,WARjB,gCAYVoL,EAZU,uBAaP,IAAInY,MAAM,8CAbH,QAefqY,EAAe,IAAIpI,UACnBlG,EAAUiD,EAAQjD,SAAW,GACvBuO,EAAiBH,EAAiBE,EAActO,EAAStF,aAAxB,EAAwBA,EAAS0T,kBAjBzD,wBAkBWG,GAlBX,4HAkBEC,EAlBF,EAmBbnJ,UAAWxG,YAAY,eAAgB,CAACmE,OAAQwL,IAnBnC,0TAqBfnJ,UAAWxG,YAAY,OAAQ,IArBhB,oCAyBfyP,EAAarW,KAAKgL,EAAQ0J,OAzBX,oCA6Bf2B,EAAanT,QA7BE,+EAmCbnF,EAAU,gBAAiBC,MAAQ,KAAMD,QAAU,GACzDqP,UAAWxG,YAAY,QAAS,CAACV,MAAOnI,IApCrB,mF,+KAAvB,yDAzBF,eACA,W,gdAIA,IACIsY,EACAtO,EAFA8M,EAAY,EA6DhB,SAASuB,EAAoBtO,GAA2B,IAAdC,EAAc,uDAAJ,GAClD,OAAO,IAAIuB,SAAQ,SAACC,EAASC,GAC3B,IAAMc,EAAKuK,IA0BXzH,UAAWG,kBAtBO,SAAZvH,EAAakC,EAAM8C,GACvB,GAAIA,EAAQV,KAAOA,EAKnB,OAAQpC,GACN,IAAK,OACHkF,UAAWI,oBAAoBxH,GAC/BuD,EAAQyB,EAAQD,QAChB,MAEF,IAAK,QACHqC,UAAWI,oBAAoBxH,GAC/BwD,EAAOwB,EAAQ9E,WAWrB,IAAM8E,EAAU,CAACV,KAAIoK,MAAO5M,EAAaC,WACzCqF,UAAWxG,YAAY,UAAWoE,Q,sGC/F/B,SACL3E,GAES,IADTmQ,EACS,uDADajM,WAEtB,IAAAxE,QAAOM,EAAQ,sBAEf,IAAMoQ,EAAgBpQ,EAAO/F,QAC7B,IAAKkW,IAAgBC,EACnB,OAAO,EAaT,OAAO,GA9BT,WACA,Q,+XCDA,WACA,E,ybAAA,QACA,OACA,K,2bAGA,IAGMC,EAAsB,G,iDAiBrB,WACLC,GADK,2GAELC,EAFK,+BAEuB,KAC5B7O,EAHK,+BAGa,GAEd6O,IACFD,EAAaE,EAAcF,EAAYC,EAAY7O,IAIrD2O,EAAoBC,GAClBD,EAAoBC,IAAeG,EAAoBH,GAXpD,SAYQD,EAAoBC,GAZ5B,oF,sBAgBA,SAASE,EAAcE,EAASH,EAAqB7O,GAE1D,GAAIgP,EAAQtJ,WAAW,QACrB,OAAOsJ,EAIT,IAAM/a,EAAU+L,EAAQ/L,SAAW,GACnC,OAAIA,EAAQ+a,GACH/a,EAAQ+a,GAKZrT,YAKDqE,EAAQiP,MACV,IAAAjR,QAAOgC,EAAQiP,IAAIvJ,WAAW,SAC9B,UAAU1F,EAAQiP,IAAlB,YAAyBJ,EAAzB,YAxDY,QAwDZ,sBAA4DG,IAI1DnT,WACF,sBAAsBmT,GAGxB,kBAAkBH,EAAlB,qBAAyCG,GAdvC,kBAAkBH,EAAlB,sBAA0CG,G,SAiB/BD,E,mFAAf,WAAmCH,GAAnC,8FACMA,EAAWM,SAAS,QAD1B,gCAE2BC,MAAMP,GAFjC,cAEUQ,EAFV,gBAGiBA,EAASrP,cAH1B,kDAMOpE,YANP,yBAOWkL,EAAKwI,iBAPhB,uCAO0CxI,EAAKwI,gBAAgBT,GAP/D,uEASM/S,WATN,0CAUWC,cAAc8S,IAVzB,yBAiByBO,MAAMP,GAjB/B,eAiBQQ,EAjBR,iBAkB6BA,EAASrI,OAlBtC,eAkBQuI,EAlBR,yBAmBSC,EAAsBD,EAAcV,IAnB7C,6C,sBAwCA,SAASW,EAAsBD,EAAc/M,GAC3C,IAAK5G,YACH,OAAOkL,EAAK2I,mBAAqB3I,EAAK2I,kBAAkBF,EAAc/M,GAGxE,GAAI1G,WAKF,OAHA4T,KAAKvb,KAAKoH,SAAQgU,GAGX,KAGT,IAAMI,EAASlV,SAASC,cAAc,UACtCiV,EAAOnN,GAAKA,EAEZ,IACEmN,EAAOC,YAAYnV,SAASoV,eAAeN,IAC3C,MAAO5Y,GACPgZ,EAAO3I,KAAOuI,EAGhB,OADA9U,SAASqV,KAAKF,YAAYD,GACnB,O,4HCxIT,YACA,Q,o/DAqBA,IAAMxM,EAAwC,CAC5C4M,QAAS,GACT9X,UAAW,GACX+X,KAAM,IACNC,UAAU,EACVC,KAAM,IACNC,UAAW,SAACC,GACV/R,QAAQC,IAAR,kBAAuB8R,EAAatS,MAAMiS,YAQzBM,E,WAQnB,aAA0C,6DAAJ,GAAI,IAA7B7N,UAA6B,MAAxB,iBAAwB,oDANNW,IAMM,sBALE,MAKF,cAJnB,GAImB,8BACxCvM,KAAK4L,GAAKA,E,gFAIZ,WAAY1E,GAAZ,gGACEA,EAAQ,EAAH,KAAOqF,GAAkBrF,GAC9BlH,KAAKkH,MAAQA,EAEP/F,EAJR,EAImB+F,EAAM7F,WAGvBrB,KAAKoZ,KAAOM,OAAOxS,EAAMkS,OACrBlS,EAAMyS,QARZ,qBASQzS,EAAMmS,SATd,iCAUwB,IAAAO,kBAAiB1S,EAAMkS,MAV/C,OAUMpZ,KAAKoZ,KAVX,cAYIjY,EAAKG,KAAK4F,EAAMyS,QAAS1U,OAAOjF,KAAKoZ,OAZzC,yBAee,IAAIxO,SAAQ,SAACC,EAASC,GACjC,IACE,EAAK+O,aAAY,WACX3S,EAAMqS,WACRrS,EAAMqS,UAAU,GAElB1O,EAAQ,OAGVpD,QAAQC,IAAR,mBAAwBR,EAAMiS,QAA9B,YAAyCjS,EAAM7F,UAAUyY,KAAK,OAC9D,IAAMC,GAAe,IAAAC,OAAM9S,EAAMiS,QAAShY,EAAM+F,EAAM8S,OACtD,EAAKD,aAAeA,EAEpBA,EAAaE,OAAOnY,GAAG,QAAQ,SAACwC,GAC9BmD,QAAQC,IAAIpD,EAAK4V,eAGnBH,EAAaI,OAAOrY,GAAG,QAAQ,SAACwC,GAC9BmD,QAAQC,IAAR,0CAA+CpD,EAA/C,OACA,EAAK8V,gBACLtP,EAAO,IAAIxL,MAAMgF,OAEnByV,EAAajY,GAAG,SAAS,SAAC0F,GACxBC,QAAQC,IAAR,qCAA0CF,IAC1C,EAAK4S,gBACLtP,EAAOtD,MAETuS,EAAajY,GAAG,SAAS,SAACuY,GACxB5S,QAAQC,IAAR,oCAAyC2S,IACzC,EAAKN,aAAe,KACpB,EAAKK,gBACLvP,EAAQ,OAEV,MAAOrD,GACPsD,EAAOtD,OAjDb,0F,8FAuDA,6FACMxH,KAAK+Z,eACP/Z,KAAK+Z,aAAaO,OAClBta,KAAK+Z,aAAe,MAHxB,gD,6FAQA,sHAAWQ,EAAX,+BAAgC,EAAhC,kBAEUva,KAAKwa,OAFf,OAII/a,EAAQgb,KAAKF,GAJjB,gDAMI9S,QAAQD,MAAM,KAAMnI,SAAN,MAEdI,EAAQgb,KAAK,GARjB,yD,sEAYA,SAAYC,GACNhB,OAAO1Z,KAAKkH,MAAMoS,MAAQ,IAC5BtZ,KAAK2a,aAAe7a,WAAW4a,EAAU1a,KAAKkH,MAAMoS,S,2BAIxD,WACMtZ,KAAK2a,cACP1a,aAAaD,KAAK2a,mB,gKClIjB,WAAuE,IAA7CC,EAA6C,uDAAvB,IACrD,OAAO,IAAIhQ,SAAQ,SAACC,GAElBgQ,UAAaxV,KAAK,+BAA+B,SAACmC,EAAOyS,GACvD,GAAIzS,EAEFqD,EAAQ+P,OAFV,CAMA,IAAME,EAAuB,GACvBC,EAAQ,oBACdd,EAAOe,MAAM,MAAMvN,SAAQ,SAACwN,GAC1B,IAAMC,EAAQH,EAAM1V,KAAK4V,GACrBC,GACFJ,EAAWxZ,KAAKoY,OAAOwB,EAAM,QAIjC,IADA,IAAI9B,EAAOwB,EACJE,EAAWK,SAAS/B,IACzBA,IAEFvO,EAAQuO,WA1Bd,I,EAAA,G,EAAA,Q,+HCSO,SAA4BrD,EAAgB1M,GACjD,IAAKuD,aAAWI,cACd,OAAO,EAGT,OAAO+I,EAAOpO,SAAU0B,aAAjB,EAAiBA,EAAS1B,S,sEAZnC,Y,6WAmBO,WACLoO,EACAzR,EACA+E,EACAtF,EACAmS,GALK,uGAOCvY,EAAOoY,EAAOnK,GACdxE,GAAM,IAAA0P,cAAaf,EAAQ1M,GAE3B0N,EAAanK,aAAWoK,cAAc3N,GACtCgE,EAAa0J,EAAWE,cAAc,CAACtZ,OAAMyJ,QAInDiC,EAAUgO,KAAKxE,MAAMwE,KAAKG,UAAUnO,IAf/B,SAiBagE,EAAW6J,SAC3B,oBAEA5P,EAAU1I,KAAK,KAAMsX,IApBlB,cAiBCvI,EAjBD,QAuBDzF,YAAY,UAAW,CAEzB8N,MAAO1R,EACP+E,YA1BG,UA6BgBsE,EAAItB,OA7BpB,eA6BCA,EA7BD,iBA8BQA,EAAOA,OA9Bf,sF,+BAuCQ/E,E,yFAAf,WACE4O,EACAvI,EACAnE,EACA8C,GAJF,mGAMU9C,EANV,OAOS,SAPT,OAWS,UAXT,OAeS,YAfT,8BAQMmE,EAAIC,KAAKtB,GARf,mCAYMqB,EAAInG,MAAM8E,EAAQ9E,OAZxB,mCAiBaoE,EAAsBU,EAAtBV,GAAIoK,EAAkB1J,EAAlB0J,MAAO3M,EAAWiD,EAAXjD,QAjBxB,mBAmB6B6M,EAAkBF,EAAO3M,GAnBtD,QAmBcgD,EAnBd,OAoBQsB,EAAIzF,YAAY,OAAQ,CAAC0D,KAAIS,WApBrC,kDAsBchN,EAAU,gBAAiBC,MAAQ,KAAMD,QAAU,gBACzDsO,EAAIzF,YAAY,QAAS,CAAC0D,KAAIpE,MAAOnI,IAvB7C,4CA6BMoI,QAAQiM,KAAR,4CAAkDlK,IA7BxD,2D,kHCvDO,SAAmB4R,GACxB,IACE,OAAO/D,KAAKxE,MAAMuI,GAClB,MAAOC,GACP,MAAM,IAAI/b,MAAJ,yDAA2D,IAAAgc,oBAAmBF,GAA9E,QATV,a,+ICoDO,SACL3V,EACAqK,EACAsL,EACAhJ,GAEA,IAGMmJ,GAHc,IAAIlL,aAGSC,OAAO8K,GAIxC,OAFAtL,EAAa0L,EAAgC/V,EAAUqK,EAAYyL,EAAcnJ,IA9DnF,YAYO,SAASoJ,EACd/V,EACAqK,EACA+B,EACAO,GAEA,IAAMqJ,GAAe,IAAAtJ,aAAYN,EAAalM,WAAYyM,GACpDsJ,EAAYD,EAAe5J,EAAalM,WAE9C,GAAIF,EAAU,CAEZ,IAAMqM,EAAc,IAAIpG,WACtBjG,EAASoB,OACTpB,EAASqK,WAAaA,EACtB+B,EAAalM,YAETwL,EAAc,IAAIzF,WAAWmG,GACnCC,EAAYvE,IAAI4D,GAGhB,IAAK,IAAI/T,EAAI,EAAGA,EAAIse,IAAate,EAE/BqI,EAASkW,SAAS7L,EAAa+B,EAAalM,WAAavI,EAAG,IAIhE,OADA0S,GAAc2L,I,yGClCT,SAAkCL,EAAQQ,GAK/C,IAJA,IAAMrb,EAAS6a,EAAO7a,OAEhB6R,EADeqD,KAAKoG,KAAKtb,EAASqb,GAAiBA,EAC1Brb,EAC3Bub,EAAa,GACR1e,EAAI,EAAGA,EAAIgV,IAAWhV,EAC7B0e,GAAc,IAEhB,OAAOV,EAASU,G,uBAGX,SAA8BrW,EAAUqK,EAAYsL,EAAQzV,GACjE,GAAIF,EACF,IAAK,IAAIrI,EAAI,EAAGA,EAAIuI,EAAYvI,IAC9BqI,EAASkW,SAAS7L,EAAa1S,EAAGge,EAAOW,WAAW3e,IAGxD,OAAO0S,EAAanK,G,uBAGf,SAA8BF,EAAUqK,EAAYkM,EAAQrW,GACjE,GAAIF,EACF,IAAK,IAAIrI,EAAI,EAAGA,EAAIuI,EAAYvI,IAC9BqI,EAASkW,SAAS7L,EAAa1S,EAAG4e,EAAO5e,IAG7C,OAAO0S,EAAanK,I,8lCC3Bf,WACLsW,GADK,kHAEL5S,EAFK,+BAEyB,GAExBkN,EAAc,IAAIpL,iBAAYjC,EAAWG,GAJ1C,uBAK2B4S,GAL3B,+HAMH,OADe7S,EALZ,YAM0B,iBAAhBA,EACTA,EACAmN,EAAY5L,OAAOvB,EAAa,CAAC8S,QAAQ,IAR1C,yX,uEAiBA,WACLC,GADK,oGAGCC,EAAc,IAAI/L,YAHnB,uBAIoB8L,GAJpB,+HAKH,OADe/L,EAJZ,YAKmB,iBAATA,EAAoBgM,EAAY9L,OAAOF,GAAQA,EALzD,yX,uEAeA,WACL+L,GADK,sGAGDE,EAAW,GAHV,uBAIyBF,GAJzB,+HAKHE,GALG,EAMCC,OAND,gBAOKA,EAAWD,EAASE,QAAQ,QAAU,GAP3C,iBAWD,OAFMtB,EAAOoB,EAASpM,MAAM,EAAGqM,EAAW,GAC1CD,EAAWA,EAASpM,MAAMqM,EAAW,GAVpC,UAWKrB,EAXL,iVAeDoB,EAAS9b,OAAS,GAfjB,iBAgBH,OAhBG,UAgBG8b,EAhBH,6E,uEA0BA,WACLG,GADK,oGAGDC,EAAU,EAHT,uBAIoBD,GAJpB,+HAKH,OADevB,EAJZ,YAKG,CAACwB,UAASxB,QALb,QAMHwB,IANG,yX,m5BC7DP,Y,ipBAgBO,WAAuBC,EAAUC,GAAjC,0GAGyBD,EAASE,OAHlC,mBAGIhP,EAHJ,EAGIA,KAAMvP,EAHV,EAGUA,OACTuP,EAJD,uBAKD8O,EAAQ,SALP,8BAQYC,EAAQte,GARpB,+G,uEAsBA,WACLiR,GADK,oGAGCuN,EAA8B,GAH/B,uBAIqBvN,GAJrB,yHAIYwN,EAJZ,EAKHD,EAAavb,KAAKwb,GALf,0UAOEC,uCAA2BF,IAP7B,6E,uEAUA,WACLvN,GADK,oGAGC0N,EAAoB,GAHrB,uBAIqB1N,GAJrB,yHAIYwN,EAJZ,EAKHE,EAAQ1b,KAAKwb,GALV,0UAOEE,EAAQlD,KAAK,KAPf,6E,uHChDP,Y,27BAgBA,IAMMvN,EAAiD,CACrDX,GAAI,oBAEJqR,kBAAkB,EAElBC,YAAa,GAeMC,E,WAUnB,aAA+C,IAAnCjW,EAAmC,uDAAJ,GAAI,oFAPlB,GAOkB,sBAJb,IAIa,oBAHW,IAAI2F,KAGf,wBAFjB,MAG5B7M,KAAKkH,MAAL,OAAiBqF,GAAkBrF,GAGnClH,KAAKod,MAAQ,IAAIC,QAAM,CAACzR,GAAI5L,KAAKkH,MAAM0E,KACvC5L,KAAKod,MAAMnf,IAzCc,mBA0CzB+B,KAAKod,MAAMnf,IAzCc,mBA0CzB+B,KAAKod,MAAMnf,IAzCiB,sBA0C5B+B,KAAKod,MAAMnf,IAzCmB,wBA0C9B+B,KAAKod,MAAMnf,IAzCmB,wB,sDA4DhC,SACEqf,GAEwB,IADxBC,EACwB,uDADW,kBAAM,GAGzC,IAAKvd,KAAKkH,MAAM+V,iBACd,OAAOrS,QAAQC,QAAQ,CAAC+C,KAAM,eAIhC,GAAI5N,KAAKwd,WAAWlX,IAAIgX,GACtB,OAAOtd,KAAKwd,WAAWvf,IAAIqf,GAG7B,IAAMG,EAAmB,CAACH,SAAQI,SAAU,EAAGH,eACzCI,EAAU,IAAI/S,SAAuB,SAACC,GAG1C,OADA4S,EAAQ5S,QAAUA,EACX4S,KAMT,OAHAzd,KAAK4d,aAAatc,KAAKmc,GACvBzd,KAAKwd,WAAWjQ,IAAI+P,EAAQK,GAC5B3d,KAAK6d,oBACEF,I,2BAKT,SAAcF,GAAgC,WACrCH,EAAmBG,EAAnBH,OAAQzS,EAAW4S,EAAX5S,QACXiT,GAAS,EAEPlQ,EAAO,WAENkQ,IACHA,GAAS,EAGT,EAAKN,WAAL,OAAuBF,GACvB,EAAKS,qBAEL,EAAKF,sBAOT,OAFA7d,KAAK+d,qBAEElT,EAAUA,EAAQ,CAAC+C,SAAShD,QAAQC,QAAQ,CAAC+C,W,+BAItD,WAA0B,WACnB5N,KAAKge,iBACRhe,KAAKge,eAAiBle,YAAW,kBAAM,EAAKme,2BAA0B,M,oCAK1E,WAEEje,KAAKge,eAAiB,KAEtB,IAAME,EAAYzI,KAAKG,IAAI5V,KAAKkH,MAAMgW,YAAcld,KAAK+d,mBAAoB,GAE7E,GAAkB,IAAdG,EAAJ,CAIAle,KAAKme,qBAGL,IAAK,IAAI/gB,EAAI,EAAGA,EAAI8gB,IAAa9gB,EAAG,CAClC,IAAMqgB,EAAUzd,KAAK4d,aAAazP,QAC9BsP,GACFzd,KAAKoe,cAAcX,O,gCASzB,WAEE,IADA,IAAMG,EAAe5d,KAAK4d,aACjBxgB,EAAI,EAAGA,EAAIwgB,EAAard,SAAUnD,EAAG,CAC5C,IAAMqgB,EAAUG,EAAaxgB,GACxB4C,KAAKqe,eAAeZ,KAEvBG,EAAaU,OAAOlhB,EAAG,GACvB4C,KAAKwd,WAAL,OAAuBC,EAAQH,QAC/BlgB,KAKJwgB,EAAaW,MAAK,SAACC,EAAGC,GAAJ,OAAUD,EAAEd,SAAWe,EAAEf,c,4BAI7C,SAAeD,GAIb,OAHAA,EAAQC,SAAWD,EAAQF,YAAYE,EAAQH,UAG3CG,EAAQC,SAAW,IACrBD,EAAQ5S,QAAQ,MACT,S,qICtLN,SAAiBzD,GACtB,IAAMsX,EAAatX,GAAOA,EAAIuX,YAAY,KAC1C,OAAOD,GAAc,EAAItX,EAAIwX,OAAO,EAAGF,GAAwB,I,OAO1D,WAA0C,2BAAzBG,EAAyB,yBAAzBA,EAAyB,gBAC/C,IAAMC,EAAY,IAUlB,OATAD,EAAQA,EAAM/N,KAAI,SAACiO,EAAMC,GAOvB,OANIA,IACFD,EAAOA,EAAKE,QAAQ,IAAIC,OAAJ,WAAeJ,IAAc,KAE/CE,IAAUH,EAAMte,OAAS,IAC3Bwe,EAAOA,EAAKE,QAAQ,IAAIC,OAAJ,UAAcJ,EAAd,MAA6B,KAE5CC,MAEIjF,KAAKgF,K,8FClBb,SAAuBK,GAC5BC,EAAaD,G,gBAMR,WACL,OAAOC,G,aAUF,SAAoBC,GACzBvhB,OAAO2U,OAAO6M,EAAaD,I,cAMtB,SAAqBE,GAC1B,IAAK,IAAMC,KAASF,EAClB,GAAIC,EAASxQ,WAAWyQ,GAAQ,CAC9B,IAAMC,EAAcH,EAAYE,GAChCD,EAAWA,EAASN,QAAQO,EAAOC,GAGlCF,EAASxQ,WAAW,YAAewQ,EAASxQ,WAAW,cAC1DwQ,EAAW,GAAH,OAAMH,GAAN,OAAmBG,IAE7B,OAAOA,GAzCT,IAAIH,EAAa,GACXE,EAA6C,I,oPCFnD,I,EAAA,G,EAAA,Q,2BACA,QACA,Q,4TAEA,IAAM9X,EAAQ,SAACkY,GAAD,OAAgB,WAC5B,MAAM,IAAIpgB,MAAJ,UAAaogB,EAAb,gCAGK1S,EAAczI,QAAQob,W,gBAE5B,IAAMC,EAAOD,gDAAIC,MAAO,IAAAC,WAAUF,UAAGC,MAAQpY,EAAM,W,SACnD,IAAMhD,EAAQmb,gDAAInb,OAAQ,IAAAqb,WAAUF,UAAGnb,OAASgD,EAAM,Y,UACtD,IAAMsY,EAAOH,gDAAIG,MAAO,IAAAD,WAAUF,UAAGG,MAAQtY,EAAM,W,SAEnD,IAAMuY,EAAWJ,gDAAII,UAAW,IAAAF,WAAUF,UAAGI,UAAYvY,EAAM,e,aAC/D,IAAMwY,EAAeL,gDAAIK,aAAeL,UAAGK,aAAexY,EAAM,mB,iBAChE,IAAMyY,EAAYN,gDAAIM,WAAY,IAAAJ,WAAUF,UAAGM,WAAazY,EAAM,gB,cAClE,IAAM0Y,EAAgBP,gDAAIO,cAAgBP,UAAGO,cAAgB1Y,EAAM,oB,iDAEnE,WAAkC2Y,EAAYC,EAAe7f,GAA7D,+FACCsG,EAASwZ,OAAOC,MAAM/f,GADvB,SAEqBuf,EAAKK,EAAItZ,EAAQ,EAAGtG,EAAQ6f,GAFjD,qBAEEG,YACWhgB,EAHb,sBAIG,IAAIjB,MAAM,kBAJb,iCAME,IAAA6Q,eAActJ,IANhB,4C,0FCpBP,YAqBA,IAAI2Z,EAA4B1iB,OAAO0iB,2BACrC,SAAmCC,GAGjC,IAFA,IAAIC,EAAO5iB,OAAO4iB,KAAKD,GACnBE,EAAc,GACTvjB,EAAI,EAAGA,EAAIsjB,EAAKngB,OAAQnD,IAC/BujB,EAAYD,EAAKtjB,IAAMU,OAAO8iB,yBAAyBH,EAAKC,EAAKtjB,IAEnE,OAAOujB,GAGPE,EAAe,WACnB3jB,EAAQuG,OAAS,SAASqd,GACxB,IAAKC,EAASD,GAAI,CAEhB,IADA,IAAIE,EAAU,GACL5jB,EAAI,EAAGA,EAAIiE,UAAUd,OAAQnD,IACpC4jB,EAAQ1f,KAAK2f,EAAQ5f,UAAUjE,KAEjC,OAAO4jB,EAAQlH,KAAK,KAGlB1c,EAAI,EAmBR,IAnBA,IACI+D,EAAOE,UACPV,EAAMQ,EAAKZ,OACX2gB,EAAMjc,OAAO6b,GAAG7B,QAAQ4B,GAAc,SAASzM,GACjD,GAAU,OAANA,EAAY,MAAO,IACvB,GAAIhX,GAAKuD,EAAK,OAAOyT,EACrB,OAAQA,GACN,IAAK,KAAM,OAAOnP,OAAO9D,EAAK/D,MAC9B,IAAK,KAAM,OAAOsc,OAAOvY,EAAK/D,MAC9B,IAAK,KACH,IACE,OAAOia,KAAKG,UAAUrW,EAAK/D,MAC3B,MAAOie,GACP,MAAO,aAEX,QACE,OAAOjH,MAGJA,EAAIjT,EAAK/D,GAAIA,EAAIuD,EAAKyT,EAAIjT,IAAO/D,GACpC+jB,EAAO/M,KAAOgN,EAAShN,GACzB8M,GAAO,IAAM9M,EAEb8M,GAAO,IAAMD,EAAQ7M,GAGzB,OAAO8M,GAOThkB,EAAQmkB,UAAY,SAASC,EAAIC,GAC/B,QAAuB,IAAZ9hB,IAAqD,IAA1BA,EAAQ+hB,cAC5C,OAAOF,EAIT,QAAuB,IAAZ7hB,EACT,OAAO,WACL,OAAOvC,EAAQmkB,UAAUC,EAAIC,GAAKhgB,MAAMvB,KAAMqB,YAIlD,IAAIogB,GAAS,EAeb,OAdA,WACE,IAAKA,EAAQ,CACX,GAAIhiB,EAAQiiB,iBACV,MAAM,IAAIpiB,MAAMiiB,GACP9hB,EAAQkiB,iBACjBla,QAAQma,MAAML,GAEd9Z,QAAQD,MAAM+Z,GAEhBE,GAAS,EAEX,OAAOH,EAAG/f,MAAMvB,KAAMqB,aAO1B,IACIwgB,EADAC,EAAS,GA6Bb,SAASb,EAAQR,EAAKsB,GAEpB,IAAIC,EAAM,CACRC,KAAM,GACNC,QAASC,GAkBX,OAfI9gB,UAAUd,QAAU,IAAGyhB,EAAII,MAAQ/gB,UAAU,IAC7CA,UAAUd,QAAU,IAAGyhB,EAAIK,OAAShhB,UAAU,IAC9CihB,EAAUP,GAEZC,EAAIO,WAAaR,EACRA,GAET7kB,EAAQslB,QAAQR,EAAKD,GAGnBU,EAAYT,EAAIO,cAAaP,EAAIO,YAAa,GAC9CE,EAAYT,EAAII,SAAQJ,EAAII,MAAQ,GACpCK,EAAYT,EAAIK,UAASL,EAAIK,QAAS,GACtCI,EAAYT,EAAIU,iBAAgBV,EAAIU,eAAgB,GACpDV,EAAIK,SAAQL,EAAIE,QAAUS,GACvBC,EAAYZ,EAAKvB,EAAKuB,EAAII,OAoCnC,SAASO,EAAiBzB,EAAK2B,GAC7B,IAAIC,EAAQ7B,EAAQ8B,OAAOF,GAE3B,OAAIC,EACK,KAAY7B,EAAQoB,OAAOS,GAAO,GAAK,IAAM5B,EAC7C,KAAYD,EAAQoB,OAAOS,GAAO,GAAK,IAEvC5B,EAKX,SAASiB,EAAejB,EAAK2B,GAC3B,OAAO3B,EAeT,SAAS0B,EAAYZ,EAAK3jB,EAAO2kB,GAG/B,GAAIhB,EAAIU,eACJrkB,GACA4kB,EAAW5kB,EAAM4iB,UAEjB5iB,EAAM4iB,UAAY/jB,EAAQ+jB,WAExB5iB,EAAMkT,aAAelT,EAAMkT,YAAYvS,YAAcX,GAAQ,CACjE,IAAI6kB,EAAM7kB,EAAM4iB,QAAQ+B,EAAchB,GAItC,OAHKjB,EAASmC,KACZA,EAAMN,EAAYZ,EAAKkB,EAAKF,IAEvBE,EAIT,IAAIC,EA+FN,SAAyBnB,EAAK3jB,GAC5B,GAAIokB,EAAYpkB,GACd,OAAO2jB,EAAIE,QAAQ,YAAa,aAClC,GAAInB,EAAS1iB,GAAQ,CACnB,IAAI+kB,EAAS,IAAO/L,KAAKG,UAAUnZ,GAAO4gB,QAAQ,SAAU,IAClBA,QAAQ,KAAM,OACdA,QAAQ,OAAQ,KAAO,IACjE,OAAO+C,EAAIE,QAAQkB,EAAQ,UAE7B,GAAIC,EAAShlB,GACX,OAAO2jB,EAAIE,QAAQ,GAAK7jB,EAAO,UACjC,GAAIikB,EAAUjkB,GACZ,OAAO2jB,EAAIE,QAAQ,GAAK7jB,EAAO,WAEjC,GAAI8iB,EAAO9iB,GACT,OAAO2jB,EAAIE,QAAQ,OAAQ,QA9GboB,CAAgBtB,EAAK3jB,GACrC,GAAI8kB,EACF,OAAOA,EAIT,IAAIzC,EAAO5iB,OAAO4iB,KAAKriB,GACnBklB,EApCN,SAAqBviB,GACnB,IAAIwiB,EAAO,GAMX,OAJAxiB,EAAMyM,SAAQ,SAASgW,EAAKC,GAC1BF,EAAKC,IAAO,KAGPD,EA6BWG,CAAYjD,GAQ9B,GANIsB,EAAIO,aACN7B,EAAO5iB,OAAO8lB,oBAAoBvlB,IAKhCwlB,EAAQxlB,KACJqiB,EAAKnE,QAAQ,YAAc,GAAKmE,EAAKnE,QAAQ,gBAAkB,GACrE,OAAOuH,EAAYzlB,GAIrB,GAAoB,IAAhBqiB,EAAKngB,OAAc,CACrB,GAAI0iB,EAAW5kB,GAAQ,CACrB,IAAIV,EAAOU,EAAMV,KAAO,KAAOU,EAAMV,KAAO,GAC5C,OAAOqkB,EAAIE,QAAQ,YAAcvkB,EAAO,IAAK,WAE/C,GAAIomB,EAAS1lB,GACX,OAAO2jB,EAAIE,QAAQhD,OAAOlgB,UAAUkb,SAAS3c,KAAKc,GAAQ,UAE5D,GAAI2lB,EAAO3lB,GACT,OAAO2jB,EAAIE,QAAQ9e,KAAKpE,UAAUkb,SAAS3c,KAAKc,GAAQ,QAE1D,GAAIwlB,EAAQxlB,GACV,OAAOylB,EAAYzlB,GAIvB,IA2CI4lB,EA3CAC,EAAO,GAAIljB,GAAQ,EAAOmjB,EAAS,CAAC,IAAK,MAGzCC,EAAQ/lB,KACV2C,GAAQ,EACRmjB,EAAS,CAAC,IAAK,MAIblB,EAAW5kB,MAEb6lB,EAAO,cADC7lB,EAAMV,KAAO,KAAOU,EAAMV,KAAO,IACf,KAkB5B,OAdIomB,EAAS1lB,KACX6lB,EAAO,IAAMhF,OAAOlgB,UAAUkb,SAAS3c,KAAKc,IAI1C2lB,EAAO3lB,KACT6lB,EAAO,IAAM9gB,KAAKpE,UAAUqlB,YAAY9mB,KAAKc,IAI3CwlB,EAAQxlB,KACV6lB,EAAO,IAAMJ,EAAYzlB,IAGP,IAAhBqiB,EAAKngB,QAAkBS,GAAyB,GAAhB3C,EAAMkC,OAItCyiB,EAAe,EACbe,EAAS1lB,GACJ2jB,EAAIE,QAAQhD,OAAOlgB,UAAUkb,SAAS3c,KAAKc,GAAQ,UAEnD2jB,EAAIE,QAAQ,WAAY,YAInCF,EAAIC,KAAK3gB,KAAKjD,GAIZ4lB,EADEjjB,EAsCN,SAAqBghB,EAAK3jB,EAAO2kB,EAAcO,EAAa7C,GAE1D,IADA,IAAIuD,EAAS,GACJ7mB,EAAI,EAAGC,EAAIgB,EAAMkC,OAAQnD,EAAIC,IAAKD,EACrC6B,EAAeZ,EAAO4G,OAAO7H,IAC/B6mB,EAAO3iB,KAAKgjB,EAAetC,EAAK3jB,EAAO2kB,EAAcO,EACjDte,OAAO7H,IAAI,IAEf6mB,EAAO3iB,KAAK,IAShB,OANAof,EAAKjT,SAAQ,SAAS9O,GACfA,EAAIuc,MAAM,UACb+I,EAAO3iB,KAAKgjB,EAAetC,EAAK3jB,EAAO2kB,EAAcO,EACjD5kB,GAAK,OAGNslB,EArDIM,CAAYvC,EAAK3jB,EAAO2kB,EAAcO,EAAa7C,GAEnDA,EAAK5P,KAAI,SAASnS,GACzB,OAAO2lB,EAAetC,EAAK3jB,EAAO2kB,EAAcO,EAAa5kB,EAAKqC,MAItEghB,EAAIC,KAAKuC,MA6GX,SAA8BP,EAAQC,EAAMC,GAQ1C,GANaF,EAAOjT,QAAO,SAASyT,EAAMC,GAGxC,OADIA,EAAInI,QAAQ,OAAS,GAAGoI,EACrBF,EAAOC,EAAIzF,QAAQ,kBAAmB,IAAI1e,OAAS,IACzD,GAEU,GACX,OAAO4jB,EAAO,IACG,KAATD,EAAc,GAAKA,EAAO,OAC3B,IACAD,EAAOnK,KAAK,SACZ,IACAqK,EAAO,GAGhB,OAAOA,EAAO,GAAKD,EAAO,IAAMD,EAAOnK,KAAK,MAAQ,IAAMqK,EAAO,GA5H1DS,CAAqBX,EAAQC,EAAMC,IAxBjCA,EAAO,GAAKD,EAAOC,EAAO,GA+CrC,SAASL,EAAYzlB,GACnB,MAAO,IAAMiB,MAAMN,UAAUkb,SAAS3c,KAAKc,GAAS,IAwBtD,SAASimB,EAAetC,EAAK3jB,EAAO2kB,EAAcO,EAAa5kB,EAAKqC,GAClE,IAAIrD,EAAMujB,EAAK2D,EAsCf,IArCAA,EAAO/mB,OAAO8iB,yBAAyBviB,EAAOM,IAAQ,CAAEN,MAAOA,EAAMM,KAC5DV,IAELijB,EADE2D,EAAKtX,IACDyU,EAAIE,QAAQ,kBAAmB,WAE/BF,EAAIE,QAAQ,WAAY,WAG5B2C,EAAKtX,MACP2T,EAAMc,EAAIE,QAAQ,WAAY,YAG7BjjB,EAAeskB,EAAa5kB,KAC/BhB,EAAO,IAAMgB,EAAM,KAEhBuiB,IACCc,EAAIC,KAAK1F,QAAQsI,EAAKxmB,OAAS,GAE/B6iB,EADEC,EAAO6B,GACHJ,EAAYZ,EAAK6C,EAAKxmB,MAAO,MAE7BukB,EAAYZ,EAAK6C,EAAKxmB,MAAO2kB,EAAe,IAE5CzG,QAAQ,OAAS,IAErB2E,EADElgB,EACIkgB,EAAIlG,MAAM,MAAMlK,KAAI,SAASmK,GACjC,MAAO,KAAOA,KACbnB,KAAK,MAAM8E,OAAO,GAEf,KAAOsC,EAAIlG,MAAM,MAAMlK,KAAI,SAASmK,GACxC,MAAO,MAAQA,KACdnB,KAAK,OAIZoH,EAAMc,EAAIE,QAAQ,aAAc,YAGhCO,EAAY9kB,GAAO,CACrB,GAAIqD,GAASrC,EAAIuc,MAAM,SACrB,OAAOgG,GAETvjB,EAAO0Z,KAAKG,UAAU,GAAK7Y,IAClBuc,MAAM,iCACbvd,EAAOA,EAAKihB,OAAO,EAAGjhB,EAAK4C,OAAS,GACpC5C,EAAOqkB,EAAIE,QAAQvkB,EAAM,UAEzBA,EAAOA,EAAKshB,QAAQ,KAAM,OACdA,QAAQ,OAAQ,KAChBA,QAAQ,WAAY,KAChCthB,EAAOqkB,EAAIE,QAAQvkB,EAAM,WAI7B,OAAOA,EAAO,KAAOujB,EA2BvB,SAASkD,EAAQU,GACf,OAAO1jB,MAAMgjB,QAAQU,GAIvB,SAASxC,EAAUyC,GACjB,MAAsB,kBAARA,EAIhB,SAAS5D,EAAO4D,GACd,OAAe,OAARA,EAST,SAAS1B,EAAS0B,GAChB,MAAsB,iBAARA,EAIhB,SAAShE,EAASgE,GAChB,MAAsB,iBAARA,EAShB,SAAStC,EAAYsC,GACnB,YAAe,IAARA,EAIT,SAAShB,EAASiB,GAChB,OAAO5D,EAAS4D,IAA8B,oBAAvBC,EAAeD,GAIxC,SAAS5D,EAAS2D,GAChB,MAAsB,iBAARA,GAA4B,OAARA,EAIpC,SAASf,EAAOtmB,GACd,OAAO0jB,EAAS1jB,IAA4B,kBAAtBunB,EAAevnB,GAIvC,SAASmmB,EAAQ9jB,GACf,OAAOqhB,EAASrhB,KACW,mBAAtBklB,EAAellB,IAA2BA,aAAaT,OAI9D,SAAS2jB,EAAW8B,GAClB,MAAsB,mBAARA,EAgBhB,SAASE,EAAepnB,GACtB,OAAOC,OAAOkB,UAAUkb,SAAS3c,KAAKM,GAIxC,SAASqnB,EAAIrmB,GACX,OAAOA,EAAI,GAAK,IAAMA,EAAEqb,SAAS,IAAMrb,EAAEqb,SAAS,IApbpDhd,EAAQioB,SAAW,SAAS5X,GAI1B,GAHIkV,EAAYZ,KACdA,EAAepiB,EAAQiC,IAAI0jB,YAAc,IAC3C7X,EAAMA,EAAI8X,eACLvD,EAAOvU,GACV,GAAI,IAAI2R,OAAO,MAAQ3R,EAAM,MAAO,KAAK/B,KAAKqW,GAAe,CAC3D,IAAIyD,EAAM7lB,EAAQ6lB,IAClBxD,EAAOvU,GAAO,WACZ,IAAIgU,EAAMrkB,EAAQuG,OAAOlC,MAAMrE,EAASmE,WACxCoG,QAAQD,MAAM,YAAa+F,EAAK+X,EAAK/D,SAGvCO,EAAOvU,GAAO,aAGlB,OAAOuU,EAAOvU,IAoChBrQ,EAAQ+jB,QAAUA,EAIlBA,EAAQoB,OAAS,CACf,KAAS,CAAC,EAAG,IACb,OAAW,CAAC,EAAG,IACf,UAAc,CAAC,EAAG,IAClB,QAAY,CAAC,EAAG,IAChB,MAAU,CAAC,GAAI,IACf,KAAS,CAAC,GAAI,IACd,MAAU,CAAC,GAAI,IACf,KAAS,CAAC,GAAI,IACd,KAAS,CAAC,GAAI,IACd,MAAU,CAAC,GAAI,IACf,QAAY,CAAC,GAAI,IACjB,IAAQ,CAAC,GAAI,IACb,OAAW,CAAC,GAAI,KAIlBpB,EAAQ8B,OAAS,CACf,QAAW,OACX,OAAU,SACV,QAAW,SACX,UAAa,OACb,KAAQ,OACR,OAAU,QACV,KAAQ,UAER,OAAU,OAkRZ7lB,EAAQknB,QAAUA,EAKlBlnB,EAAQolB,UAAYA,EAKpBplB,EAAQikB,OAASA,EAKjBjkB,EAAQqoB,kBAHR,SAA2BR,GACzB,OAAc,MAAPA,GAOT7nB,EAAQmmB,SAAWA,EAKnBnmB,EAAQ6jB,SAAWA,EAKnB7jB,EAAQsoB,SAHR,SAAkBT,GAChB,MAAsB,iBAARA,GAOhB7nB,EAAQulB,YAAcA,EAKtBvlB,EAAQ6mB,SAAWA,EAKnB7mB,EAAQkkB,SAAWA,EAKnBlkB,EAAQ8mB,OAASA,EAMjB9mB,EAAQ2mB,QAAUA,EAKlB3mB,EAAQ+lB,WAAaA,EAUrB/lB,EAAQuoB,YARR,SAAqBV,GACnB,OAAe,OAARA,GACe,kBAARA,GACQ,iBAARA,GACQ,iBAARA,GACQ,iBAARA,QACQ,IAARA,GAIhB7nB,EAAQwoB,SAAW,EAAQ,IAY3B,IAAIC,EAAS,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACxD,MAAO,MAAO,OAG5B,SAAS7iB,IACP,IAAIpF,EAAI,IAAI0F,KACRwiB,EAAO,CAACV,EAAIxnB,EAAEmoB,YACNX,EAAIxnB,EAAEooB,cACNZ,EAAIxnB,EAAEqoB,eAAejM,KAAK,KACtC,MAAO,CAACpc,EAAEsoB,UAAWL,EAAOjoB,EAAEuoB,YAAaL,GAAM9L,KAAK,KAqCxD,SAAS7a,EAAewhB,EAAKyF,GAC3B,OAAOpoB,OAAOkB,UAAUC,eAAe1B,KAAKkjB,EAAKyF,GAjCnDhpB,EAAQwK,IAAM,WACZD,QAAQC,IAAI,UAAW5E,IAAa5F,EAAQuG,OAAOlC,MAAMrE,EAASmE,aAiBpEnE,EAAQipB,SAAW,EAAQ,IAE3BjpB,EAAQslB,QAAU,SAAS4D,EAAQjgB,GAEjC,IAAKA,IAAQib,EAASjb,GAAM,OAAOigB,EAInC,IAFA,IAAI1F,EAAO5iB,OAAO4iB,KAAKva,GACnB/I,EAAIsjB,EAAKngB,OACNnD,KACLgpB,EAAO1F,EAAKtjB,IAAM+I,EAAIua,EAAKtjB,IAE7B,OAAOgpB,GAOT,IAAIC,EAA6C,oBAAXloB,OAAyBA,OAAO,8BAA2B+K,EA0DjG,SAASod,EAAsBC,EAAQC,GAKrC,IAAKD,EAAQ,CACX,IAAIE,EAAY,IAAInnB,MAAM,2CAC1BmnB,EAAUF,OAASA,EACnBA,EAASE,EAEX,OAAOD,EAAGD,GAlEZrpB,EAAQ2iB,UAAY,SAAmB6G,GACrC,GAAwB,mBAAbA,EACT,MAAM,IAAIC,UAAU,oDAEtB,GAAIN,GAA4BK,EAASL,GAA2B,CAClE,IAAI/E,EACJ,GAAkB,mBADdA,EAAKoF,EAASL,IAEhB,MAAM,IAAIM,UAAU,iEAKtB,OAHA7oB,OAAOC,eAAeujB,EAAI+E,EAA0B,CAClDhoB,MAAOijB,EAAItjB,YAAY,EAAO4oB,UAAU,EAAOC,cAAc,IAExDvF,EAGT,SAASA,IAQP,IAPA,IAAIwF,EAAgBC,EAChBpJ,EAAU,IAAI/S,SAAQ,SAAUC,EAASC,GAC3Cgc,EAAiBjc,EACjBkc,EAAgBjc,KAGd3J,EAAO,GACF/D,EAAI,EAAGA,EAAIiE,UAAUd,OAAQnD,IACpC+D,EAAKG,KAAKD,UAAUjE,IAEtB+D,EAAKG,MAAK,SAAU0J,EAAK3M,GACnB2M,EACF+b,EAAc/b,GAEd8b,EAAezoB,MAInB,IACEqoB,EAASnlB,MAAMvB,KAAMmB,GACrB,MAAO6J,GACP+b,EAAc/b,GAGhB,OAAO2S,EAQT,OALA7f,OAAOkpB,eAAe1F,EAAIxjB,OAAOmpB,eAAeP,IAE5CL,GAA0BvoB,OAAOC,eAAeujB,EAAI+E,EAA0B,CAChFhoB,MAAOijB,EAAItjB,YAAY,EAAO4oB,UAAU,EAAOC,cAAc,IAExD/oB,OAAOopB,iBACZ5F,EACAd,EAA0BkG,KAI9BxpB,EAAQ2iB,UAAUsH,OAASd,EAiD3BnpB,EAAQkqB,YAlCR,SAAqBV,GACnB,GAAwB,mBAAbA,EACT,MAAM,IAAIC,UAAU,oDAMtB,SAASU,IAEP,IADA,IAAIlmB,EAAO,GACF/D,EAAI,EAAGA,EAAIiE,UAAUd,OAAQnD,IACpC+D,EAAKG,KAAKD,UAAUjE,IAGtB,IAAIkqB,EAAUnmB,EAAKqjB,MACnB,GAAuB,mBAAZ8C,EACT,MAAM,IAAIX,UAAU,8CAEtB,IAAIjiB,EAAO1E,KACPwmB,EAAK,WACP,OAAOc,EAAQ/lB,MAAMmD,EAAMrD,YAI7BqlB,EAASnlB,MAAMvB,KAAMmB,GAClBomB,MAAK,SAASrE,GAAOzjB,EAAQyB,SAASslB,EAAI,KAAMtD,MAC3C,SAASsE,GAAO/nB,EAAQyB,SAASolB,EAAuBkB,EAAKhB,MAMvE,OAHA1oB,OAAOkpB,eAAeK,EAAevpB,OAAOmpB,eAAeP,IAC3D5oB,OAAOopB,iBAAiBG,EACA7G,EAA0BkG,IAC3CW,K,+BC5rBTlqB,EAAOD,QAAU,SAAkB6nB,GACjC,OAAOA,GAAsB,iBAARA,GACI,mBAAbA,EAAI0C,MACS,mBAAb1C,EAAI2C,MACc,mBAAlB3C,EAAI4C,Y,cCJW,mBAAlB7pB,OAAOY,OAEhBvB,EAAOD,QAAU,SAAkB0qB,EAAMC,GACvCD,EAAKE,OAASD,EACdD,EAAK5oB,UAAYlB,OAAOY,OAAOmpB,EAAU7oB,UAAW,CAClDuS,YAAa,CACXlT,MAAOupB,EACP5pB,YAAY,EACZ4oB,UAAU,EACVC,cAAc,MAMpB1pB,EAAOD,QAAU,SAAkB0qB,EAAMC,GACvCD,EAAKE,OAASD,EACd,IAAIE,EAAW,aACfA,EAAS/oB,UAAY6oB,EAAU7oB,UAC/B4oB,EAAK5oB,UAAY,IAAI+oB,EACrBH,EAAK5oB,UAAUuS,YAAcqW,I,yFCf1B,SAAkBvpB,GACvB,OAAOA,GAA0B,WAAjB,EAAOA,IAAsBA,EAAMqnB,U,WAO9C,SAAkBphB,GACvB,OAAO4L,EAAK8X,SAAW9X,EAAK8X,SAAS1jB,GAAQA,G,sBAOxC,SAA6BA,GAClC,GAAI4L,EAAKC,cAEP,OAAOD,EAAKC,cAAc7L,GAE5B,OAAOA,GA1BT,M,ybAAA,Q,wlBCIA,I,EAgBO,EAVM2jB,EAAa,CACxBtqB,KAAM,OACNiO,GAAI,OACJzO,OAAQ,OACRyE,QAVc,QAWdgR,WAAY,CAAC,OAAQ,WACrBD,UAAW,CAAC,oBACZuV,SAAU,OACV9X,MAAM,EACNkG,gBACAzD,O,EAAK,yBAAE,WAAOzJ,GAAP,yGAAuBkN,GAAc,IAAInL,aAAcR,OAAOvB,KAA9D,0CAAF,E,8KAAA,6CACLC,QAAS,IAIX,SAASiN,EAAclG,GACrB,OAAOiH,KAAKxE,MAAMzC,G,eAGb,IAAM+X,EAAyCF,E,mLC7BtD,Y,6WAEO,WAAwBG,EAASC,EAAMhf,GAAvC,iGACQ,IAAAif,cAAaF,GAAS,SAAChhB,GAAD,OAASkO,EAAYlO,EAAKihB,EAAMhf,MAD9D,oF,+BAIeiM,E,uFAAf,WAA2BlO,EAAKihB,EAAMhf,GAAtC,wGAEkBmP,MAAMpR,EAAKiC,EAAQmP,OAFrC,cAECC,EAFD,gBAGqBA,EAASrP,cAH9B,cAGCA,EAHD,gBAIQif,EAAKjf,EAAaC,GAJ1B,oF,mtBCUP,IAAM+X,EAAW,SAAC/iB,GAAD,OAAWA,GAA0B,WAAjB,EAAOA,I,iDAKrC,WAA4BkqB,EAAMC,GAAlC,yGAAwCnf,EAAxC,+BAAkD,GAAlD,SACQof,EAAWF,EAAMC,EAAMnf,GAD/B,oF,+BAIeof,E,uFAAf,WAA0B3pB,EAAQ0pB,EAAMnf,GAAxC,0FACDjI,MAAMgjB,QAAQtlB,GADb,gCAEU4pB,EAAS5pB,EAAQ0pB,EAAMnf,GAFjC,mDAKD+X,EAAStiB,GALR,gCAMU6pB,EAAU7pB,EAAQ0pB,EAAMnf,GANlC,sDAUCjC,EAAMtI,EAVP,UAWQ0pB,EAAKphB,EAAKiC,GAXlB,sF,+BAgBQsf,E,uFAAf,WAAyB7pB,EAAQ0pB,EAAMnf,GAAvC,4FAIE,IAAW1K,KAHLiqB,EAA2B,GAC3B1b,EAAS,GAFjB,WAIavO,GACT,IACMgf,EAAU8K,EADJ3pB,EAAOH,GACa6pB,EAAMnf,GAASke,MAAK,SAAClpB,GACnD6O,EAAOvO,GAAON,KAEhBuqB,EAAStnB,KAAKqc,IALE7e,EAAQ,EAAfH,GAJb,gBAYQiM,QAAQie,IAAID,GAZpB,gCAcS1b,GAdT,4C,+BAiBewb,E,qFAAf,WAAwBI,EAAUN,GAAlC,2GAAwCnf,EAAxC,+BAAkD,GAC1Cuf,EAAWE,EAAShY,KAAI,SAAC1J,GAAD,OAASqhB,EAAWrhB,EAAKohB,EAAMnf,MAD/D,SAEeuB,QAAQie,IAAID,GAF3B,oF,uMCzDe,MAAM,EACnB,YAAYjrB,EAAM6L,GAChBxJ,KAAKrC,KAAOA,EACZqC,KAAKwJ,KAAOA,EACZxJ,KAAK+oB,WAAa,EAClB/oB,KAAKgpB,QAGP,cAAcC,GAEZ,OADAjpB,KAAK+oB,WAAaE,EACXjpB,KAGT,iBAEE,OADAA,KAAKkpB,SAAS,GACPlpB,KAGT,iBAEE,OADAA,KAAKmpB,cAAc,GACZnpB,KAGT,SAAS3B,GAMP,OALA2B,KAAKopB,QAAU/qB,EACf2B,KAAKqpB,WAELrpB,KAAKspB,iBAEEtpB,KAGT,cAAc3B,GAMZ,OALA2B,KAAKopB,QAAU/qB,EACf2B,KAAKqpB,WAELrpB,KAAKspB,iBAEEtpB,KAGT,QAAQ4lB,GAON,OANA5lB,KAAKupB,OAAS3D,EACd5lB,KAAKwpB,WAAa5D,EAClB5lB,KAAKqpB,WAELrpB,KAAKspB,iBAEEtpB,KAGT,YAGE,OAFAA,KAAKypB,WAAa,cAClBzpB,KAAK0pB,eAAgB,EACd1pB,KAGT,UACE,OAAKA,KAAK0pB,eAIV1pB,KAAK2pB,QAAQ,cAAsB3pB,KAAKypB,YACxCzpB,KAAK0pB,eAAgB,EAErB1pB,KAAKspB,iBAEEtpB,MAREA,KAWX,wBACE,OAAOA,KAAK+oB,WAAa,EAAI/oB,KAAK4pB,gBAAkB5pB,KAAK+oB,WAAa,EAGxE,uBACE,OAAO/oB,KAAK+oB,WAAa,EAAI/oB,KAAK6pB,eAAiB7pB,KAAK+oB,WAAa,EAGvE,cACE,OAAO/oB,KAAK6pB,eAAiB,EAAI7pB,KAAK+oB,YAAc/oB,KAAK6pB,eAAiB,KAAQ,EAGpF,kBACE,OAAO7pB,KAAKipB,QAAU,EAAIjpB,KAAKsO,MAAQtO,KAAKipB,QAAU,EAGxD,iBACE,OAAOjpB,KAAKipB,QAAU,EAAIjpB,KAAK4lB,KAAO5lB,KAAKipB,QAAU,EAGvD,QACE,OAAOjpB,KAAK4lB,KAAO,EAAI5lB,KAAKipB,SAAWjpB,KAAK4lB,KAAO,KAAQ,EAG7D,QAYE,OAXA5lB,KAAK4lB,KAAO,EACZ5lB,KAAKsO,MAAQ,EACbtO,KAAKipB,QAAU,EACfjpB,KAAKwpB,WAAa,EAClBxpB,KAAK6pB,eAAiB,EACtB7pB,KAAK4pB,gBAAkB,EACvB5pB,KAAKopB,OAAS,EACdppB,KAAKupB,MAAQ,EACbvpB,KAAKqpB,SAAW,EAChBrpB,KAAKypB,WAAa,EAClBzpB,KAAK0pB,eAAgB,EACd1pB,KAGT,iBACMA,KAAKqpB,WAAarpB,KAAK+oB,aACzB/oB,KAAK6pB,eAAiB7pB,KAAKupB,MAC3BvpB,KAAK4pB,gBAAkB5pB,KAAKopB,OAC5BppB,KAAKsO,OAAStO,KAAKopB,OACnBppB,KAAK4lB,MAAQ5lB,KAAKupB,MAClBvpB,KAAKipB,SAAWjpB,KAAKqpB,SACrBrpB,KAAKupB,MAAQ,EACbvpB,KAAKopB,OAAS,EACdppB,KAAKqpB,SAAW,ICtHP,MAAM,EACnB,aAAY,GACVzd,EAAE,MACFwR,IAEApd,KAAK4L,GAAKA,EACV5L,KAAKod,MAAQ,GAEbpd,KAAK8pB,iBAAiB1M,GAEtBtf,OAAOisB,KAAK/pB,MAGd,IAAIrC,EAAM6L,EAAO,SACf,OAAOxJ,KAAKgqB,aAAa,CACvBrsB,OACA6L,SAIJ,WACE,OAAO1L,OAAO4iB,KAAK1gB,KAAKod,OAAO7c,OAGjC,QACE,IAAK,MAAM5B,KAAOqB,KAAKod,MACrBpd,KAAKod,MAAMze,GAAKqqB,QAGlB,OAAOhpB,KAGT,QAAQshB,GACN,IAAK,MAAM3iB,KAAOqB,KAAKod,MACrBkE,EAAGthB,KAAKod,MAAMze,IAIlB,WACE,MAAMsrB,EAAQ,GASd,OARAjqB,KAAKyN,QAAQyc,IACXD,EAAMC,EAAKvsB,MAAQ,CACjBioB,KAAMsE,EAAKtE,MAAQ,EACnBtX,MAAO4b,EAAK5b,OAAS,EACrB6b,QAASD,EAAKE,kBAAoB,EAClCC,GAAIH,EAAKI,SAAW,KAGjBL,EAGT,iBAAiB7M,EAAQ,IACvBA,EAAM3P,QAAQyc,GAAQlqB,KAAKgqB,aAAaE,IAG1C,aAAaA,GACX,IAAKA,IAASA,EAAKvsB,KACjB,OAAO,KAGT,MAAM,KACJA,EAAI,KACJ6L,GACE0gB,EAUJ,OARKlqB,KAAKod,MAAMzf,KAEZqC,KAAKod,MAAMzf,GADTusB,aAAgB,EACCA,EAEA,IAAI,EAAKvsB,EAAM6L,IAI/BxJ,KAAKod,MAAMzf","file":"dist.es5.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 30);\n","// Replacement for the external assert method to reduce bundle size\n// Note: We don't use the second \"message\" argument in calling code,\n// so no need to support it here\n\n/** Throws an `Error` with the optional `message` if `condition` is falsy */\nexport function assert(condition: any, message?: string): void {\n  if (!condition) {\n    throw new Error(message || 'loaders.gl assertion failed.');\n  }\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","export default function getHiResTimestamp() {\n  let timestamp;\n\n  if (typeof window !== 'undefined' && window.performance) {\n    timestamp = window.performance.now();\n  } else if (typeof process !== 'undefined' && process.hrtime) {\n    const timeParts = process.hrtime();\n    timestamp = timeParts[0] * 1000 + timeParts[1] / 1e6;\n  } else {\n    timestamp = Date.now();\n  }\n\n  return timestamp;\n}\n//# sourceMappingURL=hi-res-timestamp.js.map","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","export function assert(condition, message) {\n  if (!condition) {\n    throw new Error(message);\n  }\n}\n","import type {ImageType, ImageTypeEnum, ImageDataType} from '../../types';\n\nexport function isImage(image: ImageType): boolean {\n  return Boolean(getImageTypeOrNull(image));\n}\n\nexport function deleteImage(image: ImageType): void {\n  switch (getImageType(image)) {\n    case 'imagebitmap':\n      (image as ImageBitmap).close();\n      break;\n    default:\n    // Nothing to do for images and image data objects\n  }\n}\n\nexport function getImageType(image: ImageType): ImageTypeEnum {\n  const format = getImageTypeOrNull(image);\n  if (!format) {\n    throw new Error('Not an image');\n  }\n  return format;\n}\n\nexport function getImageSize(image: ImageType): {width: number; height: number} {\n  return getImageData(image);\n}\n\nexport function getImageData(image: ImageType): ImageDataType | ImageData {\n  switch (getImageType(image)) {\n    case 'data':\n      return image as unknown as ImageData;\n\n    case 'image':\n    case 'imagebitmap':\n      // Extract the image data from the image via a canvas\n      const canvas = document.createElement('canvas');\n      // TODO - reuse the canvas?\n      const context = canvas.getContext('2d');\n      if (!context) {\n        throw new Error('getImageData');\n      }\n      // @ts-ignore\n      canvas.width = image.width;\n      // @ts-ignore\n      canvas.height = image.height;\n      // @ts-ignore\n      context.drawImage(image, 0, 0);\n      // @ts-ignore\n      return context.getImageData(0, 0, image.width, image.height);\n\n    default:\n      throw new Error('getImageData');\n  }\n}\n\n// PRIVATE\n\n// eslint-disable-next-line complexity\nfunction getImageTypeOrNull(image) {\n  if (typeof ImageBitmap !== 'undefined' && image instanceof ImageBitmap) {\n    return 'imagebitmap';\n  }\n  if (typeof Image !== 'undefined' && image instanceof Image) {\n    return 'image';\n  }\n  if (image && typeof image === 'object' && image.data && image.width && image.height) {\n    return 'data';\n  }\n  return null;\n}\n","// Version constant cannot be imported, it needs to correspond to the build version of **this** module.\n// __VERSION__ is injected by babel-plugin-version-inline\n\n// Change to `latest` on production branches\nconst DEFAULT_VERSION = 'beta';\ndeclare let __VERSION__;\nexport const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : DEFAULT_VERSION;\nif (typeof __VERSION__ === 'undefined') {\n  // eslint-disable-next-line\n  console.error(\n    'loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN.'\n  );\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// Purpose: include this in your module to avoids adding dependencies on\n// micro modules like 'global' and 'is-browser';\n\n/* eslint-disable no-restricted-globals */\nconst globals = {\n  self: typeof self !== 'undefined' && self,\n  window: typeof window !== 'undefined' && window,\n  global: typeof global !== 'undefined' && global,\n  document: typeof document !== 'undefined' && document\n};\n\nconst self_ = globals.self || globals.window || globals.global;\nconst window_ = globals.window || globals.self || globals.global;\nconst global_ = globals.global || globals.self || globals.window;\nconst document_ = globals.document || {};\n\nexport {self_ as self, window_ as window, global_ as global, document_ as document};\n\nexport const isBrowser =\n  // @ts-ignore\n  typeof process !== 'object' || String(process) !== '[object process]' || process.browser;\n\nexport const isWorker = typeof importScripts === 'function';\n\n// Extract node major version\nconst matches =\n  typeof process !== 'undefined' && process.version && /v([0-9]*)/.exec(process.version);\nexport const nodeVersion = (matches && parseFloat(matches[1])) || 0;\n","// Attributions\n// * Based on binary-gltf-utils under MIT license: Copyright (c) 2016-17 Karl Cheng\n\n// TODO: make these functions work for Node.js buffers?\n// Quarantine references to Buffer to prevent bundler from adding big polyfills\n// import {bufferToArrayBuffer} from '../node/buffer-to-array-buffer';\n// TODO - this should be handled in @loaders.gl/polyfills\n\n/** MIME type, width and height extracted from binary compressed image data */\nexport type BinaryImageMetadata = {\n  mimeType: string;\n  width: number;\n  height: number;\n};\n\nconst BIG_ENDIAN = false;\nconst LITTLE_ENDIAN = true;\n\n/**\n * Extracts `{mimeType, width and height}` from a memory buffer containing a known image format\n * Currently supports `image/png`, `image/jpeg`, `image/bmp` and `image/gif`.\n * @param binaryData image file memory to parse\n * @returns metadata or null if memory is not a valid image file format layout.\n */\nexport function getBinaryImageMetadata(\n  binaryData: DataView | ArrayBuffer\n): BinaryImageMetadata | null {\n  const dataView = toDataView(binaryData);\n  return (\n    getPngMetadata(dataView) ||\n    getJpegMetadata(dataView) ||\n    getGifMetadata(dataView) ||\n    getBmpMetadata(dataView)\n  );\n}\n\n// PNG\n\nfunction getPngMetadata(binaryData) {\n  const dataView = toDataView(binaryData);\n  // Check file contains the first 4 bytes of the PNG signature.\n  const isPng = dataView.byteLength >= 24 && dataView.getUint32(0, BIG_ENDIAN) === 0x89504e47;\n  if (!isPng) {\n    return null;\n  }\n\n  // Extract size from a binary PNG file\n  return {\n    mimeType: 'image/png',\n    width: dataView.getUint32(16, BIG_ENDIAN),\n    height: dataView.getUint32(20, BIG_ENDIAN)\n  };\n}\n\n// GIF\n\n// Extract size from a binary GIF file\n// TODO: GIF is not this simple\nfunction getGifMetadata(binaryData) {\n  const dataView = toDataView(binaryData);\n  // Check first 4 bytes of the GIF signature (\"GIF8\").\n  const isGif = dataView.byteLength >= 10 && dataView.getUint32(0, BIG_ENDIAN) === 0x47494638;\n  if (!isGif) {\n    return null;\n  }\n\n  // GIF is little endian.\n  return {\n    mimeType: 'image/gif',\n    width: dataView.getUint16(6, LITTLE_ENDIAN),\n    height: dataView.getUint16(8, LITTLE_ENDIAN)\n  };\n}\n\n// BMP\n\n// TODO: BMP is not this simple\nexport function getBmpMetadata(binaryData) {\n  const dataView = toDataView(binaryData);\n  // Check magic number is valid (first 2 characters should be \"BM\").\n  // The mandatory bitmap file header is 14 bytes long.\n  const isBmp =\n    dataView.byteLength >= 14 &&\n    dataView.getUint16(0, BIG_ENDIAN) === 0x424d &&\n    dataView.getUint32(2, LITTLE_ENDIAN) === dataView.byteLength;\n\n  if (!isBmp) {\n    return null;\n  }\n\n  // BMP is little endian.\n  return {\n    mimeType: 'image/bmp',\n    width: dataView.getUint32(18, LITTLE_ENDIAN),\n    height: dataView.getUint32(22, LITTLE_ENDIAN)\n  };\n}\n\n// JPEG\n\n// Extract width and height from a binary JPEG file\nfunction getJpegMetadata(binaryData) {\n  const dataView = toDataView(binaryData);\n  // Check file contains the JPEG \"start of image\" (SOI) marker\n  // followed by another marker.\n  const isJpeg =\n    dataView.byteLength >= 3 &&\n    dataView.getUint16(0, BIG_ENDIAN) === 0xffd8 &&\n    dataView.getUint8(2) === 0xff;\n\n  if (!isJpeg) {\n    return null;\n  }\n\n  const {tableMarkers, sofMarkers} = getJpegMarkers();\n\n  // Exclude the two byte SOI marker.\n  let i = 2;\n  while (i + 9 < dataView.byteLength) {\n    const marker = dataView.getUint16(i, BIG_ENDIAN);\n\n    // The frame that contains the width and height of the JPEG image.\n    if (sofMarkers.has(marker)) {\n      return {\n        mimeType: 'image/jpeg',\n        height: dataView.getUint16(i + 5, BIG_ENDIAN), // Number of lines\n        width: dataView.getUint16(i + 7, BIG_ENDIAN) // Number of pixels per line\n      };\n    }\n\n    // Miscellaneous tables/data preceding the frame header.\n    if (!tableMarkers.has(marker)) {\n      return null;\n    }\n\n    // Length includes size of length parameter but not the two byte header.\n    i += 2;\n    i += dataView.getUint16(i, BIG_ENDIAN);\n  }\n\n  return null;\n}\n\nfunction getJpegMarkers() {\n  // Tables/misc header markers.\n  // DQT, DHT, DAC, DRI, COM, APP_n\n  const tableMarkers = new Set([0xffdb, 0xffc4, 0xffcc, 0xffdd, 0xfffe]);\n  for (let i = 0xffe0; i < 0xfff0; ++i) {\n    tableMarkers.add(i);\n  }\n\n  // SOF markers and DHP marker.\n  // These markers are after tables/misc data.\n  const sofMarkers = new Set([\n    0xffc0, 0xffc1, 0xffc2, 0xffc3, 0xffc5, 0xffc6, 0xffc7, 0xffc9, 0xffca, 0xffcb, 0xffcd, 0xffce,\n    0xffcf, 0xffde\n  ]);\n\n  return {tableMarkers, sofMarkers};\n}\n\n// TODO - move into image module?\nfunction toDataView(data) {\n  if (data instanceof DataView) {\n    return data;\n  }\n  if (ArrayBuffer.isView(data)) {\n    return new DataView(data.buffer);\n  }\n\n  // TODO: make these functions work for Node.js buffers?\n  // if (bufferToArrayBuffer) {\n  //   data = bufferToArrayBuffer(data);\n  // }\n\n  // Careful - Node Buffers will look like ArrayBuffers (keep after isBuffer)\n  if (data instanceof ArrayBuffer) {\n    return new DataView(data);\n  }\n  throw new Error('toDataView');\n}\n","// Purpose: include this in your module to avoids adding dependencies on\n// micro modules like 'global' and 'is-browser';\n\n/* eslint-disable no-restricted-globals */\nconst globals = {\n  self: typeof self !== 'undefined' && self,\n  window: typeof window !== 'undefined' && window,\n  global: typeof global !== 'undefined' && global,\n  document: typeof document !== 'undefined' && document\n};\n\nconst self_: {[key: string]: any} = globals.self || globals.window || globals.global || {};\nconst window_: {[key: string]: any} = globals.window || globals.self || globals.global || {};\nconst global_: {[key: string]: any} = globals.global || globals.self || globals.window || {};\nconst document_: {[key: string]: any} = globals.document || {};\n\nexport {self_ as self, window_ as window, global_ as global, document_ as document};\n\n/** true if running in the browser, false if running in Node.js */\nexport const isBrowser: boolean =\n  // @ts-ignore process.browser\n  typeof process !== 'object' || String(process) !== '[object process]' || process.browser;\n\n/** true if running on a worker thread */\nexport const isWorker: boolean = typeof importScripts === 'function';\n\n/** true if running on a mobile device */\nexport const isMobile: boolean =\n  typeof window !== 'undefined' && typeof window.orientation !== 'undefined';\n\n// Extract node major version\nconst matches =\n  typeof process !== 'undefined' && process.version && /v([0-9]*)/.exec(process.version);\n\n/** Version of Node.js if running under Node, otherwise 0 */\nexport const nodeVersion: number = (matches && parseFloat(matches[1])) || 0;\n","import {assert} from '../env-utils/assert';\nimport {getLoadableWorkerURL} from '../worker-utils/get-loadable-worker-url';\nimport {getTransferList} from '../worker-utils/get-transfer-list';\n\nconst NOOP = () => {};\n\nexport type WorkerThreadProps = {\n  name: string;\n  source?: string;\n  url?: string;\n};\n\n/**\n * Represents one worker thread\n */\nexport default class WorkerThread {\n  readonly name: string;\n  readonly source: string | undefined;\n  readonly url: string | undefined;\n  terminated: boolean = false;\n  worker: Worker;\n  onMessage: (message: any) => void;\n  onError: (error: Error) => void;\n\n  private _loadableURL: string = '';\n\n  static isSupported(): boolean {\n    return typeof Worker !== 'undefined';\n  }\n\n  constructor(props: WorkerThreadProps) {\n    const {name, source, url} = props;\n    assert(source || url); // Either source or url must be defined\n    this.name = name;\n    this.source = source;\n    this.url = url;\n    this.onMessage = NOOP;\n    this.onError = (error) => console.log(error); // eslint-disable-line\n\n    this.worker = this._createBrowserWorker();\n  }\n\n  /**\n   * Terminate this worker thread\n   * @note Can free up significant memory\n   */\n  destroy(): void {\n    this.onMessage = NOOP;\n    this.onError = NOOP;\n    // @ts-ignore\n    this.worker.terminate();\n    this.terminated = true;\n  }\n\n  get isRunning() {\n    return Boolean(this.onMessage);\n  }\n\n  /**\n   * Send a message to this worker thread\n   * @param data any data structure, ideally consisting mostly of transferrable objects\n   * @param transferList If not supplied, calculated automatically by traversing data\n   */\n  postMessage(data: any, transferList?: any[]): void {\n    transferList = transferList || getTransferList(data);\n    // @ts-ignore\n    this.worker.postMessage(data, transferList);\n  }\n\n  // PRIVATE\n\n  /**\n   * Generate a standard Error from an ErrorEvent\n   * @param {ErrorEvent} event\n   */\n  _getErrorFromErrorEvent(event) {\n    // Note Error object does not have the expected fields if loading failed completely\n    // https://developer.mozilla.org/en-US/docs/Web/API/Worker#Event_handlers\n    // https://developer.mozilla.org/en-US/docs/Web/API/ErrorEvent\n    let message = 'Failed to load ';\n    message += `worker ${this.name}. `;\n    if (event.message) {\n      message += `${event.message} in `;\n    }\n    // const hasFilename = event.filename && !event.filename.startsWith('blob:');\n    // message += hasFilename ? event.filename : this.source.slice(0, 100);\n    if (event.lineno) {\n      message += `:${event.lineno}:${event.colno}`;\n    }\n    return new Error(message);\n  }\n\n  /**\n   * Creates a worker thread on the browser\n   */\n  _createBrowserWorker() {\n    this._loadableURL = getLoadableWorkerURL({source: this.source, url: this.url});\n    const worker = new Worker(this._loadableURL, {name: this.name});\n\n    worker.onmessage = (event) => {\n      if (!event.data) {\n        this.onError(new Error('No data received'));\n      } else {\n        this.onMessage(event.data);\n      }\n    };\n    // This callback represents an uncaught exception in the worker thread\n    worker.onerror = (error) => {\n      this.onError(this._getErrorFromErrorEvent(error));\n      this.terminated = true;\n    };\n    // TODO - not clear when this would be called, for now just log in case it happens\n    worker.onmessageerror = (event) => console.error(event); // eslint-disable-line\n\n    return worker;\n  }\n}\n","// NOTE - there is a copy of this function is both in core and loader-utils\n// core does not need all the utils in loader-utils, just this one.\n\n/**\n * Returns an array of Transferrable objects that can be used with postMessage\n * https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage\n * @param object data to be sent via postMessage\n * @param recursive - not for application use\n * @param transfers - not for application use\n * @returns a transfer list that can be passed to postMessage\n */\nexport function getTransferList(\n  object: any,\n  recursive: boolean = true,\n  transfers?: Set<any>\n): Transferable[] {\n  // Make sure that items in the transfer list is unique\n  const transfersSet = transfers || new Set();\n\n  if (!object) {\n    // ignore\n  } else if (isTransferable(object)) {\n    transfersSet.add(object);\n  } else if (isTransferable(object.buffer)) {\n    // Typed array\n    transfersSet.add(object.buffer);\n  } else if (ArrayBuffer.isView(object)) {\n    // object is a TypeArray viewing into a SharedArrayBuffer (not transferable)\n    // Do not iterate through the content in this case\n  } else if (recursive && typeof object === 'object') {\n    for (const key in object) {\n      // Avoid perf hit - only go one level deep\n      getTransferList(object[key], recursive, transfersSet);\n    }\n  }\n\n  // If transfers is defined, is internal recursive call\n  // Otherwise it's called by the user\n  return transfers === undefined ? Array.from(transfersSet) : [];\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Transferable\nfunction isTransferable(object) {\n  if (!object) {\n    return false;\n  }\n  if (object instanceof ArrayBuffer) {\n    return true;\n  }\n  if (typeof MessagePort !== 'undefined' && object instanceof MessagePort) {\n    return true;\n  }\n  if (typeof ImageBitmap !== 'undefined' && object instanceof ImageBitmap) {\n    return true;\n  }\n  if (typeof OffscreenCanvas !== 'undefined' && object instanceof OffscreenCanvas) {\n    return true;\n  }\n  return false;\n}\n","// Version constant cannot be imported, it needs to correspond to the build version of **this** module.\n// __VERSION__ is injected by babel-plugin-version-inline\n// @ts-ignore TS2304: Cannot find name '__VERSION__'.\nexport const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'latest';\n","import {assert} from '../utils/assert';\nimport {isImageTypeSupported, getDefaultImageType} from '../category-api/image-type';\nimport {getImageData} from '../category-api/parsed-image-api';\nimport parseToImage from './parse-to-image';\nimport parseToImageBitmap from './parse-to-image-bitmap';\nimport parseToNodeImage from './parse-to-node-image';\n\n// Parse to platform defined image type (data on node, ImageBitmap or HTMLImage on browser)\n// eslint-disable-next-line complexity\nexport default async function parseImage(arrayBuffer, options, context) {\n  options = options || {};\n  const imageOptions = options.image || {};\n\n  // The user can request a specific output format via `options.image.type`\n  const imageType = imageOptions.type || 'auto';\n\n  const {url} = context || {};\n\n  // Note: For options.image.type === `data`, we may still need to load as `image` or `imagebitmap`\n  const loadType = getLoadableImageType(imageType);\n\n  let image;\n  switch (loadType) {\n    case 'imagebitmap':\n      image = await parseToImageBitmap(arrayBuffer, options, url);\n      break;\n    case 'image':\n      image = await parseToImage(arrayBuffer, options, url);\n      break;\n    case 'data':\n      // Node.js loads imagedata directly\n      image = await parseToNodeImage(arrayBuffer, options);\n      break;\n    default:\n      assert(false);\n  }\n\n  // Browser: if options.image.type === 'data', we can now extract data from the loaded image\n  if (imageType === 'data') {\n    image = getImageData(image);\n  }\n\n  return image;\n}\n\n// Get a loadable image type from image type\nfunction getLoadableImageType(type) {\n  switch (type) {\n    case 'auto':\n    case 'data':\n      // Browser: For image data we need still need to load using an image format\n      // Node: the default image type is `data`.\n      return getDefaultImageType();\n    default:\n      // Throw an error if not supported\n      isImageTypeSupported(type);\n      return type;\n  }\n}\n","import type {ImageTypeEnum} from '../../types';\nimport {global, isBrowser} from '../utils/globals';\n\n// @ts-ignore TS2339: Property does not exist on type\nconst {_parseImageNode} = global;\n\nconst IMAGE_SUPPORTED = typeof Image !== 'undefined'; // NOTE: \"false\" positives if jsdom is installed\nconst IMAGE_BITMAP_SUPPORTED = typeof ImageBitmap !== 'undefined';\nconst NODE_IMAGE_SUPPORTED = Boolean(_parseImageNode);\nconst DATA_SUPPORTED = isBrowser ? true : NODE_IMAGE_SUPPORTED;\n\n/**\n * Checks if a loaders.gl image type is supported\n * @param type image type string\n */\nexport function isImageTypeSupported(type: string): boolean {\n  switch (type) {\n    case 'auto':\n      // Should only ever be false in Node.js, if polyfills have not been installed...\n      return IMAGE_BITMAP_SUPPORTED || IMAGE_SUPPORTED || DATA_SUPPORTED;\n\n    case 'imagebitmap':\n      return IMAGE_BITMAP_SUPPORTED;\n    case 'image':\n      return IMAGE_SUPPORTED;\n    case 'data':\n      return DATA_SUPPORTED;\n\n    default:\n      throw new Error(`@loaders.gl/images: image ${type} not supported in this environment`);\n  }\n}\n\n/**\n * Returns the \"most performant\" supported image type on this platform\n * @returns image type string\n */\nexport function getDefaultImageType(): ImageTypeEnum {\n  if (IMAGE_BITMAP_SUPPORTED) {\n    return 'imagebitmap';\n  }\n  if (IMAGE_SUPPORTED) {\n    return 'image';\n  }\n  if (DATA_SUPPORTED) {\n    return 'data';\n  }\n\n  // This should only happen in Node.js\n  throw new Error('Install \\'@loaders.gl/polyfills\\' to parse images under Node.js');\n}\n","import {getBlobOrSVGDataUrl} from './svg-utils';\n\n// Parses html image from array buffer\nexport default async function parseToImage(arrayBuffer, options, url) {\n  // Note: image parsing requires conversion to Blob (for createObjectURL).\n  // Potentially inefficient for not using `response.blob()` (and for File / Blob inputs)...\n  // But presumably not worth adding 'blob' flag to loader objects?\n\n  const blobOrDataUrl = getBlobOrSVGDataUrl(arrayBuffer, url);\n  const URL = self.URL || self.webkitURL;\n  const objectUrl = typeof blobOrDataUrl !== 'string' && URL.createObjectURL(blobOrDataUrl);\n  try {\n    return await loadToImage(objectUrl || blobOrDataUrl, options);\n  } finally {\n    if (objectUrl) {\n      URL.revokeObjectURL(objectUrl);\n    }\n  }\n}\n\nexport async function loadToImage(url, options) {\n  const image = new Image();\n  image.src = url;\n\n  // The `image.onload()` callback does not guarantee that the image has been decoded\n  // so a main thread \"freeze\" can be incurred when using the image for the first time.\n  // `Image.decode()` returns a promise that completes when image is decoded.\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode\n  // Note: When calling `img.decode()`, we do not need to wait for `img.onload()`\n  // Note: `HTMLImageElement.decode()` is not available in Edge and IE11\n  if (options.image && options.image.decode && image.decode) {\n    await image.decode();\n    return image;\n  }\n\n  // Create a promise that tracks onload/onerror callbacks\n  return await new Promise((resolve, reject) => {\n    try {\n      image.onload = () => resolve(image);\n      image.onerror = (err) => reject(new Error(`Could not load image ${url}: ${err}`));\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n","// SVG parsing has limitations, e.g:\n// https://bugs.chromium.org/p/chromium/issues/detail?id=606319\n\nconst SVG_DATA_URL_PATTERN = /^data:image\\/svg\\+xml/;\nconst SVG_URL_PATTERN = /\\.svg((\\?|#).*)?$/;\n\nexport function isSVG(url) {\n  return url && (SVG_DATA_URL_PATTERN.test(url) || SVG_URL_PATTERN.test(url));\n}\n\nexport function getBlobOrSVGDataUrl(arrayBuffer, url) {\n  if (isSVG(url)) {\n    // Prepare a properly tagged data URL, and load using normal mechanism\n    const textDecoder = new TextDecoder();\n    const xmlText = textDecoder.decode(arrayBuffer);\n    // TODO Escape in browser to support e.g. Chinese characters\n    // if (typeof unescape === 'function' && typeof encodeURLComponent === 'function') {\n    //   xmlText = unescape(encodeURLComponent(xmlText));\n    // }\n    // base64 encoding is safer. utf-8 fails in some browsers\n    const src = `data:image/svg+xml;base64,${btoa(xmlText)}`;\n    return src;\n  }\n  return getBlob(arrayBuffer, url);\n}\n\nexport function getBlob(arrayBuffer, url) {\n  if (isSVG(url)) {\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=606319\n    // return new Blob([new Uint8Array(arrayBuffer)], {type: 'image/svg+xml'});\n    throw new Error('SVG cannot be parsed directly to imagebitmap');\n  }\n  // TODO - how to determine mime type? Param? Sniff here?\n  return new Blob([new Uint8Array(arrayBuffer)]); // MIME type not needed?\n}\n","/**\n * Throws an `Error` with the optional `message` if `condition` is falsy\n * @note Replacement for the external assert method to reduce bundle size\n */\nexport function assert(condition: any, message?: string): void {\n  if (!condition) {\n    throw new Error(message || 'loader assertion failed.');\n  }\n}\n","import type {WorkerObject} from './types';\nimport {VERSION} from './lib/env-utils/version';\n\n// TYPES\nexport type {\n  WorkerObject,\n  WorkerOptions,\n  // Protocol\n  WorkerMessage,\n  WorkerMessageType,\n  WorkerMessageData,\n  WorkerMessagePayload\n} from './types';\n\n// GENERAL UTILS\nexport {assert} from './lib/env-utils/assert';\nexport {isBrowser, isWorker} from './lib/env-utils/globals';\n\n// WORKER UTILS - TYPES\nexport {default as WorkerJob} from './lib/worker-farm/worker-job';\nexport {default as WorkerThread} from './lib/worker-farm/worker-thread';\n\n// WORKER FARMS\nexport {default as WorkerFarm} from './lib/worker-farm/worker-farm';\nexport {default as WorkerPool} from './lib/worker-farm/worker-pool';\nexport {default as WorkerBody} from './lib/worker-farm/worker-body';\n\nexport {processOnWorker, canProcessOnWorker} from './lib/worker-api/process-on-worker';\nexport {createWorker} from './lib/worker-api/create-worker';\n\n// WORKER UTILS - EXPORTS\nexport {getWorkerURL} from './lib/worker-api/get-worker-url';\nexport {validateWorkerVersion} from './lib/worker-api/validate-worker-version';\nexport {getTransferList} from './lib/worker-utils/get-transfer-list';\n\n// LIBRARY UTILS\nexport {getLibraryUrl, loadLibrary} from './lib/library-utils/library-utils';\n\n// PARSER UTILS\nexport {default as AsyncQueue} from './lib/async-queue/async-queue';\n\n// PROCESS UTILS\nexport {default as ChildProcessProxy} from './lib/process-utils/child-process-proxy';\n\n// WORKER OBJECTS\n\n/** A null worker to test that worker processing is functional */\nexport const NullWorker: WorkerObject = {\n  id: 'null',\n  name: 'null',\n  module: 'worker-utils',\n  version: VERSION,\n  options: {\n    null: {}\n  }\n};\n","import type {WorkerMessageType, WorkerMessagePayload} from '../../types';\nimport WorkerThread from './worker-thread';\nimport {assert} from '../env-utils/assert';\n\n/**\n * Represents one Job handled by a WorkerPool or WorkerFarm\n */\nexport default class WorkerJob {\n  readonly name: string;\n  readonly workerThread: WorkerThread;\n  isRunning: boolean;\n  /** Promise that resolves when Job is done */\n  readonly result: Promise<any>;\n\n  private _resolve: (value: any) => void;\n  private _reject: (reason?: any) => void;\n\n  constructor(jobName: string, workerThread: WorkerThread) {\n    this.name = jobName;\n    this.workerThread = workerThread;\n    this.isRunning = true;\n    this._resolve = () => {};\n    this._reject = () => {};\n    this.result = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  /**\n   * Send a message to the job's worker thread\n   * @param data any data structure, ideally consisting mostly of transferrable objects\n   */\n  postMessage(type: WorkerMessageType, payload: WorkerMessagePayload): void {\n    this.workerThread.postMessage({\n      source: 'loaders.gl', // Lets worker ignore unrelated messages\n      type,\n      payload\n    });\n  }\n\n  /**\n   * Call to resolve the `result` Promise with the supplied value\n   */\n  done(value): void {\n    assert(this.isRunning);\n    this.isRunning = false;\n    this._resolve(value);\n  }\n\n  /**\n   * Call to reject the `result` Promise with the supplied error\n   */\n  error(error): void {\n    assert(this.isRunning);\n    this.isRunning = false;\n    this._reject(error);\n  }\n}\n","import WorkerPool from './worker-pool';\nimport WorkerThread from './worker-thread';\n\n/**\n * @param maxConcurrency {number} - max count of workers\n */\nexport type WorkerFarmProps = {\n  maxConcurrency?: number;\n  maxMobileConcurrency?: number;\n  reuseWorkers?: boolean;\n  onDebug?: () => void;\n};\n\nconst DEFAULT_PROPS: WorkerFarmProps = {\n  maxConcurrency: 3,\n  maxMobileConcurrency: 1,\n  onDebug: () => {},\n  reuseWorkers: true\n};\n\n/**\n * Process multiple jobs with a \"farm\" of different workers in worker pools.\n */\nexport default class WorkerFarm {\n  private props: WorkerFarmProps;\n  private workerPools = new Map<string, WorkerPool>();\n  // singleton\n  private static _workerFarm?: WorkerFarm;\n\n  /** Check if Workers are supported */\n  static isSupported(): boolean {\n    return WorkerThread.isSupported();\n  }\n\n  /** Get the singleton instance of the global worker farm */\n  static getWorkerFarm(props: WorkerFarmProps = {}): WorkerFarm {\n    WorkerFarm._workerFarm = WorkerFarm._workerFarm || new WorkerFarm({});\n    WorkerFarm._workerFarm.setProps(props);\n    return WorkerFarm._workerFarm;\n  }\n\n  /** get global instance with WorkerFarm.getWorkerFarm() */\n  private constructor(props: WorkerFarmProps) {\n    this.props = {...DEFAULT_PROPS};\n    this.setProps(props);\n    /** @type Map<string, WorkerPool>} */\n    this.workerPools = new Map();\n  }\n\n  /**\n   * Terminate all workers in the farm\n   * @note Can free up significant memory\n   */\n  destroy(): void {\n    for (const workerPool of this.workerPools.values()) {\n      workerPool.destroy();\n    }\n  }\n\n  /**\n   * Set props used when initializing worker pools\n   * @param props\n   */\n  setProps(props: WorkerFarmProps): void {\n    this.props = {...this.props, ...props};\n    // Update worker pool props\n    for (const workerPool of this.workerPools.values()) {\n      workerPool.setProps(this._getWorkerPoolProps());\n    }\n  }\n\n  /**\n   * Returns a worker pool for the specified worker\n   * @param options - only used first time for a specific worker name\n   * @param options.name - the name of the worker - used to identify worker pool\n   * @param options.url -\n   * @param options.source -\n   * @example\n   *   const job = WorkerFarm.getWorkerFarm().getWorkerPool({name, url}).startJob(...);\n   */\n  getWorkerPool(options: {name: string; source?: string; url?: string}): WorkerPool {\n    const {name, source, url} = options;\n    let workerPool = this.workerPools.get(name);\n    if (!workerPool) {\n      workerPool = new WorkerPool({\n        name,\n        source,\n        url\n      });\n      workerPool.setProps(this._getWorkerPoolProps());\n      this.workerPools.set(name, workerPool);\n    }\n    return workerPool;\n  }\n\n  _getWorkerPoolProps() {\n    return {\n      maxConcurrency: this.props.maxConcurrency,\n      maxMobileConcurrency: this.props.maxMobileConcurrency,\n      reuseWorkers: this.props.reuseWorkers,\n      onDebug: this.props.onDebug\n    };\n  }\n}\n","import type {WorkerMessageType, WorkerMessagePayload} from '../../types';\nimport {isMobile} from '../env-utils/globals';\nimport WorkerThread from './worker-thread';\nimport WorkerJob from './worker-job';\n\n/** WorkerPool onDebug Callback Parameters */\ntype OnDebugParameters = {\n  message: string;\n  worker: string;\n  name: string;\n  job: string;\n  backlog: number;\n  workerThread: WorkerThread;\n};\n\n/** WorkerPool Properties */\nexport type WorkerPoolProps = {\n  name?: string;\n  source?: string; // | Function;\n  url?: string;\n  maxConcurrency?: number;\n  maxMobileConcurrency?: number;\n  onDebug?: (options: OnDebugParameters) => any;\n  reuseWorkers?: boolean;\n};\n\n/** Private helper types */\ntype OnMessage = (job: WorkerJob, type: WorkerMessageType, payload: WorkerMessagePayload) => void;\ntype OnError = (job: WorkerJob, error: Error) => void;\n\ntype QueuedJob = {\n  name: string;\n  onMessage: OnMessage;\n  onError: OnError;\n  onStart: (value: any) => void; // Resolve job start promise\n};\n\n/**\n * Process multiple data messages with small pool of identical workers\n */\nexport default class WorkerPool {\n  name: string = 'unnamed';\n  source?: string; // | Function;\n  url?: string;\n  maxConcurrency: number = 1;\n  maxMobileConcurrency: number = 1;\n  onDebug: (options: OnDebugParameters) => any = () => {};\n  reuseWorkers: boolean = true;\n\n  private props: WorkerPoolProps = {};\n  private jobQueue: QueuedJob[] = [];\n  private idleQueue: WorkerThread[] = [];\n  private count = 0;\n  private isDestroyed = false;\n\n  /**\n   * @param processor - worker function\n   * @param maxConcurrency - max count of workers\n   */\n  constructor(props: WorkerPoolProps) {\n    this.source = props.source;\n    this.url = props.url;\n    this.setProps(props);\n  }\n\n  /**\n   * Terminates all workers in the pool\n   * @note Can free up significant memory\n   */\n  destroy(): void {\n    // Destroy idle workers, active Workers will be destroyed on completion\n    this.idleQueue.forEach((worker) => worker.destroy());\n    this.isDestroyed = true;\n  }\n\n  setProps(props: WorkerPoolProps) {\n    this.props = {...this.props, ...props};\n\n    if (props.name !== undefined) {\n      this.name = props.name;\n    }\n    if (props.maxConcurrency !== undefined) {\n      this.maxConcurrency = props.maxConcurrency;\n    }\n    if (props.maxMobileConcurrency !== undefined) {\n      this.maxMobileConcurrency = props.maxMobileConcurrency;\n    }\n    if (props.reuseWorkers !== undefined) {\n      this.reuseWorkers = props.reuseWorkers;\n    }\n    if (props.onDebug !== undefined) {\n      this.onDebug = props.onDebug;\n    }\n  }\n\n  async startJob(\n    name: string,\n    onMessage: OnMessage = (job, type, data) => job.done(data),\n    onError: OnError = (job, error) => job.error(error)\n  ): Promise<WorkerJob> {\n    // Promise resolves when thread starts working on this job\n    const startPromise = new Promise<WorkerJob>((onStart) => {\n      // Promise resolves when thread completes or fails working on this job\n      this.jobQueue.push({name, onMessage, onError, onStart});\n      return this;\n    });\n    this._startQueuedJob(); // eslint-disable-line @typescript-eslint/no-floating-promises\n    return await startPromise;\n  }\n\n  // PRIVATE\n\n  /**\n   * Starts first queued job if worker is available or can be created\n   * Called when job is started and whenever a worker returns to the idleQueue\n   */\n  async _startQueuedJob(): Promise<void> {\n    if (!this.jobQueue.length) {\n      return;\n    }\n\n    const workerThread = this._getAvailableWorker();\n    if (!workerThread) {\n      return;\n    }\n\n    // We have a worker, dequeue and start the job\n    const queuedJob = this.jobQueue.shift();\n    if (queuedJob) {\n      // Emit a debug event\n      // @ts-ignore\n      this.onDebug({\n        message: 'Starting job',\n        name: queuedJob.name,\n        workerThread,\n        backlog: this.jobQueue.length\n      });\n\n      // Create a worker job to let the app access thread and manage job completion\n      const job = new WorkerJob(queuedJob.name, workerThread);\n\n      // Set the worker thread's message handlers\n      workerThread.onMessage = (data) => queuedJob.onMessage(job, data.type, data.payload);\n      workerThread.onError = (error) => queuedJob.onError(job, error);\n\n      // Resolve the start promise so that the app can start sending messages to worker\n      queuedJob.onStart(job);\n\n      // Wait for the app to signal that the job is complete, then return worker to queue\n      try {\n        await job.result;\n      } finally {\n        this.returnWorkerToQueue(workerThread);\n      }\n    }\n  }\n\n  /**\n   * Returns a worker to the idle queue\n   * Destroys the worker if\n   *  - pool is destroyed\n   *  - if this pool doesn't reuse workers\n   *  - if maxConcurrency has been lowered\n   * @param worker\n   */\n  returnWorkerToQueue(worker: WorkerThread) {\n    const shouldDestroyWorker =\n      this.isDestroyed || !this.reuseWorkers || this.count > this._getMaxConcurrency();\n\n    if (shouldDestroyWorker) {\n      worker.destroy();\n      this.count--;\n    } else {\n      this.idleQueue.push(worker);\n    }\n\n    if (!this.isDestroyed) {\n      this._startQueuedJob(); // eslint-disable-line @typescript-eslint/no-floating-promises\n    }\n  }\n\n  /**\n   * Returns idle worker or creates new worker if maxConcurrency has not been reached\n   */\n  _getAvailableWorker(): WorkerThread | null {\n    // If a worker has completed and returned to the queue, it can be used\n    if (this.idleQueue.length > 0) {\n      return this.idleQueue.shift() || null;\n    }\n\n    // Create fresh worker if we haven't yet created the max amount of worker threads for this worker source\n    if (this.count < this._getMaxConcurrency()) {\n      this.count++;\n      const name = `${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;\n      return new WorkerThread({name, source: this.source, url: this.url});\n    }\n\n    // No worker available, have to wait\n    return null;\n  }\n\n  _getMaxConcurrency() {\n    return isMobile ? this.maxMobileConcurrency : this.maxConcurrency;\n  }\n}\n","import type {WorkerMessageData, WorkerMessageType, WorkerMessagePayload} from '../../types';\nimport {getTransferList} from '../worker-utils/get-transfer-list';\n\nconst onMessageWrapperMap = new Map();\n\n/**\n * Type safe wrapper for worker code\n */\nexport default class WorkerBody {\n  /*\n   * (type: WorkerMessageType, payload: WorkerMessagePayload) => any\n   */\n  static set onmessage(onMessage: (type: WorkerMessageType, payload: WorkerMessagePayload) => any) {\n    // eslint-disable-next-line no-restricted-globals\n    self.onmessage = (message) => {\n      if (!isKnownMessage(message)) {\n        return;\n      }\n\n      // Confusingly the message itself also has a 'type' field which is always set to 'message'\n      const {type, payload} = message.data;\n      onMessage(type, payload);\n    };\n  }\n\n  static addEventListener(\n    onMessage: (type: WorkerMessageType, payload: WorkerMessagePayload) => any\n  ) {\n    let onMessageWrapper = onMessageWrapperMap.get(onMessage);\n\n    if (!onMessageWrapper) {\n      onMessageWrapper = (message) => {\n        if (!isKnownMessage(message)) {\n          return;\n        }\n\n        // Confusingly the message itself also has a 'type' field which is always set to 'message'\n        const {type, payload} = message.data;\n        onMessage(type, payload);\n      };\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    self.addEventListener('message', onMessageWrapper);\n  }\n\n  static removeEventListener(\n    onMessage: (type: WorkerMessageType, payload: WorkerMessagePayload) => any\n  ) {\n    const onMessageWrapper = onMessageWrapperMap.get(onMessage);\n    onMessageWrapperMap.delete(onMessage);\n    // eslint-disable-next-line no-restricted-globals\n    self.removeEventListener('message', onMessageWrapper);\n  }\n\n  /**\n   * Send a message from a worker to creating thread (main thread)\n   * @param type\n   * @param payload\n   */\n  static postMessage(type: WorkerMessageType, payload: WorkerMessagePayload): void {\n    if (self) {\n      const data: WorkerMessageData = {source: 'loaders.gl', type, payload};\n      const transferList = getTransferList(payload);\n      // eslint-disable-next-line no-restricted-globals\n      // @ts-ignore\n      self.postMessage(data, transferList);\n    }\n  }\n}\n\n// Filter out noise messages sent to workers\nfunction isKnownMessage(message) {\n  const {type, data} = message;\n  return (\n    type === 'message' &&\n    data &&\n    typeof data.source === 'string' &&\n    data.source.startsWith('loaders.gl')\n  );\n}\n","import type {WorkerObject, WorkerOptions} from '../../types';\nimport {assert} from '../env-utils/assert';\nimport {VERSION as __VERSION__} from '../env-utils/version';\n\nconst NPM_TAG = 'latest';\nconst VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : NPM_TAG;\n\n/**\n * Gets worker object's name (for debugging in Chrome thread inspector window)\n */\nexport function getWorkerName(worker: WorkerObject): string {\n  const warning = worker.version !== VERSION ? ` (worker-utils@${VERSION})` : '';\n  return `${worker.name}@${worker.version}${warning}`;\n}\n\n/**\n * Generate a worker URL based on worker object and options\n * @returns A URL to one of the following:\n * - a published worker on unpkg CDN\n * - a local test worker\n * - a URL provided by the user in options\n */\nexport function getWorkerURL(worker: WorkerObject, options: WorkerOptions = {}): string {\n  const workerOptions = options[worker.id] || {};\n\n  const workerFile = `${worker.id}-worker.js`;\n\n  let url = workerOptions.workerUrl;\n\n  // If URL is test, generate local loaders.gl url\n  // @ts-ignore _workerType\n  if (options._workerType === 'test') {\n    url = `modules/${worker.module}/dist/${workerFile}`;\n  }\n\n  // If url override is not provided, generate a URL to published version on npm CDN unpkg.com\n  if (!url) {\n    // GENERATE\n    let version = worker.version;\n    // On master we need to load npm alpha releases published with the `beta` tag\n    if (version === 'latest') {\n      // throw new Error('latest worker version specified');\n      version = NPM_TAG;\n    }\n    const versionTag = version ? `@${version}` : '';\n    url = `https://unpkg.com/@loaders.gl/${worker.module}${versionTag}/dist/${workerFile}`;\n  }\n\n  assert(url);\n\n  // Allow user to override location\n  return url;\n}\n","// From https://github.com/rauschma/async-iter-demo/tree/master/src under MIT license\n// http://2ality.com/2016/10/asynchronous-iteration.html\n\n/**\n * Async Queue\n * - AsyncIterable: An async iterator can be\n * - Values can be pushed onto the queue\n * @example\n *   const asyncQueue = new AsyncQueue();\n *   setTimeout(() => asyncQueue.enqueue('tick'), 1000);\n *   setTimeout(() => asyncQueue.enqueue(new Error('done')), 10000);\n *   for await (const value of asyncQueue) {\n *     console.log(value); // tick\n *   }\n */\nexport default class AsyncQueue<T> {\n  private _values: any[];\n  private _settlers: any[];\n  private _closed: boolean;\n\n  constructor() {\n    this._values = []; // enqueues > dequeues\n    this._settlers = []; // dequeues > enqueues\n    this._closed = false;\n  }\n\n  /** Return an async iterator for this queue */\n  [Symbol.asyncIterator](): AsyncIterator<T> {\n    return this;\n  }\n\n  /** Push a new value - the async iterator will yield a promise resolved to this value */\n  push(value: T): void {\n    return this.enqueue(value);\n  }\n\n  /**\n   * Push a new value - the async iterator will yield a promise resolved to this value\n   * Add an error - the async iterator will yield a promise rejected with this value\n   */\n  enqueue(value: T | Error): void {\n    if (this._closed) {\n      throw new Error('Closed');\n    }\n\n    if (this._settlers.length > 0) {\n      if (this._values.length > 0) {\n        throw new Error('Illegal internal state');\n      }\n      const settler = this._settlers.shift();\n      if (value instanceof Error) {\n        settler.reject(value);\n      } else {\n        settler.resolve({value});\n      }\n    } else {\n      this._values.push(value);\n    }\n  }\n\n  /** Indicate that we not waiting for more values - The async iterator will be done */\n  close(): void {\n    while (this._settlers.length > 0) {\n      const settler = this._settlers.shift();\n      settler.resolve({done: true});\n    }\n    this._closed = true;\n  }\n\n  // ITERATOR IMPLEMENTATION\n\n  /** @returns a Promise for an IteratorResult */\n  next(): Promise<IteratorResult<T, any>> {\n    // If values in queue, yield the first value\n    if (this._values.length > 0) {\n      const value = this._values.shift();\n      if (value instanceof Error) {\n        return Promise.reject(value);\n      }\n      return Promise.resolve({done: false, value});\n    }\n\n    // If queue is closed, the iterator is done\n    if (this._closed) {\n      if (this._settlers.length > 0) {\n        throw new Error('Illegal internal state');\n      }\n      return Promise.resolve({done: true, value: undefined});\n    }\n\n    // Yield a promise that waits for new values to be enqueued\n    return new Promise((resolve, reject) => {\n      this._settlers.push({resolve, reject});\n    });\n  }\n}\n","export function getFirstCharacters(data, length = 5): string {\n  if (typeof data === 'string') {\n    return data.slice(0, length);\n  } else if (ArrayBuffer.isView(data)) {\n    // Typed Arrays can have offsets into underlying buffer\n    return getMagicString(data.buffer, data.byteOffset, length);\n  } else if (data instanceof ArrayBuffer) {\n    const byteOffset = 0;\n    return getMagicString(data, byteOffset, length);\n  }\n  return '';\n}\n\nexport function getMagicString(\n  arrayBuffer: ArrayBuffer,\n  byteOffset: number,\n  length: number\n): string {\n  if (arrayBuffer.byteLength <= byteOffset + length) {\n    return '';\n  }\n  const dataView = new DataView(arrayBuffer);\n  let magic = '';\n  for (let i = 0; i < length; i++) {\n    magic += String.fromCharCode(dataView.getUint8(byteOffset + i));\n  }\n  return magic;\n}\n","import {TypedArray} from '../../types';\nimport * as node from '../node/buffer-utils.node';\n\n/**\n * Convert an object to an array buffer\n */\nexport function toArrayBuffer(data: any): ArrayBuffer {\n  // Note: Should be called first, Buffers can trigger other detections below\n  if (node.toArrayBuffer) {\n    // TODO - per docs we should just be able to call buffer.buffer, but there are issues\n    data = node.toArrayBuffer(data);\n  }\n\n  if (data instanceof ArrayBuffer) {\n    return data;\n  }\n\n  // Careful - Node Buffers will look like ArrayBuffers (keep after isBuffer)\n  if (ArrayBuffer.isView(data)) {\n    return data.buffer;\n  }\n\n  if (typeof data === 'string') {\n    const text = data;\n    const uint8Array = new TextEncoder().encode(text);\n    return uint8Array.buffer;\n  }\n\n  // HACK to support Blob polyfill\n  if (data && typeof data === 'object' && data._toArrayBuffer) {\n    return data._toArrayBuffer();\n  }\n\n  throw new Error('toArrayBuffer');\n}\n\n/**\n * compare two binary arrays for equality\n * @param {ArrayBuffer} a\n * @param {ArrayBuffer} b\n * @param {number} byteLength\n */\nexport function compareArrayBuffers(\n  arrayBuffer1: ArrayBuffer,\n  arrayBuffer2: ArrayBuffer,\n  byteLength?: number\n): boolean {\n  byteLength = byteLength || arrayBuffer1.byteLength;\n  if (arrayBuffer1.byteLength < byteLength || arrayBuffer2.byteLength < byteLength) {\n    return false;\n  }\n  const array1 = new Uint8Array(arrayBuffer1);\n  const array2 = new Uint8Array(arrayBuffer2);\n  for (let i = 0; i < array1.length; ++i) {\n    if (array1[i] !== array2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Concatenate a sequence of ArrayBuffers\n * @return A concatenated ArrayBuffer\n */\nexport function concatenateArrayBuffers(...sources: (ArrayBuffer | Uint8Array)[]): ArrayBuffer {\n  // Make sure all inputs are wrapped in typed arrays\n  const sourceArrays = sources.map((source2) =>\n    source2 instanceof ArrayBuffer ? new Uint8Array(source2) : source2\n  );\n\n  // Get length of all inputs\n  const byteLength = sourceArrays.reduce((length, typedArray) => length + typedArray.byteLength, 0);\n\n  // Allocate array with space for all inputs\n  const result = new Uint8Array(byteLength);\n\n  // Copy the subarrays\n  let offset = 0;\n  for (const sourceArray of sourceArrays) {\n    result.set(sourceArray, offset);\n    offset += sourceArray.byteLength;\n  }\n\n  // We work with ArrayBuffers, discard the typed array wrapper\n  return result.buffer;\n}\n\n/**\n * Concatenate arbitrary count of typed arrays\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays\n * @param {...*} arrays - list of arrays. All arrays should be the same type\n * @return A concatenated TypedArray\n */\nexport function concatenateTypedArrays<T>(...typedArrays: T[]): T {\n  // @ts-ignore\n  const arrays = typedArrays as TypedArray[];\n  // @ts-ignore\n  const TypedArrayConstructor = (arrays && arrays.length > 1 && arrays[0].constructor) || null;\n  if (!TypedArrayConstructor) {\n    throw new Error(\n      '\"concatenateTypedArrays\" - incorrect quantity of arguments or arguments have incompatible data types'\n    );\n  }\n\n  const sumLength = arrays.reduce((acc, value) => acc + value.length, 0);\n  // @ts-ignore typescript does not like dynamic constructors\n  const result = new TypedArrayConstructor(sumLength);\n  let offset = 0;\n  for (const array of arrays) {\n    result.set(array, offset);\n    offset += array.length;\n  }\n  return result;\n}\n\n/**\n * Copy a view of an ArrayBuffer into new ArrayBuffer with byteOffset = 0\n * @param arrayBuffer\n * @param byteOffset\n * @param byteLength\n */\nexport function sliceArrayBuffer(\n  arrayBuffer: ArrayBuffer,\n  byteOffset: number,\n  byteLength?: number\n): ArrayBuffer {\n  const subArray =\n    byteLength !== undefined\n      ? new Uint8Array(arrayBuffer).subarray(byteOffset, byteOffset + byteLength)\n      : new Uint8Array(arrayBuffer).subarray(byteOffset);\n  const arrayCopy = new Uint8Array(subArray);\n  return arrayCopy.buffer;\n}\n","import {assert} from '../env-utils/assert';\n\n/**\n * Calculate new size of an arrayBuffer to be aligned to an n-byte boundary\n * This function increases `byteLength` by the minimum delta,\n * allowing the total length to be divided by `padding`\n * @param byteLength\n * @param padding\n */\nexport function padToNBytes(byteLength: number, padding: number): number {\n  assert(byteLength >= 0); // `Incorrect 'byteLength' value: ${byteLength}`\n  assert(padding > 0); // `Incorrect 'padding' value: ${padding}`\n  return (byteLength + (padding - 1)) & ~(padding - 1);\n}\n\n/**\n * Creates a new Uint8Array based on two different ArrayBuffers\n * @param targetBuffer The first buffer.\n * @param sourceBuffer The second buffer.\n * @return The new ArrayBuffer created out of the two.\n */\nexport function copyArrayBuffer(\n  targetBuffer: ArrayBuffer,\n  sourceBuffer: ArrayBuffer,\n  byteOffset: number,\n  byteLength: number = sourceBuffer.byteLength\n): ArrayBuffer {\n  const targetArray = new Uint8Array(targetBuffer, byteOffset, byteLength);\n  const sourceArray = new Uint8Array(sourceBuffer);\n  targetArray.set(sourceArray);\n  return targetBuffer;\n}\n\n/**\n * Copy from source to target at the targetOffset\n *\n * @param source - The data to copy\n * @param target - The destination to copy data into\n * @param targetOffset - The start offset into target to place the copied data\n * @returns the new offset taking into account proper padding\n */\nexport function copyToArray(source: ArrayBuffer | any, target: any, targetOffset: number): number {\n  let sourceArray;\n\n  if (source instanceof ArrayBuffer) {\n    sourceArray = new Uint8Array(source);\n  } else {\n    // Pack buffer onto the big target array\n    //\n    // 'source.data.buffer' could be a view onto a larger buffer.\n    // We MUST use this constructor to ensure the byteOffset and byteLength is\n    // set to correct values from 'source.data' and not the underlying\n    // buffer for target.set() to work properly.\n    const srcByteOffset = source.byteOffset;\n    const srcByteLength = source.byteLength;\n    // In gltf parser it is set as \"arrayBuffer\" instead of \"buffer\"\n    // https://github.com/visgl/loaders.gl/blob/1e3a82a0a65d7b6a67b1e60633453e5edda2960a/modules/gltf/src/lib/parse-gltf.js#L85\n    sourceArray = new Uint8Array(source.buffer || source.arrayBuffer, srcByteOffset, srcByteLength);\n  }\n\n  // Pack buffer onto the big target array\n  target.set(sourceArray, targetOffset);\n\n  return targetOffset + padToNBytes(sourceArray.byteLength, 4);\n}\n","// @ts-nocheck\nconst moduleExports = require('./index');\nconst _global = typeof window === 'undefined' ? global : window;\n_global.loaders = _global.loaders || {};\nmodule.exports = Object.assign(_global.loaders, moduleExports);\n","// TYPES\nexport type {ImageDataType, ImageType, ImageTypeEnum} from './types';\n\n// LOADERS AND WRITERS\nexport {ImageLoader} from './image-loader';\nexport {ImageWriter} from './image-writer';\n\n// IMAGE CATEGORY API\n\n// Binary Image API\nexport {getBinaryImageMetadata} from './lib/category-api/binary-image-api';\n\n// Parsed Image API\nexport {isImageTypeSupported, getDefaultImageType} from './lib/category-api/image-type';\n\nexport {\n  isImage,\n  getImageType,\n  getImageSize,\n  getImageData\n} from './lib/category-api/parsed-image-api';\n\n// DEPRECATED - Remove in V3 (fix dependency in luma.gl)\nexport {loadImage} from './lib/texture-api/load-image';\n","import type {LoaderWithParser} from '@loaders.gl/loader-utils';\nimport {VERSION} from './lib/utils/version';\nimport parseImage from './lib/parsers/parse-image';\nimport {getBinaryImageMetadata} from './lib/category-api/binary-image-api';\n\nconst EXTENSIONS = ['png', 'jpg', 'jpeg', 'gif', 'webp', 'bmp', 'ico', 'svg'];\nconst MIME_TYPES = [\n  'image/png',\n  'image/jpeg',\n  'image/gif',\n  'image/webp',\n  'image/bmp',\n  'image/vnd.microsoft.icon',\n  'image/svg+xml'\n];\n\n/**\n * Loads a platform-specific image type\n * Note: This type can be used as input data to WebGL texture creation\n */\nexport const ImageLoader = {\n  id: 'image',\n  module: 'images',\n  name: 'Images',\n  version: VERSION,\n  mimeTypes: MIME_TYPES,\n  extensions: EXTENSIONS,\n  parse: parseImage,\n  // TODO: byteOffset, byteLength;\n  tests: [(arrayBuffer) => Boolean(getBinaryImageMetadata(new DataView(arrayBuffer)))],\n  options: {\n    image: {\n      type: 'auto',\n      decode: true // if format is HTML\n    }\n    // imagebitmap: {} - passes (platform dependent) parameters to ImageBitmap constructor\n  }\n};\n\nexport const _typecheckImageLoader: LoaderWithParser = ImageLoader;\n","import {isSVG, getBlob} from './svg-utils';\nimport parseToImage from './parse-to-image';\n\nconst EMPTY_OBJECT = {};\n\nlet imagebitmapOptionsSupported = true;\n\n/**\n * Asynchronously parses an array buffer into an ImageBitmap - this contains the decoded data\n * ImageBitmaps are supported on worker threads, but not supported on Edge, IE11 and Safari\n * https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap#Browser_compatibility\n *\n * TODO - createImageBitmap supports source rect (5 param overload), pass through?\n */\nexport default async function parseToImageBitmap(arrayBuffer, options, url) {\n  let blob;\n\n  // Cannot parse SVG directly to ImageBitmap, parse to Image first\n  if (isSVG(url)) {\n    // Note: this only works on main thread\n    const image = await parseToImage(arrayBuffer, options, url);\n    blob = image;\n  } else {\n    // Create blob from the array buffer\n    blob = getBlob(arrayBuffer, url);\n  }\n\n  const imagebitmapOptions = options && options.imagebitmap;\n\n  return await safeCreateImageBitmap(blob, imagebitmapOptions);\n}\n\n/**\n * Safely creates an imageBitmap with options\n * *\n * Firefox crashes if imagebitmapOptions is supplied\n * Avoid supplying if not provided or supported, remember if not supported\n */\nasync function safeCreateImageBitmap(blob, imagebitmapOptions = null) {\n  if (isEmptyObject(imagebitmapOptions) || !imagebitmapOptionsSupported) {\n    imagebitmapOptions = null;\n  }\n\n  if (imagebitmapOptions) {\n    try {\n      // @ts-ignore Options\n      return await createImageBitmap(blob, imagebitmapOptions);\n    } catch (error) {\n      console.warn(error); // eslint-disable-line\n      imagebitmapOptionsSupported = false;\n    }\n  }\n\n  return await createImageBitmap(blob);\n}\n\nfunction isEmptyObject(object) {\n  for (const key in object || EMPTY_OBJECT) {\n    return false;\n  }\n  return true;\n}\n","import {global} from '../utils/globals';\nimport {assert} from '../utils/assert';\nimport {getBinaryImageMetadata} from '../category-api/binary-image-api';\n\n// Use polyfills if installed to p[arsed image using get-pixels\nexport default function parseToNodeImage(arrayBuffer, options) {\n  const {mimeType} = getBinaryImageMetadata(arrayBuffer) || {};\n\n  // @ts-ignore\n  const {_parseImageNode} = global;\n  assert(_parseImageNode); // '@loaders.gl/polyfills not installed'\n\n  return _parseImageNode(arrayBuffer, mimeType, options);\n}\n","// import type {Writer} from '@loaders.gl/loader-utils';\nimport {VERSION} from './lib/utils/version';\nimport {encodeImage} from './lib/encoders/encode-image';\n\nexport const ImageWriter = {\n  name: 'Images',\n  id: 'image',\n  module: 'images',\n  version: VERSION,\n  extensions: ['jpeg'],\n  options: {\n    image: {\n      mimeType: 'image/png',\n      jpegQuality: null\n    }\n  },\n  encode: encodeImage\n};\n","// Image loading/saving for browser and Node.js\nimport {global} from '../utils/globals';\nimport {getImageSize} from '../category-api/parsed-image-api';\n\n// @ts-ignore TS2339: Property does not exist on type\nconst {_encodeImageNode} = global;\n\n/**\n * Returns data bytes representing a compressed image in PNG or JPG format,\n * This data can be saved using file system (f) methods or used in a request.\n * @param image - ImageBitmap Image or Canvas\n * @param options\n * param opt.type='png' - png, jpg or image/png, image/jpg are valid\n * param mimeType= - Whether to include a data URI header\n */\nexport async function encodeImage(\n  image: any,\n  options?: {[key: string]: any}\n): Promise<ArrayBuffer> {\n  options = options || {};\n  options.image = options.image || ({} as {[key: string]: any});\n\n  return _encodeImageNode\n    ? _encodeImageNode(image, {type: options.image.mimeType})\n    : encodeImageInBrowser(image, options);\n}\n\n// In case we get exceptions from canvas.toBlob(resolve, type, quality)\nlet qualityParamSupported = true;\n\n/**\n *\n * @param image\n * @param options\n * @note Based on canvas.toBlob\n * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\n */\nasync function encodeImageInBrowser(image, options) {\n  const {mimeType, jpegQuality} = options.image;\n\n  const {width, height} = getImageSize(image);\n\n  // create a canvas and resize it to the size of our image\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n\n  drawImageToCanvas(image, canvas);\n\n  // The actual encoding is done asynchronously with `canvas.toBlob()`\n  const blob = await new Promise<Blob | null>((resolve) => {\n    // get it back as a Blob\n    if (jpegQuality && qualityParamSupported) {\n      try {\n        canvas.toBlob(resolve, mimeType, jpegQuality);\n        return;\n      } catch (error) {\n        qualityParamSupported = false;\n      }\n    }\n    canvas.toBlob(resolve, mimeType);\n  });\n\n  if (!blob) {\n    throw new Error('image encoding failed');\n  }\n\n  return await blob.arrayBuffer();\n}\n\nfunction drawImageToCanvas(image, canvas, x = 0, y = 0) {\n  // Try optimized path for ImageBitmaps via bitmaprenderer context\n  if (x === 0 && y === 0 && typeof ImageBitmap !== 'undefined' && image instanceof ImageBitmap) {\n    const context = canvas.getContext('bitmaprenderer');\n    if (context) {\n      // transfer the ImageBitmap to it\n      context.transferFromImageBitmap(image);\n      return canvas;\n    }\n  }\n\n  // Available on most platforms, except IE11 and Andriod WebViews...\n  const context = canvas.getContext('2d');\n  if (image.data) {\n    // ImageData constructor expects clamped array even though getImageData does not return a clamped array...\n    const clampedArray = new Uint8ClampedArray(image.data);\n    const imageData = new ImageData(clampedArray, image.width, image.height);\n    context.putImageData(imageData, 0, 0);\n    return canvas;\n  }\n\n  // Fall back to generic image/image bitmap rendering path\n  context.drawImage(image, 0, 0);\n  return canvas;\n}\n","import {assert} from '../utils/assert';\nimport parseImage from '../parsers/parse-image';\nimport {getImageSize} from '../category-api/parsed-image-api';\nimport {generateUrl} from './generate-url';\nimport {deepLoad, shallowLoad} from './deep-load';\n\nexport async function loadImage(getUrl, options = {}) {\n  const imageUrls = await getImageUrls(getUrl, options);\n  return await deepLoad(imageUrls, parseImage, options);\n}\n\nexport async function getImageUrls(getUrl, options, urlOptions = {}) {\n  const mipLevels = (options && options.image && options.image.mipLevels) || 0;\n  return mipLevels !== 0\n    ? await getMipmappedImageUrls(getUrl, mipLevels, options, urlOptions)\n    : generateUrl(getUrl, options, urlOptions);\n}\n\nasync function getMipmappedImageUrls(getUrl, mipLevels, options, urlOptions) {\n  const urls: string[] = [];\n\n  // If no mip levels supplied, we need to load the level 0 image and calculate based on size\n  if (mipLevels === 'auto') {\n    const url = generateUrl(getUrl, options, {...urlOptions, lod: 0});\n    const image = await shallowLoad(url, parseImage, options);\n\n    const {width, height} = getImageSize(image);\n    mipLevels = getMipLevels({width, height});\n\n    // TODO - push image and make `deepLoad` pass through non-url values, avoid loading twice?\n    urls.push(url);\n  }\n\n  // We now know how many mipLevels we need, remaining image urls can now be constructed\n  assert(mipLevels > 0);\n\n  for (let mipLevel = urls.length; mipLevel < mipLevels; ++mipLevel) {\n    const url = generateUrl(getUrl, options, {...urlOptions, lod: mipLevel});\n    urls.push(url);\n  }\n\n  return urls;\n}\n\n// Calculates number of mipmaps based on texture size (log2)\nexport function getMipLevels({width, height}) {\n  return 1 + Math.floor(Math.log2(Math.max(width, height)));\n}\n","import {resolvePath} from '@loaders.gl/loader-utils';\nimport {assert} from '../utils/assert';\n\n// Generate a url by calling getUrl with mix of options, applying options.baseUrl\nexport function generateUrl(getUrl, options, urlOptions) {\n  // Get url\n  let url = getUrl;\n  if (typeof getUrl === 'function') {\n    url = getUrl({...options, ...urlOptions});\n  }\n  assert(typeof url === 'string');\n\n  // Apply options.baseUrl\n  const {baseUrl} = options;\n  if (baseUrl) {\n    url = baseUrl[baseUrl.length - 1] === '/' ? `${baseUrl}${url}` : `${baseUrl}/${url}`;\n  }\n\n  return resolvePath(url);\n}\n","// TYPES\nexport type {\n  Loader,\n  LoaderWithParser,\n  LoaderContext,\n  LoaderOptions,\n  Writer,\n  WriterOptions,\n  DataType,\n  SyncDataType,\n  BatchableDataType,\n  IFileSystem,\n  IRandomAccessReadFileSystem\n} from './types';\n\n// GENERAL UTILS\nexport {assert} from './lib/env-utils/assert';\nexport {\n  isBrowser,\n  isWorker,\n  nodeVersion,\n  self,\n  window,\n  global,\n  document\n} from './lib/env-utils/globals';\n\n// LOADERS.GL-SPECIFIC WORKER UTILS\nexport {createLoaderWorker} from './lib/worker-loader-utils/create-loader-worker';\nexport {parseWithWorker, canParseWithWorker} from './lib/worker-loader-utils/parse-with-worker';\n\n// PARSER UTILS\nexport {parseJSON} from './lib/parser-utils/parse-json';\n\n// MEMORY COPY UTILS\nexport {\n  toArrayBuffer,\n  sliceArrayBuffer,\n  concatenateArrayBuffers,\n  concatenateTypedArrays,\n  compareArrayBuffers\n} from './lib/binary-utils/array-buffer-utils';\nexport {padToNBytes, copyToArray, copyArrayBuffer} from './lib/binary-utils/memory-copy-utils';\nexport {\n  copyPaddedArrayBufferToDataView,\n  copyPaddedStringToDataView\n} from './lib/binary-utils/binary-copy-utils';\nexport {\n  padStringToByteAlignment,\n  copyStringToDataView,\n  copyBinaryToDataView\n} from './lib/binary-utils/encode-utils';\nexport {getFirstCharacters, getMagicString} from './lib/binary-utils/get-first-characters';\n\n// ITERATOR UTILS\nexport {\n  makeTextEncoderIterator,\n  makeTextDecoderIterator,\n  makeLineIterator,\n  makeNumberedLineIterator\n} from './lib/iterators/text-iterators';\nexport {forEach, concatenateArrayBuffersAsync} from './lib/iterators/async-iteration';\n\n// REQUEST UTILS\nexport {default as RequestScheduler} from './lib/request-utils/request-scheduler';\n\n// NODE `path`` REPLACEMENT\nimport * as path from './lib/path-utils/path';\nexport {path};\nexport {setPathPrefix, getPathPrefix, resolvePath} from './lib/path-utils/file-aliases';\nexport {addAliases as _addAliases} from './lib/path-utils/file-aliases';\n\n// NODE `fs` WRAPPERS\nimport * as fs from './lib/node/fs';\nexport {fs};\n\n// NODE `buffer` WRAPPERS\nexport {isBuffer, toBuffer, bufferToArrayBuffer} from './lib/binary-utils/buffer-utils';\n\nexport {JSONLoader} from './json-loader';\n","// Purpose: include this in your module to avoid\n// dependencies on micro modules like 'global' and 'is-browser';\n\n/* eslint-disable no-restricted-globals */\nconst globals = {\n  self: typeof self !== 'undefined' && self,\n  window: typeof window !== 'undefined' && window,\n  global: typeof global !== 'undefined' && global,\n  document: typeof document !== 'undefined' && document\n};\n\ntype obj = {[key: string]: any};\nconst self_: obj = globals.self || globals.window || globals.global || {};\nconst window_: obj = globals.window || globals.self || globals.global || {};\nconst global_: obj = globals.global || globals.self || globals.window || {};\nconst document_: obj = globals.document || {};\n\nexport {self_ as self, window_ as window, global_ as global, document_ as document};\n\n/** true if running in a browser */\nexport const isBrowser: boolean =\n  // @ts-ignore process does not exist on browser\n  typeof process !== 'object' || String(process) !== '[object process]' || process.browser;\n\n/** true if running in a worker thread */\nexport const isWorker: boolean = typeof importScripts === 'function';\n\n// Extract node major version\nconst matches =\n  typeof process !== 'undefined' && process.version && /v([0-9]*)/.exec(process.version);\n/** Major Node version (as a number) */\nexport const nodeVersion: number = (matches && parseFloat(matches[1])) || 0;\n","/* eslint-disable no-restricted-globals */\nimport type {LoaderWithParser} from '../../types';\nimport {WorkerBody} from '@loaders.gl/worker-utils';\n// import {validateLoaderVersion} from './validate-loader-version';\n\nlet requestId = 0;\n\n/**\n * Set up a WebWorkerGlobalScope to talk with the main thread\n * @param loader\n */\nexport function createLoaderWorker(loader: LoaderWithParser) {\n  // Check that we are actually in a worker thread\n  if (typeof self === 'undefined') {\n    return;\n  }\n\n  WorkerBody.onmessage = async (type, payload) => {\n    switch (type) {\n      case 'process':\n        try {\n          // validateLoaderVersion(loader, data.source.split('@')[1]);\n\n          const {input, options = {}} = payload;\n\n          const result = await parseData({\n            loader,\n            arrayBuffer: input,\n            options,\n            context: {\n              parse: parseOnMainThread\n            }\n          });\n          WorkerBody.postMessage('done', {result});\n        } catch (error) {\n          const message = error instanceof Error ? error.message : '';\n          WorkerBody.postMessage('error', {error: message});\n        }\n        break;\n      default:\n    }\n  };\n}\n\nfunction parseOnMainThread(arrayBuffer: ArrayBuffer, options: {[key: string]: any}): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const id = requestId++;\n\n    /**\n     */\n    const onMessage = (type, payload) => {\n      if (payload.id !== id) {\n        // not ours\n        return;\n      }\n\n      switch (type) {\n        case 'done':\n          WorkerBody.removeEventListener(onMessage);\n          resolve(payload.result);\n          break;\n\n        case 'error':\n          WorkerBody.removeEventListener(onMessage);\n          reject(payload.error);\n          break;\n\n        default:\n        // ignore\n      }\n    };\n\n    WorkerBody.addEventListener(onMessage);\n\n    // Ask the main thread to decode data\n    const payload = {id, input: arrayBuffer, options};\n    WorkerBody.postMessage('process', payload);\n  });\n}\n\n// TODO - Support byteOffset and byteLength (enabling parsing of embedded binaries without copies)\n// TODO - Why not support async loader.parse* funcs here?\n// TODO - Why not reuse a common function instead of reimplementing loader.parse* selection logic? Keeping loader small?\n// TODO - Lack of appropriate parser functions can be detected when we create worker, no need to wait until parse\nasync function parseData({loader, arrayBuffer, options, context}) {\n  let data;\n  let parser;\n  if (loader.parseSync || loader.parse) {\n    data = arrayBuffer;\n    parser = loader.parseSync || loader.parse;\n  } else if (loader.parseTextSync) {\n    const textDecoder = new TextDecoder();\n    data = textDecoder.decode(arrayBuffer);\n    parser = loader.parseTextSync;\n  } else {\n    throw new Error(`Could not load data with ${loader.name} loader`);\n  }\n\n  // TODO - proper merge in of loader options...\n  options = {\n    ...options,\n    modules: (loader && loader.options && loader.options.modules) || {},\n    worker: false\n  };\n\n  return await parser(data, {...options}, context, loader);\n}\n","import {assert} from '../env-utils/assert';\n\nconst workerURLCache = new Map();\n\n/**\n * Creates a loadable URL from worker source or URL\n * that can be used to create `Worker` instances.\n * Due to CORS issues it may be necessary to wrap a URL in a small importScripts\n * @param props\n * @param props.source Worker source\n * @param props.url Worker URL\n * @returns loadable url\n */\nexport function getLoadableWorkerURL(props: {source?: string; url?: string}) {\n  assert((props.source && !props.url) || (!props.source && props.url)); // Either source or url must be defined\n\n  let workerURL = workerURLCache.get(props.source || props.url);\n  if (!workerURL) {\n    // Differentiate worker urls from worker source code\n    if (props.url) {\n      workerURL = getLoadableWorkerURLFromURL(props.url);\n      workerURLCache.set(props.url, workerURL);\n    }\n\n    if (props.source) {\n      workerURL = getLoadableWorkerURLFromSource(props.source);\n      workerURLCache.set(props.source, workerURL);\n    }\n  }\n\n  assert(workerURL);\n  return workerURL;\n}\n\n/**\n * Build a loadable worker URL from worker URL\n * @param url\n * @returns loadable URL\n */\nfunction getLoadableWorkerURLFromURL(url: string): string {\n  // A local script url, we can use it to initialize a Worker directly\n  if (!url.startsWith('http')) {\n    return url;\n  }\n\n  // A remote script, we need to use `importScripts` to load from different origin\n  const workerSource = buildScriptSource(url);\n  return getLoadableWorkerURLFromSource(workerSource);\n}\n\n/**\n * Build a loadable worker URL from worker source\n * @param workerSource\n * @returns loadable url\n */\nfunction getLoadableWorkerURLFromSource(workerSource: string): string {\n  // NOTE: webworkify was previously used\n  // const blob = webworkify(workerSource, {bare: true});\n  const blob = new Blob([workerSource], {type: 'application/javascript'});\n  return URL.createObjectURL(blob);\n}\n\n/**\n * Per spec, worker cannot be initialized with a script from a different origin\n * However a local worker script can still import scripts from other origins,\n * so we simply build a wrapper script.\n *\n * @param workerUrl\n * @returns source\n */\nfunction buildScriptSource(workerUrl: string): string {\n  return `\\\ntry {\n  importScripts('${workerUrl}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`;\n}\n","import type {\n  WorkerObject,\n  WorkerOptions,\n  WorkerContext,\n  WorkerMessageType,\n  WorkerMessagePayload\n} from '../../types';\nimport type WorkerJob from '../worker-farm/worker-job';\nimport WorkerFarm from '../worker-farm/worker-farm';\nimport {removeNontransferableOptions} from '../worker-utils/remove-nontransferable-options';\nimport {getWorkerURL, getWorkerName} from './get-worker-url';\n\ntype ProcessOnWorkerOptions = WorkerOptions & {\n  jobName?: string;\n  [key: string]: any;\n};\n\n/**\n * Determines if we can parse with worker\n * @param loader\n * @param data\n * @param options\n */\nexport function canProcessOnWorker(worker: WorkerObject, options?: WorkerOptions) {\n  if (!WorkerFarm.isSupported()) {\n    return false;\n  }\n\n  return worker.worker && options?.worker;\n}\n\n/**\n * This function expects that the worker thread sends certain messages,\n * Creating such a worker can be automated if the worker is wrapper by a call to\n * createWorker in @loaders.gl/worker-utils.\n */\nexport async function processOnWorker(\n  worker: WorkerObject,\n  data: any,\n  options: ProcessOnWorkerOptions = {},\n  context: WorkerContext = {}\n): Promise<any> {\n  const name = getWorkerName(worker);\n  const url = getWorkerURL(worker, options);\n\n  const workerFarm = WorkerFarm.getWorkerFarm(options);\n  const workerPool = workerFarm.getWorkerPool({name, url});\n\n  const jobName = options.jobName || worker.name;\n  const job = await workerPool.startJob(\n    jobName,\n    // eslint-disable-next-line\n    onMessage.bind(null, context)\n  );\n\n  // Kick off the processing in the worker\n  const transferableOptions = removeNontransferableOptions(options);\n  job.postMessage('process', {input: data, options: transferableOptions});\n\n  const result = await job.result;\n  return result.result;\n}\n\n/**\n * Job completes when we receive the result\n * @param job\n * @param message\n */\nasync function onMessage(\n  context: WorkerContext,\n  job: WorkerJob,\n  type: WorkerMessageType,\n  payload: WorkerMessagePayload\n) {\n  switch (type) {\n    case 'done':\n      // Worker is done\n      job.done(payload);\n      break;\n\n    case 'error':\n      // Worker encountered an error\n      job.error(payload.error);\n      break;\n\n    case 'process':\n      // Worker is asking for us (main thread) to process something\n      const {id, input, options} = payload;\n      try {\n        if (!context.process) {\n          job.postMessage('error', {id, error: 'Worker not set up to process on main thread'});\n          return;\n        }\n        const result = await context.process(input, options);\n        job.postMessage('done', {id, result});\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'unknown error';\n        job.postMessage('error', {id, error: message});\n      }\n      break;\n\n    default:\n      // eslint-disable-next-line\n      console.warn(`process-on-worker: unknown message ${type}`);\n  }\n}\n","/**\n * Safely stringify JSON (drop non serializable values like functions and regexps)\n * @param value\n */\nexport function removeNontransferableOptions(object: object): object {\n  // options.log object contains functions which cannot be transferred\n  // TODO - decide how to handle logging on workers\n  // TODO - warn if options stringification is long\n  return JSON.parse(stringifyJSON(object));\n}\n\nfunction stringifyJSON(v) {\n  const cache = new Set();\n  return JSON.stringify(v, (key, value) => {\n    if (typeof value === 'object' && value !== null) {\n      if (cache.has(value)) {\n        // Circular reference found\n        try {\n          // If this value does not reference a parent it can be deduped\n          return JSON.parse(JSON.stringify(value));\n        } catch (err) {\n          // discard key if value cannot be deduped\n          return undefined;\n        }\n      }\n      // Store value in our set\n      cache.add(value);\n    }\n    return value;\n  });\n}\n","import type {\n  WorkerMessageType,\n  WorkerMessagePayload,\n  WorkerContext,\n  Process,\n  ProcessInBatches\n} from '../../types';\nimport AsyncQueue from '../async-queue/async-queue';\nimport WorkerBody from '../worker-farm/worker-body';\n// import {validateWorkerVersion} from './validate-worker-version';\n\n/** Counter for jobs */\nlet requestId = 0;\nlet inputBatches;\nlet options;\n\nexport type ProcessOnMainThread = (data: any, options?: {[key: string]: any}, context?) => any;\n\n/**\n * Set up a WebWorkerGlobalScope to talk with the main thread\n */\nexport function createWorker(process: Process, processInBatches?: ProcessInBatches): void {\n  // Check that we are actually in a worker thread\n  if (typeof self === 'undefined') {\n    return;\n  }\n\n  const context: WorkerContext = {\n    process: processOnMainThread\n  };\n\n  // eslint-disable-next-line complexity\n  WorkerBody.onmessage = async (type: WorkerMessageType, payload: WorkerMessagePayload) => {\n    try {\n      switch (type) {\n        case 'process':\n          if (!process) {\n            throw new Error('Worker does not support atomic processing');\n          }\n          const result = await process(payload.input, payload.options || {}, context);\n          WorkerBody.postMessage('done', {result});\n          break;\n\n        case 'process-in-batches':\n          if (!processInBatches) {\n            throw new Error('Worker does not support batched processing');\n          }\n          inputBatches = new AsyncQueue();\n          options = payload.options || {};\n          const resultIterator = processInBatches(inputBatches, options, context?.processInBatches);\n          for await (const batch of resultIterator) {\n            WorkerBody.postMessage('output-batch', {result: batch});\n          }\n          WorkerBody.postMessage('done', {});\n          break;\n\n        case 'input-batch':\n          inputBatches.push(payload.input);\n          break;\n\n        case 'input-done':\n          inputBatches.close();\n          break;\n\n        default:\n      }\n    } catch (error) {\n      const message = error instanceof Error ? error.message : '';\n      WorkerBody.postMessage('error', {error: message});\n    }\n  };\n}\n\nfunction processOnMainThread(arrayBuffer, options = {}) {\n  return new Promise((resolve, reject) => {\n    const id = requestId++;\n\n    /**\n     */\n    const onMessage = (type, payload) => {\n      if (payload.id !== id) {\n        // not ours\n        return;\n      }\n\n      switch (type) {\n        case 'done':\n          WorkerBody.removeEventListener(onMessage);\n          resolve(payload.result);\n          break;\n\n        case 'error':\n          WorkerBody.removeEventListener(onMessage);\n          reject(payload.error);\n          break;\n\n        default:\n        // ignore\n      }\n    };\n\n    WorkerBody.addEventListener(onMessage);\n\n    // Ask the main thread to decode data\n    const payload = {id, input: arrayBuffer, options};\n    WorkerBody.postMessage('process', payload);\n  });\n}\n","import type {WorkerObject} from '../../types';\nimport {assert} from '../env-utils/assert';\nimport {VERSION} from '../env-utils/version';\n\n/**\n * Check if worker is compatible with this library version\n * @param worker\n * @param libVersion\n * @returns `true` if the two versions are compatible\n */\nexport function validateWorkerVersion(\n  worker: WorkerObject,\n  coreVersion: string = VERSION\n): boolean {\n  assert(worker, 'no worker provided');\n\n  const workerVersion = worker.version;\n  if (!coreVersion || !workerVersion) {\n    return false;\n  }\n\n  // TODO enable when fix the __version__ injection\n  // const coreVersions = parseVersion(coreVersion);\n  // const workerVersions = parseVersion(workerVersion);\n  // assert(\n  //   coreVersion.major === workerVersion.major && coreVersion.minor <= workerVersion.minor,\n  //   `worker: ${worker.name} is not compatible. ${coreVersion.major}.${\n  //     coreVersion.minor\n  //   }+ is required.`\n  // );\n\n  return true;\n}\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction parseVersion(version) {\n  const parts = version.split('.').map(Number);\n  return {major: parts[0], minor: parts[1]};\n}\n","/* global importScripts */\nimport {global, isBrowser, isWorker} from '../env-utils/globals';\nimport * as node from '../node/require-utils.node';\nimport {assert} from '../env-utils/assert';\nimport {VERSION as __VERSION__} from '../env-utils/version';\n\n// TODO - unpkg.com doesn't seem to have a `latest` specifier for alpha releases...\nconst LATEST = 'beta';\nconst VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : LATEST;\n\nconst loadLibraryPromises = {}; // promises\n\n/**\n * Dynamically loads a library (\"module\")\n *\n * - wasm library: Array buffer is returned\n * - js library: Parse JS is returned\n *\n * Method depends on environment\n * - browser - script element is created and installed on document\n * - worker - eval is called on global context\n * - node - file is required\n *\n * @param libraryUrl\n * @param moduleName\n * @param options\n */\nexport async function loadLibrary(\n  libraryUrl: string,\n  moduleName: string | null = null,\n  options: object = {}\n): Promise<any> {\n  if (moduleName) {\n    libraryUrl = getLibraryUrl(libraryUrl, moduleName, options);\n  }\n\n  // Ensure libraries are only loaded once\n  loadLibraryPromises[libraryUrl] =\n    loadLibraryPromises[libraryUrl] || loadLibraryFromFile(libraryUrl);\n  return await loadLibraryPromises[libraryUrl];\n}\n\n// TODO - sort out how to resolve paths for main/worker and dev/prod\nexport function getLibraryUrl(library, moduleName?: string, options?): string {\n  // Check if already a URL\n  if (library.startsWith('http')) {\n    return library;\n  }\n\n  // Allow application to import and supply libraries through `options.modules`\n  const modules = options.modules || {};\n  if (modules[library]) {\n    return modules[library];\n  }\n\n  // Load from local files, not from CDN scripts in Node.js\n  // TODO - needs to locate the modules directory when installed!\n  if (!isBrowser) {\n    return `modules/${moduleName}/dist/libs/${library}`;\n  }\n\n  // In browser, load from external scripts\n  if (options.CDN) {\n    assert(options.CDN.startsWith('http'));\n    return `${options.CDN}/${moduleName}@${VERSION}/dist/libs/${library}`;\n  }\n\n  // TODO - loading inside workers requires paths relative to worker script location...\n  if (isWorker) {\n    return `../src/libs/${library}`;\n  }\n\n  return `modules/${moduleName}/src/libs/${library}`;\n}\n\nasync function loadLibraryFromFile(libraryUrl) {\n  if (libraryUrl.endsWith('wasm')) {\n    const response = await fetch(libraryUrl);\n    return await response.arrayBuffer();\n  }\n\n  if (!isBrowser) {\n    return node.requireFromFile && (await node.requireFromFile(libraryUrl));\n  }\n  if (isWorker) {\n    return importScripts(libraryUrl);\n  }\n  // TODO - fix - should be more secure than string parsing since observes CORS\n  // if (isBrowser) {\n  //   return await loadScriptFromFile(libraryUrl);\n  // }\n\n  const response = await fetch(libraryUrl);\n  const scriptSource = await response.text();\n  return loadLibraryFromString(scriptSource, libraryUrl);\n}\n\n/*\nasync function loadScriptFromFile(libraryUrl) {\n  const script = document.createElement('script');\n  script.src = libraryUrl;\n  return await new Promise((resolve, reject) => {\n    script.onload = data => {\n      resolve(data);\n    };\n    script.onerror = reject;\n  });\n}\n*/\n\n// TODO - Needs security audit...\n//  - Raw eval call\n//  - Potentially bypasses CORS\n// Upside is that this separates fetching and parsing\n// we could create a`LibraryLoader` or`ModuleLoader`\nfunction loadLibraryFromString(scriptSource, id) {\n  if (!isBrowser) {\n    return node.requireFromString && node.requireFromString(scriptSource, id);\n  }\n\n  if (isWorker) {\n    // Use lvalue trick to make eval run in global scope\n    eval.call(global, scriptSource); // eslint-disable-line no-eval\n    // https://stackoverflow.com/questions/9107240/1-evalthis-vs-evalthis-in-javascript\n    // http://perfectionkills.com/global-eval-what-are-the-options/\n    return null;\n  }\n\n  const script = document.createElement('script');\n  script.id = id;\n  // most browsers like a separate text node but some throw an error. The second method covers those.\n  try {\n    script.appendChild(document.createTextNode(scriptSource));\n  } catch (e) {\n    script.text = scriptSource;\n  }\n  document.body.appendChild(script);\n  return null;\n}\n\n// TODO - technique for module injection into worker, from THREE.DracoLoader...\n/*\nfunction combineWorkerWithLibrary(worker, jsContent) {\n  var fn = wWorker.toString();\n  var body = [\n    '// injected',\n    jsContent,\n    '',\n    '// worker',\n    fn.substring(fn.indexOf('{') + 1, fn.lastIndexOf('}'))\n  ].join('\\n');\n  this.workerSourceURL = URL.createObjectURL(new Blob([body]));\n}\n*/\n","/* eslint-disable no-console */\nimport {spawn, ChildProcess, SpawnOptionsWithoutStdio} from 'child_process';\nimport {getAvailablePort} from './process-utils';\n\nexport type ChildProcessProxyProps = {\n  command: string;\n  arguments: string[];\n  /** Whether to add a port specified arg */\n  portArg?: string;\n  /** Base port number */\n  port?: number;\n  /** Whether to search for an available port if the base port is occupied */\n  autoPort?: boolean;\n  /** Number of milliseconds to wait until concluding success */\n  /** wait: 0 - infinity */\n  wait?: number;\n  /** Options passed on to Node'.js `spawn` */\n  spawn?: SpawnOptionsWithoutStdio;\n  /** Callback when the  */\n  onStart?: (proxy: ChildProcessProxy) => void;\n  onSuccess?: (proxy: ChildProcessProxy) => void;\n};\n\nconst DEFAULT_PROPS: ChildProcessProxyProps = {\n  command: '',\n  arguments: [],\n  port: 5000,\n  autoPort: true,\n  wait: 2000,\n  onSuccess: (processProxy) => {\n    console.log(`Started ${processProxy.props.command}`);\n  }\n};\n\n/**\n * Manager for a Node.js child process\n * Prepares arguments, starts, stops and tracks output\n */\nexport default class ChildProcessProxy {\n  id: string;\n  props: ChildProcessProxyProps = {...DEFAULT_PROPS};\n  private childProcess: ChildProcess | null = null;\n  private port: number = 0;\n  private successTimer?;\n\n  // constructor(props?: {id?: string});\n  constructor({id = 'browser-driver'} = {}) {\n    this.id = id;\n  }\n\n  /** Starts a child process with the provided props */\n  async start(props: ChildProcessProxyProps): Promise<object> {\n    props = {...DEFAULT_PROPS, ...props};\n    this.props = props;\n\n    const args = [...props.arguments];\n\n    // If portArg is set, we can look up an available port\n    this.port = Number(props.port);\n    if (props.portArg) {\n      if (props.autoPort) {\n        this.port = await getAvailablePort(props.port);\n      }\n      args.push(props.portArg, String(this.port));\n    }\n\n    return await new Promise((resolve, reject) => {\n      try {\n        this._setTimeout(() => {\n          if (props.onSuccess) {\n            props.onSuccess(this);\n          }\n          resolve({});\n        });\n\n        console.log(`Spawning ${props.command} ${props.arguments.join(' ')}`);\n        const childProcess = spawn(props.command, args, props.spawn);\n        this.childProcess = childProcess;\n\n        childProcess.stdout.on('data', (data) => {\n          console.log(data.toString());\n        });\n        // TODO - add option regarding whether stderr should be treated as data\n        childProcess.stderr.on('data', (data) => {\n          console.log(`Child process wrote to stderr: \"${data}\".`);\n          this._clearTimeout();\n          reject(new Error(data));\n        });\n        childProcess.on('error', (error) => {\n          console.log(`Child process errored with ${error}`);\n          this._clearTimeout();\n          reject(error);\n        });\n        childProcess.on('close', (code) => {\n          console.log(`Child process exited with ${code}`);\n          this.childProcess = null;\n          this._clearTimeout();\n          resolve({});\n        });\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n\n  /** Stops a running child process */\n  async stop(): Promise<void> {\n    if (this.childProcess) {\n      this.childProcess.kill();\n      this.childProcess = null;\n    }\n  }\n\n  /** Exits this process */\n  async exit(statusCode: number = 0): Promise<void> {\n    try {\n      await this.stop();\n      // eslint-disable-next-line no-process-exit\n      process.exit(statusCode);\n    } catch (error) {\n      console.error(error.message || error);\n      // eslint-disable-next-line no-process-exit\n      process.exit(1);\n    }\n  }\n\n  _setTimeout(callback: (...args: any[]) => void) {\n    if (Number(this.props.wait) > 0) {\n      this.successTimer = setTimeout(callback, this.props.wait);\n    }\n  }\n\n  _clearTimeout() {\n    if (this.successTimer) {\n      clearTimeout(this.successTimer);\n    }\n  }\n}\n","import ChildProcess from 'child_process';\n\n// Get an available port\n// Works on Unix systems\nexport function getAvailablePort(defaultPort: number = 3000): Promise<number> {\n  return new Promise((resolve) => {\n    // Get a list of all ports in use\n    ChildProcess.exec('lsof -i -P -n | grep LISTEN', (error, stdout) => {\n      if (error) {\n        // likely no permission, e.g. CI\n        resolve(defaultPort);\n        return;\n      }\n\n      const portsInUse: number[] = [];\n      const regex = /:(\\d+) \\(LISTEN\\)/;\n      stdout.split('\\n').forEach((line) => {\n        const match = regex.exec(line);\n        if (match) {\n          portsInUse.push(Number(match[1]));\n        }\n      });\n      let port = defaultPort;\n      while (portsInUse.includes(port)) {\n        port++;\n      }\n      resolve(port);\n    });\n  });\n}\n","import type {WorkerJob, WorkerMessageType, WorkerMessagePayload} from '@loaders.gl/worker-utils';\nimport type {Loader, LoaderOptions, LoaderContext} from '../../types';\nimport {WorkerFarm, getWorkerURL} from '@loaders.gl/worker-utils';\n\n/**\n * Determines if a loader can parse with worker\n * @param loader\n * @param options\n */\nexport function canParseWithWorker(loader: Loader, options?: LoaderOptions) {\n  if (!WorkerFarm.isSupported()) {\n    return false;\n  }\n\n  return loader.worker && options?.worker;\n}\n\n/**\n * this function expects that the worker function sends certain messages,\n * this can be automated if the worker is wrapper by a call to createLoaderWorker in @loaders.gl/loader-utils.\n */\nexport async function parseWithWorker(\n  loader: Loader,\n  data,\n  options?: LoaderOptions,\n  context?: LoaderContext,\n  parseOnMainThread?: (arrayBuffer: ArrayBuffer, options: {[key: string]: any}) => Promise<void>\n) {\n  const name = loader.id; // TODO\n  const url = getWorkerURL(loader, options);\n\n  const workerFarm = WorkerFarm.getWorkerFarm(options);\n  const workerPool = workerFarm.getWorkerPool({name, url});\n\n  // options.log object contains functions which cannot be transferred\n  // TODO - decide how to handle logging on workers\n  options = JSON.parse(JSON.stringify(options));\n\n  const job = await workerPool.startJob(\n    'process-on-worker',\n    // eslint-disable-next-line\n    onMessage.bind(null, parseOnMainThread)\n  );\n\n  job.postMessage('process', {\n    // @ts-ignore\n    input: data,\n    options\n  });\n\n  const result = await job.result;\n  return await result.result;\n}\n\n/**\n * Handle worker's responses to the main thread\n * @param job\n * @param type\n * @param payload\n */\nasync function onMessage(\n  parseOnMainThread,\n  job: WorkerJob,\n  type: WorkerMessageType,\n  payload: WorkerMessagePayload\n) {\n  switch (type) {\n    case 'done':\n      job.done(payload);\n      break;\n\n    case 'error':\n      job.error(payload.error);\n      break;\n\n    case 'process':\n      // Worker is asking for main thread to parseO\n      const {id, input, options} = payload;\n      try {\n        const result = await parseOnMainThread(input, options);\n        job.postMessage('done', {id, result});\n      } catch (error) {\n        const message = error instanceof Error ? error.message : 'unknown error';\n        job.postMessage('error', {id, error: message});\n      }\n      break;\n\n    default:\n      // eslint-disable-next-line\n      console.warn(`parse-with-worker unknown message ${type}`);\n  }\n}\n","import {getFirstCharacters} from '../binary-utils/get-first-characters';\n\n/**\n * Minimal JSON parser that throws more meaningful error messages\n */\nexport function parseJSON(string: string): any {\n  try {\n    return JSON.parse(string);\n  } catch (_) {\n    throw new Error(`Failed to parse JSON from data starting with \"${getFirstCharacters(string)}\"`);\n  }\n}\n","import {TypedArray} from '../../types';\nimport {padToNBytes} from './memory-copy-utils';\n\n/**\n * Copy sourceBuffer to dataView with some padding\n *\n * @param {DataView | null} dataView - destination data container. If null - only new offset is calculated\n * @param {number} byteOffset - destination byte offset to copy to\n * @param {Array | TypedArray} sourceBuffer - source data buffer\n * @param {number} padding - pad the resulting array to multiple of \"padding\" bytes. Additional bytes are filled with 0x20 (ASCII space)\n *\n * @return new byteOffset of resulting dataView\n */\nexport function copyPaddedArrayBufferToDataView(\n  dataView: DataView | null,\n  byteOffset: number,\n  sourceBuffer: TypedArray,\n  padding: number\n) {\n  const paddedLength = padToNBytes(sourceBuffer.byteLength, padding);\n  const padLength = paddedLength - sourceBuffer.byteLength;\n\n  if (dataView) {\n    // Copy array\n    const targetArray = new Uint8Array(\n      dataView.buffer,\n      dataView.byteOffset + byteOffset,\n      sourceBuffer.byteLength\n    );\n    const sourceArray = new Uint8Array(sourceBuffer);\n    targetArray.set(sourceArray);\n\n    // Add PADDING\n    for (let i = 0; i < padLength; ++i) {\n      // json chunk is padded with spaces (ASCII 0x20)\n      dataView.setUint8(byteOffset + sourceBuffer.byteLength + i, 0x20);\n    }\n  }\n  byteOffset += paddedLength;\n  return byteOffset;\n}\n\n/**\n * Copy string to dataView with some padding\n *\n * @param {DataView | null} dataView - destination data container. If null - only new offset is calculated\n * @param {number} byteOffset - destination byte offset to copy to\n * @param {string} string - source string\n * @param {number} padding - pad the resulting array to multiple of \"padding\" bytes. Additional bytes are filled with 0x20 (ASCII space)\n *\n * @return new byteOffset of resulting dataView\n */\nexport function copyPaddedStringToDataView(\n  dataView: DataView | null,\n  byteOffset: number,\n  string: string,\n  padding: number\n): number {\n  const textEncoder = new TextEncoder();\n  // PERFORMANCE IDEA: We encode twice, once to get size and once to store\n  // PERFORMANCE IDEA: Use TextEncoder.encodeInto() to avoid temporary copy\n  const stringBuffer = textEncoder.encode(string);\n\n  byteOffset = copyPaddedArrayBufferToDataView(dataView, byteOffset, stringBuffer, padding);\n\n  return byteOffset;\n}\n","// Note: These were broken out from gltf loader...\n// eslint-disable-next-line complexity\n\n// PERFORMANCE IDEA: No need to copy string twice...\nexport function padStringToByteAlignment(string, byteAlignment) {\n  const length = string.length;\n  const paddedLength = Math.ceil(length / byteAlignment) * byteAlignment; // Round up to the required alignment\n  const padding = paddedLength - length;\n  let whitespace = '';\n  for (let i = 0; i < padding; ++i) {\n    whitespace += ' ';\n  }\n  return string + whitespace;\n}\n\nexport function copyStringToDataView(dataView, byteOffset, string, byteLength) {\n  if (dataView) {\n    for (let i = 0; i < byteLength; i++) {\n      dataView.setUint8(byteOffset + i, string.charCodeAt(i));\n    }\n  }\n  return byteOffset + byteLength;\n}\n\nexport function copyBinaryToDataView(dataView, byteOffset, binary, byteLength) {\n  if (dataView) {\n    for (let i = 0; i < byteLength; i++) {\n      dataView.setUint8(byteOffset + i, binary[i]);\n    }\n  }\n  return byteOffset + byteLength;\n}\n","// TextDecoder iterators\n// TextDecoder will keep any partial undecoded bytes between calls to `decode`\n\nexport async function* makeTextDecoderIterator(\n  arrayBufferIterator: AsyncIterable<ArrayBuffer> | Iterable<ArrayBuffer>,\n  options: TextDecoderOptions = {}\n): AsyncIterable<string> {\n  const textDecoder = new TextDecoder(undefined, options);\n  for await (const arrayBuffer of arrayBufferIterator) {\n    yield typeof arrayBuffer === 'string'\n      ? arrayBuffer\n      : textDecoder.decode(arrayBuffer, {stream: true});\n  }\n}\n\n// TextEncoder iterator\n// TODO - this is not useful unless min chunk size is given\n// TextEncoder will keep any partial undecoded bytes between calls to `encode`\n// If iterator does not yield strings, assume arrayBuffer and return unencoded\n\nexport async function* makeTextEncoderIterator(\n  textIterator: AsyncIterable<string> | Iterable<ArrayBuffer>\n): AsyncIterable<ArrayBuffer> {\n  const textEncoder = new TextEncoder();\n  for await (const text of textIterator) {\n    yield typeof text === 'string' ? textEncoder.encode(text) : text;\n  }\n}\n\n/**\n * @param textIterator async iterable yielding strings\n * @returns an async iterable over lines\n * See http://2ality.com/2018/04/async-iter-nodejs.html\n */\n\nexport async function* makeLineIterator(\n  textIterator: AsyncIterable<string>\n): AsyncIterable<string> {\n  let previous = '';\n  for await (const textChunk of textIterator) {\n    previous += textChunk;\n    let eolIndex;\n    while ((eolIndex = previous.indexOf('\\n')) >= 0) {\n      // line includes the EOL\n      const line = previous.slice(0, eolIndex + 1);\n      previous = previous.slice(eolIndex + 1);\n      yield line;\n    }\n  }\n\n  if (previous.length > 0) {\n    yield previous;\n  }\n}\n\n/**\n * @param lineIterator async iterable yielding lines\n * @returns async iterable yielding numbered lines\n *\n * See http://2ality.com/2018/04/async-iter-nodejs.html\n */\nexport async function* makeNumberedLineIterator(\n  lineIterator: AsyncIterable<string>\n): AsyncIterable<{counter: number; line: string}> {\n  let counter = 1;\n  for await (const line of lineIterator) {\n    yield {counter, line};\n    counter++;\n  }\n}\n","import {concatenateArrayBuffers} from '../binary-utils/array-buffer-utils';\n\n// GENERAL UTILITIES\n\n/**\n * Iterate over async iterator, without resetting iterator if end is not reached\n * - forEach intentionally does not reset iterator if exiting loop prematurely\n *   so that iteration can continue in a second loop\n * - It is recommended to use a standard for-await as last loop to ensure\n *   iterator gets properly reset\n *\n * TODO - optimize using sync iteration if argument is an Iterable?\n *\n * @param iterator\n * @param visitor\n */\nexport async function forEach(iterator, visitor) {\n  // eslint-disable-next-line\n  while (true) {\n    const {done, value} = await iterator.next();\n    if (done) {\n      iterator.return();\n      return;\n    }\n    const cancel = visitor(value);\n    if (cancel) {\n      return;\n    }\n  }\n}\n\n// Breaking big data into iterable chunks, concatenating iterable chunks into big data objects\n\n/**\n * Concatenates all data chunks yielded by an (async) iterator\n * This function can e.g. be used to enable atomic parsers to work on (async) iterator inputs\n */\n\nexport async function concatenateArrayBuffersAsync(\n  asyncIterator: AsyncIterable<ArrayBuffer> | Iterable<ArrayBuffer>\n): Promise<ArrayBuffer> {\n  const arrayBuffers: ArrayBuffer[] = [];\n  for await (const chunk of asyncIterator) {\n    arrayBuffers.push(chunk);\n  }\n  return concatenateArrayBuffers(...arrayBuffers);\n}\n\nexport async function concatenateStringsAsync(\n  asyncIterator: AsyncIterable<string> | Iterable<string>\n): Promise<string> {\n  const strings: string[] = [];\n  for await (const chunk of asyncIterator) {\n    strings.push(chunk);\n  }\n  return strings.join('');\n}\n","import {Stats} from '@probe.gl/stats';\n\ntype Handle = any;\ntype DoneFunction = () => any;\ntype GetPriorityFunction = () => number;\ntype RequestResult = {\n  done: DoneFunction;\n} | null;\n\n/** RequestScheduler Options */\nexport type RequestSchedulerProps = {\n  id?: string;\n  throttleRequests?: boolean;\n  maxRequests?: number;\n};\n\nconst STAT_QUEUED_REQUESTS = 'Queued Requests';\nconst STAT_ACTIVE_REQUESTS = 'Active Requests';\nconst STAT_CANCELLED_REQUESTS = 'Cancelled Requests';\nconst STAT_QUEUED_REQUESTS_EVER = 'Queued Requests Ever';\nconst STAT_ACTIVE_REQUESTS_EVER = 'Active Requests Ever';\n\nconst DEFAULT_PROPS: Required<RequestSchedulerProps> = {\n  id: 'request-scheduler',\n  // Specifies if the request scheduler should throttle incoming requests, mainly for comparative testing\n  throttleRequests: true,\n  // The maximum number of simultaneous active requests. Un-throttled requests do not observe this limit.\n  maxRequests: 6\n};\n\n/** Tracks one request */\ntype Request = {\n  handle: Handle;\n  priority: number;\n  getPriority: GetPriorityFunction;\n  resolve?: (value: any) => any;\n};\n\n/**\n * Used to issue a request, without having them \"deeply queued\" by the browser.\n * @todo - Track requests globally, across multiple servers\n */\nexport default class RequestScheduler {\n  readonly props: Required<RequestSchedulerProps>;\n  readonly stats: Stats;\n  activeRequestCount: number = 0;\n\n  /** Tracks the number of active requests and prioritizes/cancels queued requests. */\n  private requestQueue: Request[] = [];\n  private requestMap: Map<Handle, Promise<RequestResult>> = new Map();\n  private deferredUpdate: any = null;\n\n  constructor(props: RequestSchedulerProps = {}) {\n    this.props = {...DEFAULT_PROPS, ...props};\n\n    // Returns the statistics used by the request scheduler.\n    this.stats = new Stats({id: this.props.id});\n    this.stats.get(STAT_QUEUED_REQUESTS);\n    this.stats.get(STAT_ACTIVE_REQUESTS);\n    this.stats.get(STAT_CANCELLED_REQUESTS);\n    this.stats.get(STAT_QUEUED_REQUESTS_EVER);\n    this.stats.get(STAT_ACTIVE_REQUESTS_EVER);\n  }\n\n  /**\n   * Called by an application that wants to issue a request, without having it deeply queued by the browser\n   *\n   * When the returned promise resolved, it is OK for the application to issue a request.\n   * The promise resolves to an object that contains a `done` method.\n   * When the application's request has completed (or failed), the application must call the `done` function\n   *\n   * @param handle\n   * @param getPriority will be called when request \"slots\" open up,\n   *    allowing the caller to update priority or cancel the request\n   *    Highest priority executes first, priority < 0 cancels the request\n   * @returns a promise\n   *   - resolves to a object (with a `done` field) when the request can be issued without queueing,\n   *   - resolves to `null` if the request has been cancelled (by the callback return < 0).\n   *     In this case the application should not issue the request\n   */\n  scheduleRequest(\n    handle: Handle,\n    getPriority: GetPriorityFunction = () => 0\n  ): Promise<RequestResult> {\n    // Allows throttling to be disabled\n    if (!this.props.throttleRequests) {\n      return Promise.resolve({done: () => {}});\n    }\n\n    // dedupe\n    if (this.requestMap.has(handle)) {\n      return this.requestMap.get(handle) as Promise<any>;\n    }\n\n    const request: Request = {handle, priority: 0, getPriority};\n    const promise = new Promise<RequestResult>((resolve) => {\n      // @ts-ignore\n      request.resolve = resolve;\n      return request;\n    });\n\n    this.requestQueue.push(request);\n    this.requestMap.set(handle, promise);\n    this._issueNewRequests();\n    return promise;\n  }\n\n  // PRIVATE\n\n  _issueRequest(request: Request): Promise<any> {\n    const {handle, resolve} = request;\n    let isDone = false;\n\n    const done = () => {\n      // can only be called once\n      if (!isDone) {\n        isDone = true;\n\n        // Stop tracking a request - it has completed, failed, cancelled etc\n        this.requestMap.delete(handle);\n        this.activeRequestCount--;\n        // A slot just freed up, see if any queued requests are waiting\n        this._issueNewRequests();\n      }\n    };\n\n    // Track this request\n    this.activeRequestCount++;\n\n    return resolve ? resolve({done}) : Promise.resolve({done});\n  }\n\n  /** We check requests asynchronously, to prevent multiple updates */\n  _issueNewRequests(): void {\n    if (!this.deferredUpdate) {\n      this.deferredUpdate = setTimeout(() => this._issueNewRequestsAsync(), 0);\n    }\n  }\n\n  /** Refresh all requests  */\n  _issueNewRequestsAsync() {\n    // TODO - shouldn't we clear the timeout?\n    this.deferredUpdate = null;\n\n    const freeSlots = Math.max(this.props.maxRequests - this.activeRequestCount, 0);\n\n    if (freeSlots === 0) {\n      return;\n    }\n\n    this._updateAllRequests();\n\n    // Resolve pending promises for the top-priority requests\n    for (let i = 0; i < freeSlots; ++i) {\n      const request = this.requestQueue.shift();\n      if (request) {\n        this._issueRequest(request); // eslint-disable-line @typescript-eslint/no-floating-promises\n      }\n    }\n\n    // Uncomment to debug\n    // console.log(`${freeSlots} free slots, ${this.requestQueue.length} queued requests`);\n  }\n\n  /** Ensure all requests have updated priorities, and that no longer valid requests are cancelled */\n  _updateAllRequests() {\n    const requestQueue = this.requestQueue;\n    for (let i = 0; i < requestQueue.length; ++i) {\n      const request = requestQueue[i];\n      if (!this._updateRequest(request)) {\n        // Remove the element and make sure to adjust the counter to account for shortened array\n        requestQueue.splice(i, 1);\n        this.requestMap.delete(request.handle);\n        i--;\n      }\n    }\n\n    // Sort the remaining requests based on priority\n    requestQueue.sort((a, b) => a.priority - b.priority);\n  }\n\n  /** Update a single request by calling the callback */\n  _updateRequest(request) {\n    request.priority = request.getPriority(request.handle); // eslint-disable-line callback-return\n\n    // by returning a negative priority, the callback cancels the request\n    if (request.priority < 0) {\n      request.resolve(null);\n      return false;\n    }\n    return true;\n  }\n}\n","// Beginning of a minimal implementation of the Node.js path API, that doesn't pull in big polyfills.\n\n/**\n * Replacement for Node.js path.dirname\n * @param url\n */\nexport function dirname(url: string): string {\n  const slashIndex = url && url.lastIndexOf('/');\n  return slashIndex >= 0 ? url.substr(0, slashIndex as number) : '';\n}\n\n/**\n * Replacement for Node.js path.join\n * @param parts\n */\nexport function join(...parts: string[]): string {\n  const separator = '/';\n  parts = parts.map((part, index) => {\n    if (index) {\n      part = part.replace(new RegExp(`^${separator}`), '');\n    }\n    if (index !== parts.length - 1) {\n      part = part.replace(new RegExp(`${separator}$`), '');\n    }\n    return part;\n  });\n  return parts.join(separator);\n}\n","// Simple file alias mechanisms for tests.\n\nlet pathPrefix = '';\nconst fileAliases: {[aliasPath: string]: string} = {};\n\n/*\n * Set a relative path prefix\n */\nexport function setPathPrefix(prefix: string): void {\n  pathPrefix = prefix;\n}\n\n/*\n * Get the relative path prefix\n */\nexport function getPathPrefix(): string {\n  return pathPrefix;\n}\n\n/**\n *\n * @param aliases\n *\n * Note: addAliases are an experimental export, they are only for testing of loaders.gl loaders\n * not intended as a generic aliasing mechanism\n */\nexport function addAliases(aliases: {[aliasPath: string]: string}): void {\n  Object.assign(fileAliases, aliases);\n}\n\n/**\n * Resolves aliases and adds path-prefix to paths\n */\nexport function resolvePath(filename: string): string {\n  for (const alias in fileAliases) {\n    if (filename.startsWith(alias)) {\n      const replacement = fileAliases[alias];\n      filename = filename.replace(alias, replacement);\n    }\n  }\n  if (!filename.startsWith('http://') && !filename.startsWith('https://')) {\n    filename = `${pathPrefix}${filename}`;\n  }\n  return filename;\n}\n","// fs wrapper (promisified fs + avoids bundling fs in browsers)\nimport fs from 'fs';\nimport {toArrayBuffer} from './buffer-utils.node';\nimport {promisify} from 'util';\n\nconst error = (fsFunction) => () => {\n  throw new Error(`${fsFunction} not available in browser`);\n};\n\nexport const isSupported = Boolean(fs);\n\nexport const open = fs?.open ? promisify(fs.open) : error('fs.open');\nexport const close = fs?.close ? promisify(fs.close) : error('fs.close');\nexport const read = fs?.read ? promisify(fs.read) : error('fs.read');\n\nexport const readFile = fs?.readFile ? promisify(fs.readFile) : error('fs.readFile');\nexport const readFileSync = fs?.readFileSync ? fs.readFileSync : error('fs.readFileSync');\nexport const writeFile = fs?.writeFile ? promisify(fs.writeFile) : error('fs.writeFile');\nexport const writeFileSync = fs?.writeFileSync ? fs.writeFileSync : error('fs.writeFileSync');\n\nexport async function _readToArrayBuffer(fd: number, start: number, length: number) {\n  const buffer = Buffer.alloc(length);\n  const {bytesRead} = await read(fd, buffer, 0, length, start);\n  if (bytesRead !== length) {\n    throw new Error('fs.read failed');\n  }\n  return toArrayBuffer(buffer);\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar getOwnPropertyDescriptors = Object.getOwnPropertyDescriptors ||\n  function getOwnPropertyDescriptors(obj) {\n    var keys = Object.keys(obj);\n    var descriptors = {};\n    for (var i = 0; i < keys.length; i++) {\n      descriptors[keys[i]] = Object.getOwnPropertyDescriptor(obj, keys[i]);\n    }\n    return descriptors;\n  };\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  if (typeof process !== 'undefined' && process.noDeprecation === true) {\n    return fn;\n  }\n\n  // Allow for deprecating things in the process of starting up.\n  if (typeof process === 'undefined') {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nvar kCustomPromisifiedSymbol = typeof Symbol !== 'undefined' ? Symbol('util.promisify.custom') : undefined;\n\nexports.promisify = function promisify(original) {\n  if (typeof original !== 'function')\n    throw new TypeError('The \"original\" argument must be of type Function');\n\n  if (kCustomPromisifiedSymbol && original[kCustomPromisifiedSymbol]) {\n    var fn = original[kCustomPromisifiedSymbol];\n    if (typeof fn !== 'function') {\n      throw new TypeError('The \"util.promisify.custom\" argument must be of type Function');\n    }\n    Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n      value: fn, enumerable: false, writable: false, configurable: true\n    });\n    return fn;\n  }\n\n  function fn() {\n    var promiseResolve, promiseReject;\n    var promise = new Promise(function (resolve, reject) {\n      promiseResolve = resolve;\n      promiseReject = reject;\n    });\n\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n    args.push(function (err, value) {\n      if (err) {\n        promiseReject(err);\n      } else {\n        promiseResolve(value);\n      }\n    });\n\n    try {\n      original.apply(this, args);\n    } catch (err) {\n      promiseReject(err);\n    }\n\n    return promise;\n  }\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(original));\n\n  if (kCustomPromisifiedSymbol) Object.defineProperty(fn, kCustomPromisifiedSymbol, {\n    value: fn, enumerable: false, writable: false, configurable: true\n  });\n  return Object.defineProperties(\n    fn,\n    getOwnPropertyDescriptors(original)\n  );\n}\n\nexports.promisify.custom = kCustomPromisifiedSymbol\n\nfunction callbackifyOnRejected(reason, cb) {\n  // `!reason` guard inspired by bluebird (Ref: https://goo.gl/t5IS6M).\n  // Because `null` is a special error value in callbacks which means \"no error\n  // occurred\", we error-wrap so the callback consumer can distinguish between\n  // \"the promise rejected with null\" or \"the promise fulfilled with undefined\".\n  if (!reason) {\n    var newReason = new Error('Promise was rejected with a falsy value');\n    newReason.reason = reason;\n    reason = newReason;\n  }\n  return cb(reason);\n}\n\nfunction callbackify(original) {\n  if (typeof original !== 'function') {\n    throw new TypeError('The \"original\" argument must be of type Function');\n  }\n\n  // We DO NOT return the promise as it gives the user a false sense that\n  // the promise is actually somehow related to the callback's execution\n  // and that the callback throwing will reject the promise.\n  function callbackified() {\n    var args = [];\n    for (var i = 0; i < arguments.length; i++) {\n      args.push(arguments[i]);\n    }\n\n    var maybeCb = args.pop();\n    if (typeof maybeCb !== 'function') {\n      throw new TypeError('The last argument must be of type Function');\n    }\n    var self = this;\n    var cb = function() {\n      return maybeCb.apply(self, arguments);\n    };\n    // In true node style we process the callback on `nextTick` with all the\n    // implications (stack, `uncaughtException`, `async_hooks`)\n    original.apply(this, args)\n      .then(function(ret) { process.nextTick(cb, null, ret) },\n            function(rej) { process.nextTick(callbackifyOnRejected, rej, cb) });\n  }\n\n  Object.setPrototypeOf(callbackified, Object.getPrototypeOf(original));\n  Object.defineProperties(callbackified,\n                          getOwnPropertyDescriptors(original));\n  return callbackified;\n}\nexports.callbackify = callbackify;\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","import * as node from '../node/buffer-utils.node';\n\n/**\n * Check for Node.js `Buffer` (without triggering bundler to include Buffer polyfill on browser)\n */\nexport function isBuffer(value: any): boolean {\n  return value && typeof value === 'object' && value.isBuffer;\n}\n\n/**\n * Converts to Node.js `Buffer` (without triggering bundler to include Buffer polyfill on browser)\n * @todo better data type\n */\nexport function toBuffer(data: any): Buffer {\n  return node.toBuffer ? node.toBuffer(data) : data;\n}\n\n/**\n * Converts Node.js `Buffer` to `ArrayBuffer` (without triggering bundler to include Buffer polyfill on browser)\n * @todo better data type\n */\nexport function bufferToArrayBuffer(data: any): ArrayBuffer {\n  if (node.toArrayBuffer) {\n    // TODO - per docs we should just be able to call buffer.buffer, but there are issues\n    return node.toArrayBuffer(data);\n  }\n  return data;\n}\n","import type {LoaderWithParser} from './types';\n\n// __VERSION__ is injected by babel-plugin-version-inline\n// @ts-ignore TS2304: Cannot find name '__VERSION__'.\nconst VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'latest';\n\n/**\n * A JSON Micro loader (minimal bundle size)\n * Alternative to `@loaders.gl/json`\n */\nexport const JSONLoader = {\n  name: 'JSON',\n  id: 'json',\n  module: 'json',\n  version: VERSION,\n  extensions: ['json', 'geojson'],\n  mimeTypes: ['application/json'],\n  category: 'json',\n  text: true,\n  parseTextSync,\n  parse: async (arrayBuffer) => parseTextSync(new TextDecoder().decode(arrayBuffer)),\n  options: {}\n};\n\n// TODO - deprecated\nfunction parseTextSync(text) {\n  return JSON.parse(text);\n}\n\nexport const _typecheckJSONLoader: LoaderWithParser = JSONLoader;\n","import {asyncDeepMap} from './async-deep-map';\n\nexport async function deepLoad(urlTree, load, options) {\n  return await asyncDeepMap(urlTree, (url) => shallowLoad(url, load, options));\n}\n\nexport async function shallowLoad(url, load, options) {\n  // console.error('loading', url);\n  const response = await fetch(url, options.fetch);\n  const arrayBuffer = await response.arrayBuffer();\n  return await load(arrayBuffer, options);\n}\n","/*\nAsynchronously maps a deep structure of values (e.g. objects and arrays of urls).\n\nE.g. a mipmapped cubemap\n{\n  [CUBE_FACE_FRONT]: [\n    \"image-front-0.jpg\",\n    \"image-front-1.jpg\",\n    \"image-front-2.jpg\",\n  ],\n  [CUBE_MAP_BACK]: [\n    ...\n  ]\n}\n*/\n\nconst isObject = (value) => value && typeof value === 'object';\n\n// Loads a deep structure of urls (objects and arrays of urls)\n// Returns an object with six key-value pairs containing the images (or image mip arrays)\n// for each cube face\nexport async function asyncDeepMap(tree, func, options = {}) {\n  return await mapSubtree(tree, func, options);\n}\n\nexport async function mapSubtree(object, func, options) {\n  if (Array.isArray(object)) {\n    return await mapArray(object, func, options);\n  }\n\n  if (isObject(object)) {\n    return await mapObject(object, func, options);\n  }\n\n  // TODO - ignore non-urls, non-arraybuffers?\n  const url = object;\n  return await func(url, options);\n}\n\n// HELPERS\n\nasync function mapObject(object, func, options) {\n  const promises: Promise<any>[] = [];\n  const values = {};\n\n  for (const key in object) {\n    const url = object[key];\n    const promise = mapSubtree(url, func, options).then((value) => {\n      values[key] = value;\n    });\n    promises.push(promise);\n  }\n\n  await Promise.all(promises);\n\n  return values;\n}\n\nasync function mapArray(urlArray, func, options = {}) {\n  const promises = urlArray.map((url) => mapSubtree(url, func, options));\n  return await Promise.all(promises);\n}\n","import getHiResTimestamp from '../utils/hi-res-timestamp';\nexport default class Stat {\n  constructor(name, type) {\n    this.name = name;\n    this.type = type;\n    this.sampleSize = 1;\n    this.reset();\n  }\n\n  setSampleSize(samples) {\n    this.sampleSize = samples;\n    return this;\n  }\n\n  incrementCount() {\n    this.addCount(1);\n    return this;\n  }\n\n  decrementCount() {\n    this.subtractCount(1);\n    return this;\n  }\n\n  addCount(value) {\n    this._count += value;\n    this._samples++;\n\n    this._checkSampling();\n\n    return this;\n  }\n\n  subtractCount(value) {\n    this._count -= value;\n    this._samples++;\n\n    this._checkSampling();\n\n    return this;\n  }\n\n  addTime(time) {\n    this._time += time;\n    this.lastTiming = time;\n    this._samples++;\n\n    this._checkSampling();\n\n    return this;\n  }\n\n  timeStart() {\n    this._startTime = getHiResTimestamp();\n    this._timerPending = true;\n    return this;\n  }\n\n  timeEnd() {\n    if (!this._timerPending) {\n      return this;\n    }\n\n    this.addTime(getHiResTimestamp() - this._startTime);\n    this._timerPending = false;\n\n    this._checkSampling();\n\n    return this;\n  }\n\n  getSampleAverageCount() {\n    return this.sampleSize > 0 ? this.lastSampleCount / this.sampleSize : 0;\n  }\n\n  getSampleAverageTime() {\n    return this.sampleSize > 0 ? this.lastSampleTime / this.sampleSize : 0;\n  }\n\n  getSampleHz() {\n    return this.lastSampleTime > 0 ? this.sampleSize / (this.lastSampleTime / 1000) : 0;\n  }\n\n  getAverageCount() {\n    return this.samples > 0 ? this.count / this.samples : 0;\n  }\n\n  getAverageTime() {\n    return this.samples > 0 ? this.time / this.samples : 0;\n  }\n\n  getHz() {\n    return this.time > 0 ? this.samples / (this.time / 1000) : 0;\n  }\n\n  reset() {\n    this.time = 0;\n    this.count = 0;\n    this.samples = 0;\n    this.lastTiming = 0;\n    this.lastSampleTime = 0;\n    this.lastSampleCount = 0;\n    this._count = 0;\n    this._time = 0;\n    this._samples = 0;\n    this._startTime = 0;\n    this._timerPending = false;\n    return this;\n  }\n\n  _checkSampling() {\n    if (this._samples === this.sampleSize) {\n      this.lastSampleTime = this._time;\n      this.lastSampleCount = this._count;\n      this.count += this._count;\n      this.time += this._time;\n      this.samples += this._samples;\n      this._time = 0;\n      this._count = 0;\n      this._samples = 0;\n    }\n  }\n\n}\n//# sourceMappingURL=stat.js.map","import Stat from './stat';\nexport default class Stats {\n  constructor({\n    id,\n    stats\n  }) {\n    this.id = id;\n    this.stats = {};\n\n    this._initializeStats(stats);\n\n    Object.seal(this);\n  }\n\n  get(name, type = 'count') {\n    return this._getOrCreate({\n      name,\n      type\n    });\n  }\n\n  get size() {\n    return Object.keys(this.stats).length;\n  }\n\n  reset() {\n    for (const key in this.stats) {\n      this.stats[key].reset();\n    }\n\n    return this;\n  }\n\n  forEach(fn) {\n    for (const key in this.stats) {\n      fn(this.stats[key]);\n    }\n  }\n\n  getTable() {\n    const table = {};\n    this.forEach(stat => {\n      table[stat.name] = {\n        time: stat.time || 0,\n        count: stat.count || 0,\n        average: stat.getAverageTime() || 0,\n        hz: stat.getHz() || 0\n      };\n    });\n    return table;\n  }\n\n  _initializeStats(stats = []) {\n    stats.forEach(stat => this._getOrCreate(stat));\n  }\n\n  _getOrCreate(stat) {\n    if (!stat || !stat.name) {\n      return null;\n    }\n\n    const {\n      name,\n      type\n    } = stat;\n\n    if (!this.stats[name]) {\n      if (stat instanceof Stat) {\n        this.stats[name] = stat;\n      } else {\n        this.stats[name] = new Stat(name, type);\n      }\n    }\n\n    return this.stats[name];\n  }\n\n}\n//# sourceMappingURL=stats.js.map"],"sourceRoot":""}