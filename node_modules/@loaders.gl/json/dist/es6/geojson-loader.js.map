{"version":3,"sources":["../../src/geojson-loader.js"],"names":["RowTableBatch","geojsonToBinary","parseJSONSync","parseJSONInBatches","VERSION","GeoJSONLoaderOptions","geojson","TableBatch","batchSize","workerUrl","json","jsonpaths","gis","format","GeoJSONWorkerLoader","id","name","version","extensions","mimeTypes","category","text","options","GeoJSONLoader","parse","parseTextSync","parseInBatches","arrayBuffer","TextDecoder","decode","asyncIterator","geojsonIterator","makeBinaryGeometryIterator","batch","data"],"mappings":"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","sourcesContent":["/* global TextDecoder */\n/** @typedef {import('@loaders.gl/loader-utils').LoaderObject} LoaderObject */\n/** @typedef {import('@loaders.gl/loader-utils').WorkerLoaderObject} WorkerLoaderObject */\nimport {RowTableBatch} from '@loaders.gl/tables';\nimport {geojsonToBinary} from '@loaders.gl/gis';\nimport parseJSONSync from './lib/parse-json';\nimport parseJSONInBatches from './lib/parse-json-in-batches';\n\n// __VERSION__ is injected by babel-plugin-version-inline\n// @ts-ignore TS2304: Cannot find name '__VERSION__'.\nconst VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'latest';\n\nconst GeoJSONLoaderOptions = {\n  geojson: {\n    TableBatch: RowTableBatch,\n    batchSize: 'auto',\n    workerUrl: `https://unpkg.com/@loaders.gl/json@${VERSION}/dist/geojson-loader.worker.js`\n  },\n  json: {\n    jsonpaths: ['$', '$.features']\n  },\n  gis: {\n    format: 'geojson'\n  }\n};\n\n/** @type {WorkerLoaderObject} */\nexport const GeoJSONWorkerLoader = {\n  id: 'geojson',\n  name: 'GeoJSON',\n  version: VERSION,\n  extensions: ['geojson'],\n  mimeTypes: ['application/geo+json'],\n  // TODO - support various line based JSON formats\n  /*\n  extensions: {\n    json: null,\n    jsonl: {stream: true},\n    ndjson: {stream: true}\n  },\n  mimeTypes: {\n    'application/json': null,\n    'application/json-seq': {stream: true},\n    'application/x-ndjson': {stream: true}\n  },\n  */\n  category: 'geometry',\n  text: true,\n  options: GeoJSONLoaderOptions\n};\n\n/** @type {LoaderObject} */\nexport const GeoJSONLoader = {\n  ...GeoJSONWorkerLoader,\n  parse,\n  parseTextSync,\n  parseInBatches\n};\n\nasync function parse(arrayBuffer, options) {\n  return parseTextSync(new TextDecoder().decode(arrayBuffer), options);\n}\n\nfunction parseTextSync(text, options) {\n  // Apps can call the parse method directly, we so apply default options here\n  options = {...GeoJSONLoaderOptions, ...options};\n  options.json = {...GeoJSONLoaderOptions.geojson, ...options.geojson};\n  options.gis = options.gis || {};\n  const json = parseJSONSync(text, options);\n  switch (options.gis.format) {\n    case 'binary':\n      return geojsonToBinary(json);\n    default:\n      return json;\n  }\n}\n\nasync function parseInBatches(asyncIterator, options) {\n  // Apps can call the parse method directly, we so apply default options here\n  options = {...GeoJSONLoaderOptions, ...options};\n  options.json = {...GeoJSONLoaderOptions.geojson, ...options.geojson};\n\n  const geojsonIterator = parseJSONInBatches(asyncIterator, options);\n\n  switch (options.gis.format) {\n    case 'binary':\n      return makeBinaryGeometryIterator(geojsonIterator);\n    default:\n      return geojsonIterator;\n  }\n}\n\nasync function* makeBinaryGeometryIterator(geojsonIterator) {\n  for await (const batch of geojsonIterator) {\n    batch.data = geojsonToBinary(batch.data);\n    yield batch;\n  }\n}\n"],"file":"geojson-loader.js"}